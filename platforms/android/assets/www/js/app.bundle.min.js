var app=angular.module("community",["ionic","ion-datetime-picker","pascalprecht.translate","angular-md5","ionic-native-transitions","ngCordova","ngSQLite","oi.select","base64","community.controllers.auth","community.services.auth","community.routes","community.configs","community.controllers","community.services","community.services.utils","community.constant","community.controllers.mine","starter.services.mine","community.controllers.work","starter.services.work.home","community.controllers.waitWork","starter.services.wait.work","community.controllers.viewForm","community.services.viewForm","community.module.viewForm","community.controllers.information","community.controllers.formHandle","community.controllers.formEnlargement","community.controllers.notification","starter.services.notification","community.controllers.gestureLock","community.services.gestureLock","templates","monospaced.elastic","community.directive","base","formComponents","community.controllers.echarts"]);app.run(["$ionicPlatform","$rootScope","$isMobile","$ionicPickerI18n","$location","$timeout","$cordovaToast","$ionicNativeTransitions","storageService","auth_events","$ionicHistory","$stateParams","mine","$SQLite","DB_CONFIG","SQLiteHelper","timeout","scopeData","stateGoHelp","APP","DBSingleInstance","mobileSocket","serverConfiguration",function(t,o,i,e,a,n,r,s,c,l,m,u,d,f,p,g,w,b,k,v,h,y,P){t.ready(function(){function w(){LifeListener.lifeListener("life",function(t){"onStop"==t||"onPause"==t?(j=!1,y.close()):"onResume"!=t&&"onStart"!=t||(y.connect(),S=n(function(){j=!0},500)),w()},null)}function P(t,i){var e=c.get(l.token,null);null==e?(r.showShortBottom("请先登录系统"),s.stateGo("login",{},o.obj)):"0"==i?s.stateGo("tab.view-form",{titleName:"已发事项",titleFlag:"0",type:"work",waitWorkPassDate:angular.toJson(t)},o.obj):"1"==i&&s.stateGo("tab.view-form",{waitWorkPassDate:angular.toJson(t)},o.obj)}function N(){window.plugins.jPushPlugin.getRegistrationID(B)}function B(t){0==t.length?window.setTimeout(N,1e3):null!=t&&(c.set(d.jPushId,t),g.setPushId(t))}if(e.weekdays=["周日","周一","周二","周三","周四","周五","周六"],e.months=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],e.ok="确定",e.cancel="取消",e.okClass="button-positive",e.cancelClass="button-stable",window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(navigator.splashscreen.hide(),cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!1),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),i.Android&&(f.dbConfig({name:"OA",description:"Test DB",version:"1.0"}),f.init(function(t){angular.forEach(p,function(o,i){t.step(),f.createTable(i,o).then(t.done)}),t.finish()}),h.initDb()),i.Android){var S,I=!0,j=!0;w(),t.registerBackButtonAction(function(t){if(j){if("/tab/work"==a.path()||"/tab/waitWork"==a.path()||"/tab/information"==a.path()||"/tab/mine"==a.path()||"/login"==a.path())I=!I,I?ionic.Platform.exitApp():(I=!1,r.showShortBottom("再按一次退出系统"),n(function(){I=!0},2e3));else if("/gesture///setGestureLock////"==a.path()||"/gesture///resetGestureLock/"==a.path())s.stateGo("tab.mine",{});else{var o=m.currentView();if(void 0!=u.workWaitData&&""!=u.workWaitData){var i=angular.fromJson(u.workWaitData),e=i.workFlag;i.title}if("tab.view-form"===o.stateName||"tab.viewFormWork"===o.stateName){var l=m.backView(),f=b.prototype.getStateCurrentViewDataName(),p=b.prototype.getStateCurrentViewParams();"tab.form-handle"==l.stateName||"tab.form-handle-reply"==l.stateName||"tab.form-enlargement"==l.stateName||"tab.formHandleWork"==l.stateName||"tab.work-form-enlargement"==l.stateName?(l.stateName=f,l.stateParams=p,m.goBack()):m.goBack()}else"tab.notification-work"===o.stateName?"work"==u.type?k.stateGoUtils(!0,"tab.workNotification",{type:u.type},"right"):"mine"==u.type?k.stateGoUtils(!0,"tab.mineNotification",{type:u.type},"right"):"information"==u.information?k.stateGoUtils(!0,"tab.notification-item",{information:u.information},"right"):k.stateGoUtils(!0,"tab.notification",{type:u.type},"right"):"tab.workNotification"===o.stateName?k.stateGoUtils(!0,"tab.work",{},"right"):"tab.notification"===o.stateName?u.backFlag?s.goBack():k.stateGoUtils(!0,"tab.waitWork",{},"right"):"tab.notification-item"===o.stateName?k.stateGoUtils(!0,"tab.information",{},"right"):"tab.mineNotification"===o.stateName?k.stateGoUtils(!0,"tab.mine",{},"right"):"tab.myWorkWaitWork"===o.stateName||"tab.doneWork"===o.stateName||"tab.waitNews"===o.stateName?k.stateGoUtils(!0,"tab.work",{titleFlag:u.titleFlag},"right"):"tab.waitWork"===o.stateName?"isWork"==e?k.stateGoUtils(!0,"tab.work",{titleFlag:u.titleFlag},"right"):(I=!I,I?ionic.Platform.exitApp():(I=!1,r.showShortBottom("再按一次退出系统"),n(function(){I=!0},2e3))):"tab.signatureWay"===o.stateName?(c.set(d.approveSwitchKey,"false"),s.goBack()):s.goBack()}return!1}},101)}if(!i.isPC){if(window.plugins.jPushPlugin.init(),i.Android?window.plugins.jPushPlugin.setDebugMode(v.devMode):i.IOS&&(v.devMode&&window.plugins.jPushPlugin.setDebugModeFromIos(),window.plugins.jPushPlugin.setApplicationIconBadgeNumber(0)),window.plugins.jPushPlugin.openNotification.alert,i.IOS)var D=function(t){r.showShortBottom("您收到一条消息")},T=function(t){r.showShortBottom("您收到一条消息")},G=function(t){var o={taskId:t.taskId,procInstId:t.procInstId};P(o,t.jumpType)};i.Android?(window.plugins.jPushPlugin.receiveNotificationInAndroidCallback=function(t){r.showShortBottom("您收到一条消息")},window.plugins.jPushPlugin.openNotificationInAndroidCallback=function(t){var o={taskId:t.extras.taskId,procInstId:t.extras.procInstId};P(o,t.extras.jumpType)}):i.IOS&&(document.addEventListener("jpush.receiveNotification",D,!1),document.addEventListener("jpush.openNotification",G,!1),document.addEventListener("jpush.backgoundNotification",T,!1)),N()}ionic.Platform.isIPad()&&screen.unlockOrientation()})}]),app.config(["$translateProvider","$stateProvider","$ionicConfigProvider","$ionicNativeTransitionsProvider",function(t,o,i,e){function a(){e.setDefaultOptions(n),e.setDefaultTransition(r),e.setDefaultBackTransition(s),e.enable(!0)}var n={duration:300,slowdownfactor:10,androiddelay:-1,fixedPixelsTop:0,fixedPixelsBottom:0,backInOppositeDirection:!1},r={type:"slide",direction:"left"},s={type:"slide",direction:"right"};i.views.swipeBackEnabled(ionic.Platform.isIOS()),ionic.Platform.isAndroid()?a():e.enable(!1),i.platform.ios.tabs.style("standard"),i.platform.ios.tabs.position("bottom"),i.platform.android.tabs.style("standard"),i.platform.android.tabs.position("standard"),i.platform.ios.navBar.alignTitle("center"),i.platform.android.navBar.alignTitle("center"),i.platform.ios.backButton.previousTitleText("").icon("ion-ios-arrow-thin-left"),i.platform.android.backButton.previousTitleText("").icon("ion-android-arrow-back"),i.platform.ios.views.transition("ios"),i.platform.android.views.transition("android"),i.backButton.text(""),i.backButton.previousTitleText(!1),i.scrolling.jsScrolling(!1),i.views.swipeBackEnabled(!1);var c=window.localStorage.lang||"cn";t.fallbackLanguage(c),t.preferredLanguage(c),t.useSanitizeValueStrategy("escapeParameters"),t.useStaticFilesLoader({prefix:"locales/",suffix:".json"})}]);
!function(){"use strict";var t=angular.module("community.routes",[]);t.config(["$stateProvider","$urlRouterProvider",function(t,a){t.state("tab",{url:"/tab","abstract":!0,nativeTransitions:null,templateUrl:"app/tabs/tabs.html"}).state("tab.work",{url:"/work",nativeTransitions:null,views:{"tab-work":{templateUrl:"app/work/templates/tab-my-work.html",controller:"WorkCtrl"}}}).state("tab.waitWork",{url:"/waitWork/:searchDataStr/:workWaitData/:retrieve",nativeTransitions:null,views:{"tab-waitWork":{templateUrl:"app/wait-work/templates/tab-wait-work.html",controller:"WaitWorkCtrl"}}}).state("tab.information",{url:"/information",nativeTransitions:null,views:{"tab-information":{templateUrl:"app/information/templates/information.html",controller:"InformationCtrl"}}}).state("tab.mine",{url:"/mine",nativeTransitions:null,views:{"tab-mine":{templateUrl:"app/mine/templates/tab-my.html",controller:"MineCtrl"}}}),a.otherwise(function(t,a){a.path("/login")})}])}();
!function(){"use strict";angular.module("templates",[])}();
!function(){"use strict";var t=angular.module("community.controllers",[]);t.controller("ApplicationCtrl",["$scope","$rootScope","auth_events","$isMobile","$cordovaToast","T","public_constant","authService","$ionicPopup","versionUpdate","$ionicLoading","scopeData","storageService",function(t,e,o,n,i,a,l,r,s,c,p,u,g){e.tabWork=!1,e.tabWaitWork=!1,e.tabIonNotification=!1,e.tabMine=!1,e.bellRed=!1;var b=!0;t.$on(o.notNetConnected,function(){n.isPC||i.showShortBottom(a.translate("publicMsg.noNetwork"))}),t.$on(o.notVpnConnected,function(){n.isPC||i.showShortBottom(a.translate("publicMsg.noVPN"))}),t.$on(l.responseError400,function(t){s.alert({title:a.translate("publicMsg.popTitle"),template:"绘制图案解锁"===t.targetScope.titleData?"您绘制的手势有误，请重试！":"用户名或密码错误，请重试"})}),t.$on(l.loginOnce,function(){if(n.isPC)alert(a.translate("publicMsg.loginOnce")),c.exitLogin(!1);else if(b){b=!1;var t=s.alert({title:a.translate("publicMsg.popTitle"),template:a.translate("publicMsg.loginOnce"),okText:a.translate("publicMsg.sure"),okType:"button-positive"})}t.then(function(t){b=!0,c.exitLogin(!1)})}),t.$on(l.tokenErr,function(){if(n.isPC)alert(a.translate("publicMsg.loginOnce")),c.exitLogin(!1);else if(b){b=!1;var t=s.alert({title:a.translate("publicMsg.popTitle"),template:a.translate("publicMsg.tokenErr"),okText:a.translate("publicMsg.sure"),okType:"button-positive"})}t.then(function(t){b=!0,c.exitLogin(!1)})}),t.$on(o.successSysErr,function(t,e){p.hide(),n.isPC?alert(e):i.showShortBottom(e)}),t.$on("clearStorageFormData",function(t,o){u.prototype.setHtmlData(null),u.prototype.setPermissionData(null),u.prototype.setPermissionData(null),g.set("viewFormCacheWork",null),e.dataListENew=[],g.removeItem("backReply")})}])}();
!function(){"use strict";var n=angular.module("community.services",[]);n.factory("application",["storageService","$ionicLoading","$timeout","$rootScope","$cordovaToast","serverConfiguration","$isMobile","T","auth_events","timeout","$q","$http","DBSingleInstance","jdbc",function(n,t,e,o,r,i,a,l,u,s,c,d,f,g){function m(){if(a.Android){var n=f.getSyncDb();n.transaction(function(n){n.executeSql("select * from SyncData",[],function(n,t){t.rows&&0!==t.rows.length?(O=angular.fromJson(t.rows.item(0).name),p()):b()})})}else g.findAll("syncData").then(function(n){n&&0===n.length?b():(O=angular.fromJson(n[n.length-1].syncValue),p())});return O}function b(){a.IOS?window.plugins.jPushPlugin.setApplicationIconBadgeNumber(0):a.Android&&(window.plugins.jPushPlugin.clearAllNotification(),window.plugins.jPushPlugin.clearBadgeNum());var t=i.baseApiUrl+"app/common/v1/getMyStatistics",e={account:n.get(u.userId,null)};I(t,e,!1).then(function(n){n.state===-1?a.isPC||r.showShortBottom(l.translate("publicMsg.requestErr")):(0!=n.other||0!=n.money||0!=n.goods||0!=n.staff?(o.tabWork=!0,o.tabWaitWork=!0):(o.tabWork=!1,o.tabWaitWork=!1),0==n.messageNum?(o.tabIonNotification=!1,o.bellRed=!1):(o.tabIonNotification=!0,o.bellRed=!0))},function(n){a.isPC||r.showShortBottom(l.translate("publicMsg.requestErr"))})}function p(){var n=!1;A=O,h();for(var t=0;t<A.length;t++)0!==A[t].CNT&&(n=!0);n?(o.tabWork=!0,o.tabWaitWork=!0):(o.tabWork=!1,o.tabWaitWork=!1)}function h(){var t=!1,e=i.baseApiUrl+"app/home/v3/customCount",s={account:n.get(u.userId,null)};I(e,s,!1).then(function(n){for(var e=angular.fromJson(n.list),r=0;r<e.length;r++)for(var i=0;i<A.length;i++)e[r].pkid===A[i].TYPE_ID&&(A[r].CNT=e[r].num,0!=A[r].CNT&&(t=!0));t?(o.tabWork=!0,o.tabWaitWork=!0):(o.tabWork=!1,o.tabWaitWork=!1),0==n.messageNum?(o.tabIonNotification=!1,o.bellRed=!1):(o.tabIonNotification=!0,o.bellRed=!0)},function(n){a.isPC||r.showShortBottom(l.translate("publicMsg.requestErr"))})}var S=function(n){t.show({content:"",animation:"fade-in",showBackdrop:n,maxWidth:200,showDelay:0})},v=function(){t.hide()},O={},A={},I=function(n,t,o){o&&(S(!0),e(function(){v()},s.max));var r=c.defer();return d({method:"POST",url:n,params:t}).success(function(n){r.resolve(n),o&&v()}).error(function(n){r.reject(n),o&&v()}),r.promise};return{showLoading:S,hideLoading:v,getAlertNews:m}}]),n.factory("Interceptor",["serverConfiguration","$rootScope","auth_events","$isMobile","storageService","public_constant","$q","APP","$filter","DBSingleInstance",function(n,t,e,o,r,i,a,l,u,s){function c(n,t,i,a,l){if("1"==r.get(e.logRecode,"0")){var c=u("date")((new Date).getTime(),"yyyy-MM-dd HH:mm:ss sss");if(o.Android){var d=s.getTimeDb();d.transaction(function(e){e.executeSql("insert into TimeData values(?,?,?,?,?,?)",[n,t,i,a,c,l],function(n){},function(n,t){})})}}}return{request:function(i){if("1"==r.get(e.logRecode,"0")&&(i.url.indexOf(n.baseApiUrl)>=0||i.url.indexOf(n.SSOUrl)>=0)){var a=r.get(e.loginEnglishName,null),u=r.get(e.name,null),s=r.get(e.userId,null),d=u+"&&"+a,f="PC",g=i.url,m="request";o.Android?f="Android":o.IOS&&(f="IOS"),c(s,d,f,g,m)}if((i.url.indexOf(n.baseApiUrl)>=0||i.url.indexOf(n.SSOUrl)>=0)&&(i.url.indexOf(n.baseApiUrl)>=0&&(i.headers.User_Pkid=r.get(e.userId,null),i.headers.Authorization=r.get(e.authorization,null)),!o.isPC&&null!=navigator.connection)){var b=navigator.connection.type;if(!angular.isDefined(b))return t.$broadcast(e.notNetConnected),null;if("none"==b||0==b)return t.$broadcast(e.notNetConnected),null;b!=Connection.WIFI&&o.Android&&l.VPNFlag&&PermissionsPlugin.addPermissions("VPN",function(n){if("VPN_OK"!=n)return t.$broadcast(e.notVpnConnected),null},function(n){return t.$broadcast(e.notVpnConnected),null},null)}return i},response:function(i){if("1"==r.get(e.logRecode,"0")&&(i.config.url.indexOf(n.baseApiUrl)>=0||i.config.url.indexOf(n.SSOUrl)>=0)){var a=r.get(e.loginEnglishName,null),l=r.get(e.name,null),u=r.get(e.userId,null),s=l+"&&"+a,d="PC",f=i.config.url,g="response";o.Android?d="Android":o.IOS&&(d="IOS"),c(u,s,d,f,g)}return(i.config.url.indexOf(n.baseApiUrl)>=0||i.config.url.indexOf(n.SSOUrl)>=0)&&i.data.state==-1?(t.$broadcast(e.successSysErr,i.data.msg),null):i},responseError:function(l){if("1"==r.get(e.logRecode,"0")&&(l.config.url.indexOf(n.baseApiUrl)>=0||l.config.url.indexOf(n.SSOUrl)>=0)){var u=r.get(e.loginEnglishName,null),s=r.get(e.name,null),d=r.get(e.userId,null),f=s+"&&"+u,g="PC",m=l.config.url,b="responseError";o.Android?g="Android":o.IOS&&(g="IOS"),c(d,f,g,m,b)}if(l.config.url.indexOf(n.baseApiUrl)>=0||l.config.url.indexOf(n.SSOUrl)>=0){var p={400:i.responseError400,511:i.loginOnce,401:i.tokenErr,0:i.serviceErr}[l.status];if(511===l.status&&(t.utilsCount=0,t.waitWorkCount=0),null!=p)return t.$broadcast(p,!0),null}return a.reject(l)},requestError:function(n){return null}}}]),n.config(["$httpProvider",function(n){n.interceptors.push("Interceptor")}])}();
!function(){"use strict";var e=angular.module("community.constant",[]);e.constant("auth_events",{notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized",notServiceResponse:"service-not-response",notNetConnected:"net-not-connected",notVpnConnected:"vpn-not-connected",successSysErr:"success-err-state",systemErr:"system-error",token:"token",userId:"user-id",name:"name",inputName:"input-name",authorization:"user-authorization",loginEnglishName:"login-name",followed:"followed",roleList:"roleList",logRecode:"log-recode",setSignature:"set-signature"}),e.constant("user_roles",{admin:"admin-role","public":"public-role"}),e.constant("timeout",{max:5e4,timeOut:50500,pullDown:200,animDuration:300}),e.constant("set_home_page",{waitWork:"待办",work:"工作",information:"消息",mine:"我的",setHomeKey:"set-home-page",requestTimeDbKey:"request-time-db-key"}),e.constant("wait_work",{sizerStateKey:"sizer_state_key",sizerTypeKey:"sizer_type_key",sizerWorkStateKey:"sizer_work_state_key",sizerWorkTypeKey:"sizer_work_type_key"}),e.constant("work",{sizerStateKey:"sizer_state_key",sizerTypeKey:"sizer_type_key"}),e.constant("mine",{gestureLockKey:"gesture_lock_key",approveSwitchKey:"approve_switch_key",signatureSwitchKey:"signature_switch_key",pictureAvatar:"picture_avatar",userName:"user_name",pwLockKey:"pw_lock_key",isPW:"is_pw",isOne:"is_one",jPushId:"jPush_id"}),e.constant("public_constant",{responseError400:"response_error_400",loginOnce:"already-login",tokenErr:"token_err",serviceErr:"service_err"}),e.constant("form_constant",{formWidth:"form-width"}),e.constant("DB_CONFIG",{jPush:{id:"key",pushId:{type:"text","null":!1}}})}();
!function(){"use strict";var n=angular.module("community.services");n.factory("DBSingleInstance",["APP",function(n){function t(){T=openDatabase("OA","1.0","test db",2097152),T.transaction(function(n){n.executeSql("CREATE TABLE IF NOT EXISTS SyncData(name TEXT)",[],function(n,t){},function(n,t){})}),u=openDatabase("TIME","1.0","time db",20971520),u.transaction(function(n){n.executeSql("CREATE TABLE IF NOT EXISTS TimeData(userPkid TEXT,userName TEXT,platform TEXT,url TEXT,makeTime TEXT,logType TEXT)",[],function(n,t){},function(n,t){})})}function e(){return null==T&&(T=openDatabase("OA","1.0","test db",2097152)),T}function a(){return null==u&&(u=openDatabase("TIME","1.0","time db",20971520)),u}var T=null,u=null;return{initDb:t,getSyncDb:e,getTimeDb:a}}])}();
!function(){"use strict";var e=angular.module("community.services.utils",[]);e.factory("$isMobile",["$window",function(e){return{Android:navigator.userAgent.match(/Android/i)&&e.cordova,BlackBerry:navigator.userAgent.match(/BlackBerry/i)&&e.cordova,IOS:navigator.userAgent.match(/iPhone|iPad|iPod/i)&&e.cordova,Opera:navigator.userAgent.match(/Opera Mini/i)&&e.cordova,Windows:navigator.userAgent.match(/IEMobile/i)&&e.cordova,isPC:!(navigator.userAgent.match(/Android|BlackBerry|iPhone|iPad|iPod|Opera Mini|IEMobile/i)&&e.cordova)}}]),e.factory("T",["$translate",function(e){var n={translate:function(n){return n?e.instant(n):n}};return n}]),e.factory("storageService",["$window",function(e){return{set:function(n,t){e.localStorage[n]=t},get:function(n,t){return e.localStorage[n]||t},setObject:function(n,t){e.localStorage[n]=JSON.stringify(t)},getObject:function(n){return JSON.parse(e.localStorage[n]||null)},clearAll:function(){e.localStorage.clear()},removeItem:function(n){e.localStorage.removeItem(n)}}}]),e.factory("tempStorageService",["$window",function(e){return{set:function(n,t){e.sessionStorage[n]=t},get:function(n,t){return e.sessionStorage[n]||t},setObject:function(n,t){e.sessionStorage[n]=JSON.stringify(t)},getObject:function(n){return JSON.parse(e.sessionStorage[n]||null)},clearAll:function(){e.sessionStorage.clear()},removeItem:function(n){e.sessionStorage.removeItem(n)}}}]),e.factory("Camera",["$q",function(e){return{getPicture:function(n){var t=e.defer();return navigator.camera.getPicture(function(e){t.resolve(e)},function(e){t.reject(e)},n),t.promise}}}]),e.factory("GetRequestService",["$q","$http","$ionicLoading","$timeout","application","timeout","$ionicPopup","T","$cordovaToast","$isMobile","public_constant","$rootScope",function(e,n,t,o,r,i,a,s,c,u,l,d){var f;d.$on(l.loginOnce,function(){r.hideLoading(),o.cancel(f)}),d.utilsCount=0;var g=function(t,a,l,f,g,v){if(l){var p=o(function(){console.log("FROM: "+t),d.utilsCount--,u.isPC||c.showShortBottom(s.translate("publicMsg.timeOutAlert"))},g||i.timeOut);d.utilsCount++,r.showLoading(!0),o(function(){r.hideLoading()},v||i.max)}var h=e.defer();return n({method:f,url:t,params:a}).success(function(e){h.resolve(e),l&&(d.utilsCount--,0===d.utilsCount&&r.hideLoading(),o.cancel(p))}).error(function(e){h.reject(e),l&&(d.utilsCount--,0===d.utilsCount&&r.hideLoading(),o.cancel(p))}),h.promise},v=function(t,a,l,d,g){l&&(f=o(function(){console.log("FROM: "+t),u.isPC||c.showShortBottom(s.translate("publicMsg.timeOutAlert"))},i.timeOut),r.showLoading(!0),o(function(){r.hideLoading()},i.max));var v=e.defer();return n({method:d,url:t,data:a,headers:{"Content-Type":g}}).success(function(e){v.resolve(e),l&&(r.hideLoading(),o.cancel(f))}).error(function(e){v.reject(e),l&&(r.hideLoading(),o.cancel(f))}),v.promise};return{getRequestData:g,getRequestDataJson:v}}]),e.factory("SQLiteHelper",["$SQLite","jdbc","$isMobile",function(e,n,t){var o=1;return{setPushId:function(r){if(t.Android)e.ready(function(){this.selectFirst("SELECT * FROM jPush WHERE id = ? LIMIT 1",[o]).then(function(){console.log("Empty Result!"),e.insert("jPush",{pushId:r})},function(){console.err("Error!")},function(n){n.count>0&&e.execute("UPDATE jPush SET pushId = ? WHERE id = ?",[r,1])})});else{var i={};i.id=1,i.pushid=r,n.put("jpushData",i)}},setSearch:function(o){t.Android?e.ready(function(){e.execute("delete from searchValue",null),e.insert("searchValue",{SyncData:o})}):(n.findAll("searchValue").then(function(e){e&&n.remove("searchValue",e.syncData)}),n.put("searchValue",o))}}}]),e.factory("versionUpdate",["serverConfiguration","$isMobile","GetRequestService","APP","$cordovaToast","$ionicLoading","$q","T","storageService","auth_events","authService","$timeout","$ionicPopup","DBSingleInstance","mobileSocket","jdbc","$cordovaFileOpener2",function(e,n,t,o,r,i,a,s,c,u,l,d,f,g,v,p,h){function m(){if(!n.Android)return p.findAll("syncData").then(function(e){e&&e.forEach(function(e){p.remove("syncData",e.id)})}),A=!0,l.logout(),P.promise;var e=g.getSyncDb();e.transaction(function(e){e.executeSql("delete from SyncData",[],function(e,n){return P.resolve("exitSuccess"),A=!0,l.logout(),P.promise},function(e,n){return P.reject(),P.promise})})}var w,S,y,b,A=!0,P=a.defer(),O=null,T=function(i){if(n.Android){var l=["android.permission.WRITE_EXTERNAL_STORAGE"];PermissionsPlugin.addPermissions("权限",function(){},function(){},l)}var d=!0,f=a.defer(),g=e.baseApiUrl+"app/version/v1/get",v="Android";n.Android?v="Android":n.IOS&&(v="IOS");var p=function(e){var i={platform:v,count:e,username:O};t.getRequestData(g,i,d,"GET",10500,1e4).then(function(e){if(o.devMode&&console.log("版本信息",e),0==e.state){if("undefined"==typeof e.versionCount)return void f.reject();S=e.versionCount,y=e.pkid,b=e.fileName,n.isPC||window.cordova.getAppVersion.getVersionCode(function(n){w=parseInt(n),S>w?(e.shouldUpdate=!0,e.mustUpdate=!1,1==e.flagStatus&&(e.mustUpdate=!0)):e.shouldUpdate=!1,f.resolve(e)})}else f.reject(e)},function(e){n.isPC||r.showShortBottom(s.translate("publicMsg.requestErr")),f.reject(e)})};return O=c.get(u.inputName,null),n.isPC||window.cordova.getAppVersion.getVersionCode(function(e){c.set("versionCount",e),p(parseInt(e))}),f.promise},$=function(t){if(n.Android){var o=e.baseApiUrl+"app/attachment/getApk?pkid="+y,a="/sdcard/Download/"+b,c=encodeURI(o),u=new FileTransfer;u.onprogress=function(e){var n=e.loaded/e.total*100;i.show({template:"已经下载："+Math.floor(n)+"%"}),n>99&&i.hide()},u.download(c,a,function(e){var n=!1;h.open(a,"application/vnd.android.package-archive").then(function(){n=!0},function(e){n=!0,f.alert({title:s.translate("publicMsg.popTitle"),template:s.translate("publicMsg.openApkAlert"),okText:s.translate("publicMsg.sure")})}),d(function(){n||f.alert({title:s.translate("publicMsg.popTitle"),template:s.translate("publicMsg.openApkAlert"),okText:s.translate("publicMsg.sure")})},1500)},function(e){r.showShortBottom(s.translate("publicMsg.upDateErr"))},!1,{headers:{Authorization:"BasicdGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="}})}else n.IOS&&cordova.exec(null,null,"InAppBrowser","open",[encodeURI("itms-services://?action=download-manifest&url="+t.filePath),"_system"])},C=function(o){if(o&&A){var i=e.baseApiUrl+"app/common/v1/logout",a={account:c.get(u.userId,null)};return t.getRequestData(i,a,!0,"POST").then(function(e){0==e.state?(A=!1,m(),v.close()):(n.isPC||r.showShortBottom(s.translate("mine.logout-error")),P.reject("exitErr"))},function(e){n.isPC||r.showShortBottom(s.translate("mine.logout-error")),P.reject(e)}),P.promise}m(),v.close()},I=function(){return n.isPC||window.cordova.getAppVersion.getVersionNumber(function(e){P.resolve(e)}),P.promise};return{getVersionInfo:T,upDateVersion:$,exitLogin:C,getCurrentVersion:I}}]),e.factory("stateGoHelp",["$ionicNativeTransitions","timeout","APP","$ionicHistory","$ionicViewSwitcher","$state",function(e,n,t,o,r,i){var a=function(o,a,s,c){t.devMode&&console.log("跳转带值",s),o?ionic.Platform.isIOS()?(r.nextDirection("forward"),i.go(a,s,null)):e.stateGo(a,s,{},{type:"slide",direction:c,duration:n.animDuration}):e.goBack()};return{stateGoUtils:a}}]),e.factory("clone",function(){var e=function(n){var t;if(n instanceof Array){t=[];for(var o=n.length;o--;)t[o]=e(n[o]);return t}if(n instanceof Object){t={};for(var r in n)t[r]=e(n[r]);return t}return n};return{cloneData:e}}),e.factory("appUtils",["$state","$ionicViewSwitcher","$ionicNativeTransitions","$ionicHistory","$ionicModal","$cordovaToast","$ionicScrollDelegate","$translate","$ionicLoading",function(e,n,t,o,r,i,a,s,c){var u=function(){ionic.Platform.isIOS()?o.goBack():t.goBack()},l=function(t,o,r){n.nextDirection("forward"),e.go(t,o),r&&"function"==typeof r&&r()},d=function(e){t.locationUrl(e,{type:"fade",duration:0})},f=function(e){if("string"==typeof e)return e.replace(/^\s+|\s+$/g,"")},g=function(e){c.show({content:"",animation:"fade-in",showBackdrop:e,maxWidth:200,showDelay:0})},v=function(){c.hide()},p=function(e,n){if("string"==typeof e&&"number"==typeof n&&e.length>=n){var t=e.slice(0,n),o=t.lastIndexOf(" ");return t=null,e.slice(0,o)+"..."}return e},h=function(e,n,t){n?s(e).then(function(e){m(e,t)}):m(e,t)},m=function(e,n){switch(n){case 0:return window.cordova?i.showShortTop(e):alert(e);case 1:return window.cordova?i.showShortCenter(e):alert(e);case 2:return window.cordova?i.showShortBottom(e):alert(e)}},w=function(e,n){window.cordova?"short"===n?i.showShortCenter(e):i.showLongCenter(e):console.log("NOTE - not running on device: showToast('"+e+"')")},S=function(e,n,t){n?s(e).then(function(e){w(e,t)}):w(e,t)},y=function(e,n,t,o){r.fromTemplateUrl(e,{scope:n,animation:t}).then(function(e){o&&angular.isFunction(o)&&o(e)})},b=function(e){e.hide()},A=function(e,n){e.$on("$destroy",function(){Array.isArray(n)?n.forEach(function(e){e.remove()}):n&&n.remove()})},P=function(){o.clearHistory()},O=function(e){if(Array.isArray(e)){for(var n=[],t={},o=0;o<e.length;o++)t[e[o]]||(n.push(e[o]),t[e[o]]=1);return n}},T=function(e){var n=[],t=[];if(localStorage.searchList&&e)n=JSON.parse(localStorage.searchList),n.unshift(e),t=O(n);else{if(localStorage.searchList||!e)return localStorage.searchList?JSON.parse(localStorage.searchList):[];t.unshift(e)}return localStorage.searchList=JSON.stringify(t),t},$=function(e){return"number"!=typeof e?null:e/10<1?"0"+e:e},C=function(e,n,t){var o=$(e),r=$(n),i=$(t);return o+":"+r+":"+i},I=function(e){var n=Math.floor(e/3600),t=Math.floor(e%3600/60),o=Math.floor(e%60);return C(n,t,o)},j=function(){navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide(),window.StatusBar&&window.StatusBar.show()},D=function(e,n){a.$getByHandle(e).scrollTop(n)},M=function(e){if(!e)return!0;for(var n in e)if(e.hasOwnProperty(n))return!1;return!0},E=function(e){return!M(e)},B=function(e){var n=e.indexOf(".");if(n>0)var t=e.substring(0,n),o=e.substring(n,e.length);else var t=e,o="";if(t.length<=3)return""==t?"0":t+o;for(var r=t.length%3,i=0==r?"":t.substring(0,r),a=0;a<Math.floor(t.length/3);a++)i+=0==r&&0==a?t.substring(r+3*a,r+3*a+3):","+t.substring(r+3*a,r+3*a+3);return i+o};return{back:u,go:l,doGo:d,trim:f,showLoading:g,hideLoading:v,textCut:p,showTips:h,tips:m,doShowToast:w,showToast:S,showModal:y,hideModal:b,destroyModal:A,clearHistory:P,arrayUnique:O,getSearchTextStorage:T,handleTime:C,handlePlayingTime:I,enterSettings:j,scrollToTop:D,isObjectEmpty:M,isObjectNotEmpty:E,outputMoney:B}}]),e.factory("mobileSocket",["$window","$isMobile","serverConfiguration","storageService","auth_events","DBSingleInstance","$filter",function(e,n,t,o,r,i,a){document.addEventListener("online",function(){s(),o.set("wsConnectionCount",0)},!1);var s=function(c){if(n.isPC)return!1;var u=o.get(r.userId,null),l=n.IOS?"IOS":"Android",d=o.get("versionCount",1);if(c>4){var f=a("date")((new Date).getTime(),"yyyy-MM-dd HH:mm:ss sss"),g=o.get(r.loginEnglishName,null),v=o.get(r.name,null),p=v+"&&"+g,h=i.getTimeDb(),m=t.webSocket;return h.transaction(function(e){e.executeSql("insert into TimeData values(?,?,?,?,?,?)",[u,p,l,m,f,"webSocket"],function(e){},function(e,n){})}),!1}try{e.ws.close()}catch(w){console.warn("websocket:"+w)}return!(n.Android&&!u)&&(e.ws=new WebSocket(t.webSocket+"?user="+u+"&system=oa&subsystem=oa-web&client_type="+l+"&version_count="+d),navigator.connection.type?e.ws.waitTime="none"==navigator.connection.type?6e4:3e3:e.ws.waitTime="none"==navigator.network.connection.type?6e4:3e3,e.ws.onopen=function(n){o.set("wsConnectionCount",0),e.ws.send("用户pkid："+u+"客户端："+l+"版本号："+d)},e.ws.onmessage=function(e){var n=(e.data,e.target);n.send("yes")},void(e.ws.onclose=function(n){return(4e3!=n.code||"logout"!=n.reason)&&void setTimeout(function(){var n=o.get("wsConnectionCount",0);return o.set("wsConnectionCount",++n),1!=e.ws.readyState&&void s(n)},e.ws.waitTime)}))},c=function(){try{e.ws.close(4e3,"logout")}catch(n){console.warn("websocket:"+n)}};return{connect:s,close:c}}]),e.factory("downloadFileUtil",["serverConfiguration","$isMobile","GetRequestService","$cordovaToast","$ionicLoading","$q","T",function(e,n,t,o,r,i,a){var s=function(e,t,s,c){var u=i.defer();if(n.Android){var l=["android.permission.WRITE_EXTERNAL_STORAGE","android.permission.MOUNT_UNMOUNT_FILESYSTEMS"];return PermissionsPlugin.addPermissions("权限",function(){},function(){},l),c&&r.show({template:"正在下载,请您稍等..."}),window.resolveLocalFileSystemURI(cordova.file.externalRootDirectory,function(n){n.getDirectory(t,{create:!0,exclusive:!1},function(n){var i=e,l="/sdcard/"+t+"/"+s,d=encodeURI(i),f=new FileTransfer;f.download(d,l,function(e){c&&(o.showLongBottom("文件已下载到SD卡下的"+t+"文件夹内"),r.hide()),u.resolve(l)},function(e){c&&(r.hide(),o.showShortBottom(a.translate("view-form.download-error"))),u.reject(e)},!1,{headers:{Authorization:"BasicdGVzdHVzZXJuYW1lOnRlc3RwYXNzd29yZA=="}})},function(e){c&&(r.hide(),o.showShortBottom(a.translate("view-form.create-error"))),u.reject(e)})}),u.promise}n.IOS};return{downloadFile:s}}]),e.service("jdbc",["$http","$q",function(e,n){var t=this,o={name:"zhongWangOA",version:1,db:null,schema:{2:function(e){e.createObjectStore("syncData",{keyPath:"id",autoIncrement:!0}),e.createObjectStore("jpushData",{keyPath:"id",autoIncrement:!0});var n=e.createObjectStore("TimeData",{keyPath:"id",autoIncrement:!0});n.createIndex("userPkid","userName",{unique:!1})}}},r=n.defer();t.onload=function(e){return r.promise.then(e)};var i=function(e){var t=n.defer();e&&t.resolve(e);var r=window.indexedDB.open(o.name);return r.onerror=function(e){console.log("Open DB Error!"),t.reject("error")},r.onsuccess=function(e){var n=e.target.result;o.db=n,t.resolve(n)},t.promise};t.openDB=function(e,t,r,i){var a=n.defer(),e=e||o.name,t=t||o.version,s=window.indexedDB.open(e,t);return s.onerror=function(e){console.log("Open DB Error!"),a.reject(e)},s.onsuccess=function(e){o.db=e.target.result,r&&r(o.db),a.resolve(e)},s.onupgradeneeded=function(e){o.db=e.target.result,i&&i(o.db),a.resolve("upgradeneeded")},a.promise};var a=function(e){angular.forEach(e,function(e,n,i){t.openDB(o.name,n,function(){r.resolve()},function(n){e(n)})})};return a(o.schema),t.get=function(e,r){var a=n.defer();return i(o.db).then(function(n){var o=n.transaction(e,"readonly"),i=o.objectStore(e),s=i.get(r);s.onsuccess=function(e){t.result=e.target.result,a.resolve()},s.onerror=function(e){a.reject()}}),a.promise},t.find=function(e,t,r){var a=n.defer();return i(o.db).then(function(n){var o=n.transaction(e,"readonly"),i=o.objectStore(e),s=IDBKeyRange.only(r),c=i.index(t).openCursor(s,"next"),u=[];c.onsuccess=function(e){var n=e.target.result;n?(u.push(n.value),n["continue"]()):a.resolve(u)},c.onerror=function(e){a.reject()}}),a.promise},t.put=function(e,t){var r=n.defer(),a=o.db||i(),s=a.transaction(e,"readwrite"),c=s.objectStore(e);return null!==t&&void 0!==t?(c.put(t),r.resolve()):r.reject(),r.promise},t.remove=function(e,t){var r=n.defer(),a=o.db||i(),s=a.transaction(e,"readwrite"),c=s.objectStore(e),u=c["delete"](t);return u.onsuccess=function(e){r.resolve()},u.onerror=function(e){r.reject()},r.promise},t.findAll=function(e){var t=n.defer();return i(o.db).then(function(n){var o=n.transaction(e,"readonly"),r=o.objectStore(e),i=r.openCursor(),a=[];i.onsuccess=function(e){var n=e.target.result;n?(a.push(n.value),n["continue"]()):t.resolve(a)},i.onerror=function(e){t.reject()}}),t.promise},t}]),e.factory("openFileUtils",["$ionicLoading","$cordovaFileOpener2",function(e,n){var t=function(t){PermissionsPlugin.addPermissions("LevelAPI",function(o){if(o<=23){var r=[t];PermissionsPlugin.addPermissions("openPDF",function(){e.hide()},function(){e.hide()},r)}else n.open("file:///"+t,"application/pdf").then(function(){e.hide()},function(n){e.hide()})})};return{openFilePDF:t}}])}();
!function(){"use strict";var e=angular.module("community.controllers.auth",[]);e.factory("userModel",function(){function e(e,t,r,n){this.provider=e,this.userName=t,this.createdAt=r,this.id=n,this.userRole=null,this.CurrentPage=null}return e.prototype.getLoggedInDuration=function(){return(new Date).getTime()-this.createdAt.getTime()},e.prototype.getUserRole=function(){return this.userRole},e.prototype.setUserRole=function(e){this.userRole=e},e.prototype.getCurrentPage=function(){return this.CurrentPage},e.prototype.setCurrentPage=function(e){this.CurrentPage=e},e.prototype.isAdminUser=function(){return"admin"===this.getUserRole()},e.build=function(t){return t?new e(t.provider,t.userName,new Date,t.id):null},e})}();
!function(){"use strict";angular.module("community.controllers.chats",[])}();
!function(){"use strict";var t=angular.module("community.module.viewForm",[]);t.factory("scopeData",function(){function t(t){this.checkFlag=null,this.htmlData=null,this.permissionData=null,this.userRole=null,this.signData=null,this.stateCurrentViewDataName=null,this.stateCurrentViewParams=null,this.longFormEnlargementData=null}return t.prototype.getUserRole=function(){return this.userRole},t.prototype.getHtmlData=function(){return this.htmlData},t.prototype.getPermissionData=function(){return this.permissionData},t.prototype.getSignData=function(){return this.signData},t.prototype.getCheckFlag=function(){return this.checkFlag},t.prototype.getStateCurrentViewDataName=function(){return this.stateCurrentViewDataName},t.prototype.getStateCurrentViewParams=function(){return this.stateCurrentViewParams},t.prototype.getLongFormEnlargementData=function(){return this.longFormEnlargementData},t.prototype.setUserRole=function(t){this.userRole=t},t.prototype.setHtmlData=function(t){this.htmlData=t},t.prototype.setPermissionData=function(t){this.permissionData=t},t.prototype.setSignData=function(t){return this.signData=t},t.prototype.setCheckFlag=function(t){this.checkFlag=t},t.prototype.setStateCurrentViewDataName=function(t){this.stateCurrentViewDataName=t},t.prototype.setStateCurrentViewParams=function(t){this.stateCurrentViewParams=t},t.prototype.setLongFormEnlargementData=function(t){this.longFormEnlargementData=t},t.build=function(e){return e?new t(e):null},t})}();
!function(){"use strict";var t=angular.module("community.routes");t.config(["$stateProvider",function(t){t.state("login",{url:"/login",cache:!1,nativeTransitions:null,templateUrl:"app/auth/templates/login.html",controller:"loginCtrl"}).state("forget",{url:"/forget",nativeTransitions:null,templateUrl:"app/auth/templates/forget-password.html",controller:"forgetCtrl"})}])}();
!function(){"use strict";var e=angular.module("community.routes");e.config(["$stateProvider",function(e){e.state("gesture",{url:"/gesture/:forgetPW/:titleFlag","abstract":!0,cache:!1,nativeTransitions:null,templateUrl:"app/gesture-lock/templates/nav.html",controller:"gestureNavCtrl"}).state("gesture.signInGestureLock",{url:"/signInGestureLock/:paramData/:webType/:username/:titleFlag/:type/:title/:workWaitData",cache:!1,nativeTransitions:null,views:{"":{templateUrl:"app/gesture-lock/templates/unLock.html",controller:"signInGestureLockCtrl"}}}).state("gesture.resetGestureLock",{url:"/resetGestureLock/:titleFlag",cache:!1,nativeTransitions:null,views:{"":{templateUrl:"app/gesture-lock/templates/reset-lock.html",controller:"resetGestureLockCtrl"}}}).state("gesture.setGestureLock",{url:"/setGestureLock/:pwType/:changePwType/:titleFlag/:lockBack",cache:!1,nativeTransitions:null,views:{"":{templateUrl:"app/gesture-lock/templates/set-lock.html",controller:"setGestureLockCtrl"}}})}])}();
!function(){"use strict";var t=angular.module("community.routes");t.config(["$stateProvider",function(t){t.state("tab.view-form",{url:"/view-form/:waitWorkPassDate/:type/:titleName/:notification/:titleFlag/:workWaitData/:enlargement/:information/:notificationDetail/:savereply/:NotificationItem/:requestParam/:workFlag",nativeTransitions:null,views:{"tab-waitWork":{templateUrl:"app/view-form/templates/view-form.html",controller:"viewFormController"}}}).state("tab.form-handle",{url:"/view-form/formHandle/:waitWorkPassDate/:type/:titleFlag/:workWaitData/:notification/:information/:notificationDetail",nativeTransitions:null,views:{"tab-waitWork":{templateUrl:"app/view-form/templates/form-handle.html",controller:"FormHandleController"}}}).state("tab.form-handle-reply",{url:"/view-form/formHandleReply/:waitWorkPassDate/:reply/:title/:type/:titleFlag/:workWaitData/:information/:notification/:NotificationItem/:notificationDetail",nativeTransitions:null,views:{"tab-waitWork":{templateUrl:"app/view-form/templates/form-handle.html",controller:"FormHandleController"}}}).state("tab.form-enlargement",{url:"/view-form/formEnlargement/:waitWorkPassDate/:type/:titleFlag/:workWaitData/:notification/:information/:NotificationItem/:notificationDetail/:subTableLength/:subTablePage",nativeTransitions:null,views:{"tab-waitWork":{templateUrl:"app/view-form/templates/form-enlargement.html",controller:"FormEnlargementCtrl"}}}).state("tab.formWorkAddressList",{url:"/formWorkAddressList/:type/:titleFlag",nativeTransitions:null,views:{"tab-work":{templateUrl:"app/wait-work/templates/wait-work-address-list.html",controller:"AddressListCtrl"}}})}])}();
!function(){"use strict";var t=angular.module("community.routes");t.config(["$stateProvider",function(t){t.state("tab.addressNotification",{url:"/addressNotification/:type",nativeTransitions:null,views:{"tab-addressList":{templateUrl:"app/notification/templates/notification.html",controller:"NotificationCtrl"}}}).state("tab.addressNotificationwork",{url:"/addressNotificationwork/:type",nativeTransitions:null,views:{"tab-addressList":{templateUrl:"app/notification/templates/notification-work.html",controller:"NotificationCtrl"}}})}])}();
!function(){"use strict";var e=angular.module("community.services.auth",[]);e.service("authService",["$timeout","$ionicLoading","$httpParamSerializer","$q","$http","$state","application","storageService","userModel","timeout","serverConfiguration","tempStorageService","mine","$SQLite","$isMobile","$cordovaToast","T","public_constant","$rootScope","GetRequestService","auth_events","APP","$ionicPopup","set_home_page","jdbc",function(e,n,t,o,i,r,s,a,u,l,c,d,f,g,p,v,m,h,P,S,b,w,I,T,A){function L(){var e=a.getObject(E,null);e&&j(e)}function j(e){if(angular.isArray(e)){var n=!1;angular.forEach(e,function(e,t){"role_approval"==angular.lowercase(e)&&(n=!0)}),F=n}O=e}function y(){O=void 0,_="",U="";var e=a.get(T.requestTimeDbKey,null);a.clearAll(),a.set(T.requestTimeDbKey,e)}var O,M,C,E="userInfo",x="userLogin",U="",_="",F=!1;P.$on(h.responseError400,function(){s.hideLoading(),e.cancel(C)});var R=function(e,n){var t=o.defer();return p.Android&&w.notificationFlag?PermissionsPlugin.addPermissions("isNotificationEnabled",function(o){if("opened"==o)q(e,n,t);else if("closed"==o){var i=I.confirm({title:m.translate("publicMsg.popTitle"),template:m.translate("publicMsg.notificationAlert"),cancelText:m.translate("publicMsg.cancel"),cancelType:"button-assertive",okText:m.translate("publicMsg.sure"),okType:"button-positive"});i.then(function(o){o?PermissionsPlugin.addPermissions("notificationSet",null,null,null):q(e,n,t)})}},null,null):q(e,n,t),t.promise},q=function(n,t,o){a.set(b.loginEnglishName,n),C=e(function(){p.isPC||v.showShortBottom(m.translate("publicMsg.timeOutAlert"))},l.timeOut),s.showLoading(!0),e(function(){s.hideLoading()},l.max);var i="username="+n+"&password="+t,r=encodeURI(i,"UTF-8");$.ajax({method:"POST",url:c.SSOUrl+"/cas/v1/tickets?service=http://www.baidu.com",data:r,headers:{"Content-Type":"application/x-www-form-urlencoded"},responseType:"text",success:function(n){if(console.log(n),e.cancel(C),s.hideLoading(),""!==n){console.log(n);var t=n.split('"'),i=t[3],r=new DOMParser,a=r.parseFromString(n,"text/html"),i=a.getElementsByTagName("form")[0].action;console.log(o),o.resolve(i)}else o.reject("Login Failed.")},error:function(n){e.cancel(C),s.hideLoading(),o.reject(n)}})},D=function(){d.set(f.jPushId,a.get(f.jPushId,null)),y(),r.go("login",{},{reload:!0})},N=function(e){var n=o.defer(),t=a.get(f.jPushId,null);if(null==t||"null"==t)t=d.get(f.jPushId,null),console.log(t),p.Android?g.ready(function(){return this.selectFirst("SELECT * FROM jPush WHERE id = 1 LIMIT 1").then(function(){w.devMode&&console.log("Empty Result!");var t={userCode:e};k(t,n)},function(){w.devMode&&console.err("Error!")},function(o){if(t=o.item.pushId,null!=t||"null"!==t)var i={userCode:e,notificationId:t};return k(i,n),o.item})}):A.findAll("jpushData").then(function(t){if(t&&t.length>0){var o={userCode:e,notificationId:t[0].pushid};k(o,n)}else{var o={userCode:e};k(o,n)}});else{var i={userCode:e,notificationId:t};k(i,n)}return n.promise},k=function(e,n){var o="PC";p.Android?o="Android":p.IOS&&(o="IOS"),e.platform=o;var i=c.baseApiUrl+"app/common/v3/getNecessaryInfo",r=a.get("versionCount",1);e.count=parseInt(r);var s=t(e);S.getRequestDataJson(i,s,!0,"POST","application/x-www-form-urlencoded").then(function(e){console.log(e),a.set(b.followed,e.followed),a.set(b.roleList,e.roleList),a.set(f.approveSwitchKey,"1"===e.signature),n.resolve(e)},function(e){n.reject(e)})},K=function(e){return angular.isArray(e)||(e=[e]),is_authenticated&&e.indexOf(role)!==-1};return L(),{login:R,getUserId:N,logout:D,isAuthorized:K,loadUserLogin:function(){var e=a.getObject(x,null);return e},storeUserLogin:function(e,n,t,o){var i={};i.name=e,i.pw=n,i.save=t,i.auto=o,a.setObject(x,i)},isApprovel:function(){return F},isAuthenticated:function(){return is_authenticated},loginName:function(){return _},userPkid:function(){return U},role:function(){return O},userPost:function(){return M}}}])}();
!function(){"use strict";var a=angular.module("community.services.chats",[]);a.factory("Chats",function(){var a=[{id:0,name:"Ben Sparrow",lastText:"You on your way?",face:"app/chats/img/ben.png"},{id:1,name:"Max Lynx",lastText:"Hey, it's me",face:"app/chats/img/max.png"},{id:2,name:"Adam Bradleyson",lastText:"I should buy a boat",face:"app/chats/img/adam.jpg"},{id:3,name:"Perry Governor",lastText:"Look at my mukluks!",face:"app/chats/img/perry.png"},{id:4,name:"Mike Harrington",lastText:"This is wicked good ice cream.",face:"app/chats/img/mike.png"}];return{all:function(){return a},remove:function(e){a.splice(a.indexOf(e),1)},get:function(e){for(var n=0;n<a.length;n++)if(a[n].id===parseInt(e))return a[n];return null}}})}();
angular.module("community.configs",[]).constant("baseConfiguration",{url:"https://www.example.com",debug:!1}).constant("APP",{devMode:!1,VPNFlag:!0,forgetPwFlag:!0,notificationFlag:!1}).constant("serverConfiguration",{baseApiUrl:"http://172.16.9.23:8080/",SSOUrl:"http://172.16.9.23:9090",domain:"http://172.16.9.23:8080",webSocket:"ws://172.16.9.23:8080/sys/webSocketServer"});
!function(){"use strict";var t=angular.module("community.services.gestureLock",[]);t.factory("gestureLockService",function(){return{getPassword:function(){return JSON.parse(window.localStorage.getItem("GestureLockPassword"))},setPassword:function(t){window.localStorage.setItem("GestureLockPassword",JSON.stringify(t))}}}),t.factory("$gestureLock",function(){function t(t,i){"function"==typeof t.gestureStart&&t.gestureStart.call(t,i);for(var e=h(i),n=0;n<t.activityPoints.length;n++)if(Math.abs(e.x-t.activityPoints[n].x)<t.radii&&Math.abs(e.y-t.activityPoints[n].y)<t.radii){t.cipherPoints.push(t.activityPoints[n]),t.activityPoints.splice(n,1),s(t.context2d,t.cipherPoints,t.config["default"].lineWidth,t.config["default"].lineStrokeStyle),c(t.context2d,t.cipherPoints,t.radii/2,t.config["default"].pointStrokeStyle);break}}function i(t,i){"function"==typeof t.gestureChange&&t.gestureChange.call(t,i);for(var e=h(i),n=0;n<t.activityPoints.length;n++)if(Math.abs(e.x-t.activityPoints[n].x)<t.radii&&Math.abs(e.y-t.activityPoints[n].y)<t.radii){t.cipherPoints.push(t.activityPoints[n]),t.activityPoints.splice(n,1),"function"==typeof t.gesturePointChange&&t.gesturePointChange.call(t,i);break}t.context2d.clearRect(0,0,t.canvas.width,t.canvas.height),r(t.context2d,t.originalPoints,t.radii,t.config["default"].ringWidth,t.config["default"].ringStrokeStyle),s(t.context2d,t.cipherPoints.concat(e),t.config["default"].lineWidth,t.config["default"].lineStrokeStyle),c(t.context2d,t.cipherPoints,t.radii/2,t.config["default"].pointStrokeStyle)}function e(t,i){t.context2d.clearRect(0,0,t.canvas.width,t.canvas.height),r(t.context2d,t.originalPoints,t.radii,t.config["default"].ringWidth,t.config["default"].ringStrokeStyle),s(t.context2d,t.cipherPoints,t.config["default"].lineWidth,t.config["default"].lineStrokeStyle),c(t.context2d,t.cipherPoints,t.radii/2,t.config["default"].pointStrokeStyle),"function"==typeof t.gestureEnd&&t.gestureEnd.call(t,i)}function n(t){t.preventDefault()}var o=function(t,i,e,n,o){t.strokeStyle=o,t.lineWidth=n,t.beginPath(),t.arc(i.x,i.y,e,0,2*Math.PI,!0),t.closePath(),t.stroke()},r=function(t,i,e,n,r){for(var a=0,c=i.length;a<c;a++)o(t,i[a],e,n,r)},a=function(t,i,e,n){t.fillStyle=n,t.beginPath(),t.arc(i.x,i.y,e,0,2*Math.PI,!0),t.closePath(),t.fill()},c=function(t,i,e,n){for(var o=0,r=i.length;o<r;o++)a(t,i[o],e,n)},s=function(t,i,e,n){t.strokeStyle=n,t.lineWidth=e,t.beginPath();for(var o=0,r=i.length;o<r;o++)o>0?t.lineTo(i[o].x,i[o].y):t.moveTo(i[0].x,i[0].y);t.stroke(),t.closePath()},h=function(t){var i=t.currentTarget.getBoundingClientRect();return{x:t.touches[0].clientX-i.left,y:t.touches[0].clientY-i.top}},d=function(t,i){var e={success:{lineWidth:3,lineStrokeStyle:"#5cb85c",ringWidth:2,ringStrokeStyle:"#5cb85c",pointStrokeStyle:"#5cb85c"},error:{lineWidth:3,lineStrokeStyle:"#d9534f",ringWidth:2,ringStrokeStyle:"#d9534f",pointStrokeStyle:"#d9534f"},warning:{lineWidth:3,lineStrokeStyle:"#f0ad4e",ringWidth:2,ringStrokeStyle:"#f0ad4e",pointStrokeStyle:"#f0ad4e"},"default":{lineWidth:3,lineStrokeStyle:"#5bc0de",ringWidth:2,ringStrokeStyle:"#5bc0de",pointStrokeStyle:"#5bc0de"},matrix:3};this.gestureStart=void 0,this.gestureChange=void 0,this.gesturePointChange=void 0,this.gestureEnd=void 0,this.config=angular.extend(e,i||{}),this.touchFlag=!1,this.disabled=!1,this.radii=0,this.cipherPoints=[],this.activityPoints=[],this.originalPoints=[],this.canvas=t,this.context2d=t.getContext("2d"),l(this)},l=function(o){document.body.addEventListener("touchmove",n,!1),o.canvas.addEventListener("touchstart",function(i){i.preventDefault(),o.touchFlag||o.disabled||(o.touchFlag=!0,o.disabled=!0,t(o,i))},!1),o.canvas.addEventListener("touchmove",function(t){o.touchFlag&&i(o,t)},!1),o.canvas.addEventListener("touchend",function(t){o.touchFlag&&(e(o,t),o.touchFlag=!1)},!1)};return d.prototype.init=function(){var t=this.config.matrix,i=0;this.radii=this.canvas.width/(4*t),this.originalPoints=[];for(var e=0,n=t;e<n;e++)for(var o=0,r=t;o<r;o++){i++;var a={x:4*o*this.radii+2*this.radii,y:4*e*this.radii+2*this.radii,index:i};this.originalPoints.push(a)}return this.reset(),this},d.prototype.reset=function(){this.activityPoints=[].concat(this.originalPoints),this.cipherPoints=[],this.context2d.clearRect(0,0,this.canvas.width,this.canvas.height),r(this.context2d,this.originalPoints,this.radii,this.config["default"].ringWidth,this.config["default"].ringStrokeStyle),this.disabled=!1},d.prototype.viewStatus=function(t,i){var e={ring:!0,line:!1,point:!1};e=angular.extend(e,i),e.ring&&r(this.context2d,this.cipherPoints,this.radii,this.config[t].ringWidth,this.config[t].ringStrokeStyle),e.line&&s(this.context2d,this.cipherPoints,this.config[t].lineWidth,this.config[t].lineStrokeStyle),e.point&&c(this.context2d,this.cipherPoints,this.radii/2,this.config[t].pointStrokeStyle)},d.prototype.getGesturePassword=function(){return this.cipherPoints.map(function(t){return t.index})},d.prototype.validatePassword=function(t,i){var e=!0;if(!t||!i)return!1;if(t.length!=i.length)return!1;for(var n=0,o=t.length;n<o;n++)if(t[n]!==i[n]){e=!1;break}return e},d.prototype.destructor=function(){document.body.removeEventListener("touchmove",n,!1)},d}),t.service("GestureLockService",["$q","$http","$ionicLoading","$timeout","T","$cordovaToast","timeout","$httpParamSerializer",function(t,i,e,n,o,r,a,c){var s=function(o,r){e.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),n(function(){e.hide()},a.max);var s=t.defer();return i({method:"POST",url:o,data:c(r),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(t){s.resolve(t),e.hide()}).error(function(t){s.reject(t),e.hide()}),s.promise},h=function(o,r){e.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),n(function(){e.hide()},a.max);var s=t.defer();return i({method:"POST",url:o,data:c(r),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(t){s.resolve(t),e.hide()}).error(function(t){s.reject(t),e.hide()}),s.promise};return{setGestureLock:s,changeGestureLock:h}}])}();
!function(){"use strict";var t=angular.module("community.routes");t.config(["$stateProvider",function(t){t.state("tab.notification-item",{url:"/notification-item/:titleFlag/:information",views:{"tab-information":{templateUrl:"app/notification/templates/notification.html",controller:"NotificationCtrl"}}})}])}();

!function(){"use strict";var t=angular.module("community.routes");t.config(["$stateProvider",function(t){t.state("tab.mineDetails",{url:"/mineDetails",nativeTransitions:null,views:{"tab-mine":{templateUrl:"app/mine/templates/my-details.html",controller:"MineDetailsCtrl"}}}).state("tab.homePageSet",{url:"/homePageSet",nativeTransitions:null,views:{"tab-mine":{templateUrl:"app/mine/templates/home-page-set.html",controller:"HomePageSetCtrl"}}}).state("tab.billSet",{url:"/billSet",nativeTransitions:null,views:{"tab-mine":{templateUrl:"app/mine/templates/set-bill.html",controller:"BillSetCtrl"}}}).state("tab.signatureWay",{url:"/signatureWay",nativeTransitions:null,views:{"tab-mine":{templateUrl:"app/mine/templates/signature-way.html",controller:"SignatureWayCtrl"}}}).state("tab.setPassword",{url:"/setPassword/:pwType",nativeTransitions:null,cache:!1,views:{"tab-mine":{templateUrl:"app/mine/templates/set-password.html",controller:"SetPasswordCtrl"}}}).state("tab.mineNotification",{url:"/mineNotification/:type",nativeTransitions:null,views:{"tab-mine":{templateUrl:"app/notification/templates/notification.html",controller:"NotificationCtrl"}}}).state("tab.mineWorkNotification",{url:"/mineWorkNotification/:type",nativeTransitions:null,views:{"tab-mine":{templateUrl:"app/notification/templates/notification-work.html"}}}).state("tab.authPassword",{url:"/authPassword",nativeTransitions:null,views:{"tab-mine":{templateUrl:"app/mine/templates/auth-password.html"}}}).state("tab.mineAboutSystem",{url:"/mineAboutSystem/:systemData",nativeTransitions:null,views:{"tab-mine":{templateUrl:"app/mine/templates/about-system.html",controller:"AboutSystemCtrl"}}}).state("tab.mineOtherWaitWork",{url:"/myWorkWaitWork/:titleName/:typeId/:workFlag/:searchDataStr/:searchWorkFlag/:condition/:titleFlag/:workWaitData/:custom/:viewOtherWaitWork/:todoUserCode",nativeTransitions:null,views:{"tab-mine":{templateUrl:"app/wait-work/templates/tab-wait-work.html",controller:"WaitWorkCtrl"}}})}])}();
!function(){"use strict";var e=angular.module("starter.services.mine",[]);e.service("MineService",["$q","$http","$ionicLoading","$timeout","T","$cordovaToast","timeout","$httpParamSerializer",function(e,n,o,r,t,i,a,c){var d=function(t,i){o.show({content:"Loading",animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0}),r(function(){o.hide()},a.max);var d=e.defer();return n({method:"POST",url:t,data:c(i),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){d.resolve(e),o.hide()}).error(function(e){d.reject(e),o.hide()}),d.promise},u=function(o,t,i){i&&(application.showLoading(!0),r(function(){application.hideLoading()},a.max));var c=e.defer();return n({method:"POST",url:o,data:t,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var n=[];for(var o in e)n.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return n.join("&")}}).success(function(e){c.resolve(e),i&&application.hideLoading()}).error(function(e){c.reject(e),i&&application.hideLoading()}),c.promise},s=function(o,r,t){var i=e.defer();return n({method:"GET",url:o,params:r,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise};return{getMineData:d,uploadAvatar:u,getOtherTodoCtl:s}}])}();
!function(){"use strict";var t=angular.module("community.routes");t.config(["$stateProvider",function(t){t.state("tab.notification",{url:"/notification/:titleFlag/:type/:backFlag",views:{"tab-waitWork":{templateUrl:"app/notification/templates/notification.html",controller:"NotificationCtrl"}}}).state("tab.notification-work",{url:"/notification-work/:titleFlag/:NotificationItem/:type/:information/:savereply/:enlargement",views:{"tab-waitWork":{templateUrl:"app/notification/templates/notification-work.html",controller:"NotificationWorkCtrl"}}})}])}();
!function(){"use strict";var i=angular.module("starter.services.notification",[]);i.service("NotificationService",["$q","$http","$ionicLoading","$timeout","T","$cordovaToast","timeout","$httpParamSerializer","application",function(i,t,e,o,r,n,a,c,u){var d=function(r,n,d){d&&(u.showLoading(!0),o(function(){u.hideLoading()},a.max));var s=i.defer();return t({method:"POST",url:r,data:c(n),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(i){s.resolve(i),e.hide()}).error(function(i){s.reject(i),e.hide()}),s.promise};return{getNotificationData:d}}])}();
!function(){"use strict";var e=angular.module("community.services.viewForm",[]);e.service("viewFormService",["$q","$http","$ionicLoading","$timeout","application","timeout","$httpParamSerializer","$isMobile","T","$cordovaToast","scopeData","storageService","auth_events",function(e,o,r,t,n,i,a,c,u,s,d,f,m){var v=function(o,r,a,c){a&&(n.showLoading(!0),t(function(){n.hideLoading()},i.max));var u=e.defer(),s=f.get(m.authorization,null),d=f.get(m.userId,null);return $.ajax({method:c?c:"POST",url:o,data:r,headers:{Authorization:s,User_Pkid:d},success:function(e){u.resolve("object"==typeof e?e:JSON.parse(e)),a&&n.hideLoading()},error:function(e){u.reject("object"==typeof e?e:JSON.parse(e)),a&&n.hideLoading()}}),u.promise},l=function(r,a,c){c&&(n.showLoading(!0),t(function(){n.hideLoading()},i.max));var u=e.defer();return o({method:"POST",url:r,data:a,headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){var o=[];for(var r in e)o.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return o.join("&")}}).success(function(e){u.resolve(e),c&&n.hideLoading()}).error(function(e){u.reject(e),c&&n.hideLoading()}),u.promise},h=function(e,o){var r=!0;if(!e)return r;try{var t=angular.element('ion-nav-view[nav-view="active"]').find('ion-view[nav-view="active"] form');e.custForm=t[0],Object.keys(e.custForm).forEach(function(o){if(0==o.indexOf("jQuery")){var t=e.custForm[o];do t.$formController&&(r=t.$formController.$valid),t=t.$$nextSibling;while(t)}})}catch(i){r=!1}return r||(n.hideLoading(),c.isPC?alert(u.translate("view-form.form-error")):s.showShortBottom(u.translate("view-form.form-error"))),e.custForm=null,r};return{getViewFormData:v,uploadData:l,form_check:h}}])}();
!function(){"use strict";var t=angular.module("community.routes");t.config(["$stateProvider",function(t){t.state("tab.waitWorkStart",{url:"/waitWork",nativeTransitions:null,views:{"tab-waitWork":{templateUrl:"app/wait-work/templates/tab-wait-work.html",controller:"WaitWorkCtrl"}}}).state("tab.sizer",{url:"/sizer/:titleFlag/:mapList",nativeTransitions:null,views:{"tab-waitWork":{templateUrl:"app/wait-work/templates/wait-work-sizer.html",controller:"SizerCtrl"}}}).state("tab.search",{url:"/search/:titleFlag",nativeTransitions:null,cache:!1,views:{"tab-waitWork":{templateUrl:"app/wait-work/templates/wait-work-search.html",controller:"SearchCtrl"}}})}])}();
!function(){"use strict";var o=angular.module("starter.services.wait.work",[]);o.service("WaitWorkListService",["$q","$http","$ionicLoading","$timeout","application","timeout","$rootScope","T","$isMobile","$cordovaToast",function(o,t,i,r,e,n,a,u,c,s){a.waitWorkCount=0;var l=function(i,l,d){if(d){var w=r(function(){console.log("FROM: "+i),a.waitWorkCount--,c.isPC||s.showShortBottom(u.translate("publicMsg.timeOutAlert"))},n.timeOut);e.showLoading(!0),a.waitWorkCount++,r(function(){e.hideLoading()},n.max)}var W=o.defer();return t({method:"POST",url:i,params:l}).success(function(o){console.log(a.waitWorkCount,d),W.resolve(o),d&&(a.waitWorkCount--,0===a.waitWorkCount&&e.hideLoading(),r.cancel(w))}).error(function(o){W.reject(o),d&&(a.waitWorkCount--,0===a.waitWorkCount&&e.hideLoading(),r.cancel(w))}),W.promise};return{getWaitWorkListData:l}}])}();
!function(){"use strict";var t=angular.module("community.routes");t.config(["$stateProvider",function(t){t.state("tab.matter",{url:"/matter",nativeTransitions:null,views:{"tab-work":{templateUrl:"app/work/templates/my-work-new-matter.html",controller:"newMatterCtrl"}}}).state("tab.synergy",{url:"/synergy",nativeTransitions:null,views:{"tab-work":{templateUrl:"app/work/templates/my-work-new-synergy.html",controller:"newSynergyCtrl"}}}).state("tab.waitNews",{url:"/waitNews/:titleName/:typeId/:workFlag/:searchDataStr/:searchWorkFlag/:searchTitle/:titleFlag",nativeTransitions:null,views:{"tab-work":{templateUrl:"app/work/templates/my-work-matter-list.html",controller:"WaitNewsCtrl"}}}).state("tab.doneWork",{url:"/doneWork/:titleName/:typeId/:workFlag/:searchDataStr/:searchWorkFlag/:searchTitle/:titleFlag",nativeTransitions:null,views:{"tab-work":{templateUrl:"app/work/templates/my-work-done-work.html",controller:"WaitNewsCtrl"}}}).state("tab.myWorkWaitWork",{url:"/myWorkWaitWork/:titleName/:typeId/:workFlag/:searchDataStr/:searchWorkFlag/:condition/:titleFlag/:workWaitData/:custom/:viewOtherWaitWork/:todoUserCode",nativeTransitions:null,views:{"tab-waitWork":{templateUrl:"app/wait-work/templates/tab-wait-work.html",controller:"WaitWorkCtrl"}}}).state("tab.myWorkSizer",{url:"/myWorkSizer/:titleName/:titleFlag/:workFlag",nativeTransitions:null,cache:!1,views:{"tab-work":{templateUrl:"app/wait-work/templates/wait-work-sizer.html",controller:"SizerCtrl"}}}).state("tab.searchWork",{url:"/searchWork/:workFlag/:titleName/:titleFlag/:condition/:typeId/:viewOtherWaitWork/:todoUserCode",nativeTransitions:null,views:{"tab-work":{templateUrl:"app/wait-work/templates/wait-work-search.html",controller:"SearchCtrl"}}}).state("tab.viewFormWork",{url:"/viewFormWork/:type/:titleName/:imgFlag/:waitWorkPassDate/:searchWorkFlag/:notification/:titleFlag/:workWaitData",nativeTransitions:null,views:{"tab-work":{templateUrl:"app/view-form/templates/view-form.html",controller:"viewFormController"}}}).state("tab.formHandleWork",{url:"/formHandleWork/:type/:titleFlag",nativeTransitions:null,views:{"tab-work":{templateUrl:"app/view-form/templates/form-handle.html",controller:"FormHandleController"}}}).state("tab.workAddressList",{url:"/workAddressList/:titleFlag",nativeTransitions:null,views:{"tab-work":{templateUrl:"app/wait-work/templates/wait-work-address-list.html",controller:"AddressListCtrl"}}}).state("tab.workNotification",{url:"/workNotification/:type/:titleFlag",nativeTransitions:null,views:{"tab-work":{templateUrl:"app/notification/templates/notification.html",controller:"NotificationCtrl"}}}).state("tab.work-form-enlargement",{url:"/view-form/formEnlargement/:type/:titleFlag/:workWaitData/:waitWorkPassDate/:notification/:information/:NotificationItem/:notificationDetail",nativeTransitions:null,views:{"tab-work":{templateUrl:"app/view-form/templates/form-enlargement.html",controller:"FormEnlargementCtrl"}}})}])}();
!function(){"use strict";var e=angular.module("starter.services.work.home",[]);e.service("WaitHomeService",["$q","$http","$ionicLoading","$timeout","application","timeout",function(e,i,a,t,n,r){var o=function(a,o,d,m){d&&(n.showLoading(!0),t(function(){n.hideLoading()},r.max));var s=e.defer();return i({method:m?m:"POST",url:a,params:o}).success(function(e){s.resolve(e),d&&n.hideLoading()}).error(function(e){s.reject(e),d&&n.hideLoading()}),s.promise};return{getWaitWorkListData:o,getVirtualData:{list:[{id:"10000003330043",name:"财务审批"},{id:"10000000070035",name:"人事审批"},{id:"10000000070037",name:"采购审批"},{id:"10000000070034",name:"其他审批"}],alreadyList:[{id:"10000003330043",name:"财务审批"},{id:"10000000070035",name:"人事审批"},{id:"10000000070037",name:"采购审批"},{id:"10000000070034",name:"其他审批"}]}}}])}();
!function(){"use strict";var t=angular.module("starter.controllers.addressListCtrl",[]);t.controller("AddressListCtrl",["$scope","$state","$rootScope","$ionicNativeTransitions","$stateParams","stateGoHelp",function(t,a,e,i,s,o){t.checkFlag=!1,t.choiceBox=function(t){this.checkFlag=!this.checkFlag};t.toSwitchover=function(a){"headquarters"==a?t.tableFlag="headquarters":"finance"==a?t.tableFlag="finance":"administration"==a?t.tableFlag="administration":"produce"==a&&(t.tableFlag="produce")},t.goAddressNotification=function(){o.stateGoUtils(!0,"tab.addressNotification",{type:"addressList"},"right")}}])}();
!function(){"use strict";var e=angular.module("community.controllers.auth");e.controller("forgetCtrl",["$scope","$ionicPopup","T","$isMobile",function(e,o,n,t){e.phone=n.translate("publicMsg.forgetPasswordPhone"),e.tel=function(){if(t.IOS)if(device.version.split(".")[0]<10||10==device.version.split(".")[0]&&device.version.split(".")[1]<=1){var n=o.confirm({title:"提示",template:"<div>确定拨打{{phone}}？</div>",cancelText:"取消",cancelType:"button-assertive",okText:"确定",okType:"button-positive",scope:e});n.then(function(o){o?window.open("tel:"+e.phone,"_system","location=yes"):null})}else window.open("tel:"+e.phone,"_system","location=yes");else t.Android&&window.open("tel:"+e.phone)}}])}();
!function(){"use strict";var t=angular.module("community.controllers.auth");t.controller("loginCtrl",["$scope","$ionicHistory","$ionicPopup","T","$state","$rootScope","$isMobile","$ionicNativeTransitions","authService","storageService","auth_events","set_home_page","md5","mine","$ionicScrollDelegate","$timeout","APP","versionUpdate","GetRequestService","serverConfiguration","stateGoHelp","mobileSocket","DBSingleInstance","$cordovaToast","application",function(t,e,a,n,o,r,i,s,l,u,d,c,p,f,g,h,m,w,v,T,k,y,P,b,I){function S(t){if(i.isPC)U();else{20===t&&alert("插件加载失败，请稍后重试！");try{w.getVersionInfo(!0).then(function(t){G(t,!0)},function(){U()})["catch"](function(t){alert(JSON.stringify(t)+"promise error")})}catch(e){setTimeout(function(){S(++t)},200)}}}function G(e,n){if(null!=e.description?t.descriptionArr=e.description.split("\n"):t.descriptionArr="无",e.mustUpdate){var o=a.alert({title:"更新提示",template:'<div ng-repeat="item in descriptionArr"><p>{{item}}</p></div>',okText:"确定",okType:"button-positive",scope:t});o.then(function(a){a?w.upDateVersion(e):(t.needUpdate=!1,n?U():$())})}else if(e.shouldUpdate){var o=a.confirm({title:"更新提示",template:'<div ng-repeat="item in descriptionArr"><p>{{item}}</p></div>',cancelText:"取消",cancelType:"button-assertive",okText:"确定",okType:"button-positive",scope:t});o.then(function(a){a?w.upDateVersion(e):(t.needUpdate=!1,n?U():$())})}else n?U():$()}function U(){var e=l.loadUserLogin();if(null!=e)if(1==e.save)if(t.data.username=e.name,t.data.password=e.pw,e.auto){var o=u.get(f.gestureLockKey,"false");"true"==o?k.stateGoUtils(!0,"gesture.signInGestureLock",{username:t.data.username,forgetPW:"forgetPW"},"right"):l.login(t.data.username,p.createHash(t.data.password)).then(function(t){D(t)},function(t){a.alert({title:n.translate("auth.login-err"),template:n.translate("auth.password-or-name-err")})})}else t.data.autoGetToken=!1;else t.data.savePassword=!1,t.data.autoGetToken=!1}function $(){if("none"===navigator.connection.type){a.alert({title:n.translate("auth.login-err"),template:n.translate("auth.noNetwork")});return!1}if(t.data.username.length>0&&t.data.password.length>0)l.login(t.data.username,p.createHash(t.data.password)).then(function(t){D(t)},function(t){a.alert({title:n.translate("auth.login-err"),template:n.translate("auth.password-or-name-err")})});else if(0==t.data.username.length){a.alert({title:n.translate("auth.login-err"),template:n.translate("auth.login-name-null")})}else if(0==t.data.password.length){a.alert({title:n.translate("auth.login-err"),template:n.translate("auth.password-null")})}}function D(e){var r="123";return void l.getUserId(t.data.username).then(function(e){var a=e.name;u.set(d.name,a),u.set(d.inputName,t.data.username),u.set(d.token,r),u.set(d.userId,e.account),u.set(d.authorization,e.authorization),m.devMode&&(console.log("获取存储Token值"+u.get(d.token,null)),console.log("获取存储userId值"+u.get(d.userId,null))),y.connect(),l.storeUserLogin(t.data.username,t.data.password,t.data.savePassword,t.data.autoGetToken);var n=u.get(c.setHomeKey,null),i="tab.work";if(null==n||n==c.work?i="tab.work":n==c.waitWork?i="tab.waitWork":n==c.information?i="tab.information":n==c.mine&&(i="tab.mine"),!window.indexedDB&&null==u.get(c.requestTimeDbKey,null)){var s=P.getTimeDb();s.transaction(function(t){t.executeSql("DELETE FROM TimeData",[],function(t,e){u.set(c.requestTimeDbKey,"haveRequestDb")},function(t,e){})})}o.go(i,{},{reload:!0})},function(t){alert(e),a.alert({title:n.translate("auth.login-err"),template:n.translate("publicMsg.necessary-info-err")})})}I.hideLoading(),t.IosTop=!1,i.IOS&&(t.IosTop=!0),i.Android?t.isWhich=!0:i.IOS&&(t.isWhich=!1),i.Android?(t.isWhich=!0,document.getElementById("isContentHide").style.width=""):i.IOS&&(t.isWhich=!1,document.getElementById("isContentHide").style.width="0"),t.needUpdate=!0,t.showTop=!1,t.isShowforgetPw=m.forgetPwFlag;var A=g.$getByHandle("loginScroll");t.$on("$ionicView.afterEnter",function(){var e=l.loadUserLogin();null!=e&&1==e.save&&(t.data.username=e.name,t.data.password=e.pw),e.auto&&S(0)}),t.data={username:"",password:""},t.data.savePassword=!0,t.data.autoGetToken=!0,t.login=function(){if(!i.isPC&&"none"===navigator.connection.type)return b.showShortBottom(n.translate("publicMsg.noNetwork")),!1;if(t.data.username.length>0&&t.data.password.length>0)i.isPC?$():t.needUpdate?w.getVersionInfo().then(function(t){G(t,!1)},function(t){$()}):$();else if(0==t.data.username.length){a.alert({title:n.translate("auth.login-err"),template:n.translate("auth.login-name-null")})}else if(0==t.data.password.length){a.alert({title:n.translate("auth.login-err"),template:n.translate("auth.password-null")})}},t.forget=function(){k.stateGoUtils(!0,"forget",{},"right")},t.savePassword=function(){t.data.savePassword=!t.data.savePassword,t.data.autoGetToken&&!t.data.savePassword&&(t.data.autoGetToken=!1)},t.autoGetToken=function(){t.data.autoGetToken=!t.data.autoGetToken,t.data.savePassword=!0},t.clearName=function(){t.data.username=""},t.clearPW=function(){t.data.password=""},t.topChange=function(){i.Android&&(t.showTop=!0)},window.addEventListener("native.keyboardshow",function(e){i.Android&&(t.showTop=!0,h(function(){A.scrollBottom()},0))}),window.addEventListener("native.keyboardhide",function(e){i.Android?(t.showTop=!1,h(function(){A.scrollBottom()},0)):i.IOS&&h(function(){A.scrollTop()},0)}),t.okKeyup=function(e){var o=window.event?e.keyCode:e.white;if(13==o)if(t.data.username.length>0&&t.data.password.length>0)i.isPC?$():t.needUpdate?w.getVersionInfo().then(function(t){G(t,!1)},function(t){$()}):$();else if(0==t.data.username.length){a.alert({title:n.translate("auth.login-err"),template:n.translate("auth.login-name-null")})}else if(0==t.data.password.length){a.alert({title:n.translate("auth.login-err"),template:n.translate("auth.password-null")})}}}])}();
!function(){"use strict";var t=angular.module("community.controllers.chats");t.controller("ChatDetailController",["$scope","$stateParams","Chats",function(t,a,o){t.chat=o.get(a.chatId)}])}();
!function(){"use strict";var o=angular.module("community.controllers.chats");o.controller("ChatsController",["$scope","Chats",function(o,t){o.chats=t.all(),o.remove=function(o){t.remove(o)}}])}();
!function(){"use strict";var o=angular.module("community.controllers.gestureLock",[]);o.controller("gestureLockCtrl",["$scope","$rootScope",function(o,e){e.hideTabs=!0,e.bell=!1}])}();
!function(){"use strict";var e=angular.module("community.controllers.gestureLock");e.controller("gestureNavCtrl",["$scope","$state","$gestureLock","authService","$rootScope","auth_events","storageService","$stateParams","serverConfiguration","GetRequestService","$isMobile","$cordovaToast","T","DBSingleInstance",function(e,t,o,n,r,i,a,s,c,u,l,g,h,d){r.hideTabs=!0,r.bell=!1,e.showForgetPW=!1;var f=s.forgetPW;e.$on("$ionicView.beforeEnter",function(e,t){t.enableBack=!0}),e.personInfo={},e.personInfo.name=a.get(i.name,null),"forgetPW"===f&&(e.showForgetPW=!0),e.resetPassword=function(){var e=document.getElementById("gestureLock");e.width=window.innerWidth<window.innerHeight-200?window.innerWidth:window.innerHeight-200,e.height=e.width;var t=new o(e,{matrix:3}),r=c.baseApiUrl+"app/common/v1/logout",s={account:a.get(i.userId,null)};u.getRequestData(r,s,!0,"POST").then(function(e){if(0==e.state){var o=d.getSyncDb();o.transaction(function(e){e.executeSql("delete from SyncData",[],function(e,t){},function(e,t){})}),t.destructor(),n.logout()}else l.isPC||g.showShortBottom(h.translate("mine.logout-error"))},function(e){l.isPC||g.showShortBottom(h.translate("mine.logout-error"))})}}])}();
!function(){"use strict";var e=angular.module("community.controllers.gestureLock");e.controller("resetGestureLockCtrl",["$scope","$state","$gestureLock","$timeout","gestureLockService","$window","storageService","mine","$rootScope","$ionicNativeTransitions","serverConfiguration","auth_events","GestureLockService","timeout","stateGoHelp",function(e,t,i,n,r,s,o,u,a,c,w,d,l,g,f){a.hideTabs=!0,a.bell=!1,a.toBack=!0,e.$on("$ionicView.beforeEnter",function(e,t){t.enableBack=!0});var v=r.getPassword(),h=!1;e.title="绘制图案设置锁";var m=[2],S=1,k=document.getElementById("gestureLock");k.width=window.innerWidth<window.innerHeight-200?window.innerWidth:window.innerHeight-200,k.height=k.width;var G=new i(k,{matrix:3});h||(e.title="请输入原密码"),G.gestureEnd=function(t){if(h)if(m[S%2]=G.getGesturePassword(),m[S%2].length>=3){if(S%2===1)G.viewStatus("success",{ring:!0}),e.title="请再输入一次",n(function(){G.reset()},500);else if(S%2===0)if(G.validatePassword(m[0],m[1])){G.viewStatus("success",{ring:!0}),r.setPassword(m[0]);var i=w.baseApiUrl+"app/common/v1/setGesturePassword",s={account:o.get(d.userId,null),flagType:0,gesturePwd:r.getPassword()};l.setGestureLock(i,s).then(function(t){0==t.state?(e.title="设置成功",G.destructor(),n(function(){G.reset(),c.stateGo("tab.mine",{})},500)):(e.title="设置失败",G.viewStatus("error",{ring:!0}))},function(t){e.title="设置失败",G.viewStatus("error",{ring:!0})})}else e.title="两次设置不一致，请重新设置",G.viewStatus("error",{ring:!0}),n(function(){G.reset()},500);++S}else e.title="图案设置锁至少三位",G.viewStatus("error",{ring:!0}),n(function(){G.reset()},500);else G.validatePassword(v,G.getGesturePassword())?(G.viewStatus("success",{ring:!0}),e.title="绘制图案设置锁",n(function(){h=!0,G.reset()},500)):(G.viewStatus("error",{ring:!0}),e.title="密码输入错误,请重新输入",n(function(){G.reset()},500))},G.init(),angular.element(s).bind("resize",function(){k.width=window.innerWidth<window.innerHeight-200?window.innerWidth:window.innerHeight-200,k.height=k.width,G.init()}),a.$ionicGoBack=function(){G.destructor(),f.stateGoUtils(!0,"tab.mine",{},"left")}}])}();
!function(){"use strict";var e=angular.module("community.controllers.gestureLock");e.controller("setGestureLockCtrl",["$scope","$state","$gestureLock","$timeout","gestureLockService","$window","storageService","mine","$ionicNativeTransitions","$rootScope","set_home_page","GestureLockService","serverConfiguration","auth_events","$stateParams","stateGoHelp",function(e,t,i,s,n,r,o,a,u,c,w,l,g,d,f,p){e.$on("$ionicView.beforeEnter",function(e,t){t.enableBack=!0}),c.$ionicGoBack=function(){P.destructor(),p.stateGoUtils(!0,"tab.mine",{},"left")},e.title="绘制图案设置锁",c.hideTabs=!0,c.bell=!1,c.toBack=!0,c.titleData=e.title,e.pwType=f.pwType,e.changePwType=f.changePwType;var h=[2],v=1,y=document.getElementById("gestureLock");y.width=window.innerWidth<window.innerHeight-200?window.innerWidth:window.innerHeight-200,y.height=y.width;var P=new i(y,{matrix:3});P.gestureEnd=function(t){if(h[v%2]=P.getGesturePassword(),console.log(h[v%2].length),h[v%2].length>=3){if(v%2===1)P.viewStatus("success",{ring:!0}),e.title="请再输入一次",s(function(){P.reset()},500);else if(v%2===0)if(P.validatePassword(h[0],h[1])){P.viewStatus("success",{ring:!0}),n.setPassword(h[0]);var i,r,u=g.baseApiUrl+"app/common/v1/setGesturePassword";if("pwType"==e.pwType){var c={account:o.get(d.userId,null),flagType:1,gesturePwd:n.getPassword()};i=n.getPassword(),o.set(a.isOne,i)}else{var c={account:o.get(d.userId,null),flagType:0,gesturePwd:n.getPassword()};r=n.getPassword(),o.set(a.isPW,r)}if("pwType"==e.pwType)o.get(a.isPW)==i?e.title="不能和登录手势密码一样":l.setGestureLock(u,c).then(function(t){0==t.state?(e.title="设置成功",P.viewStatus("success",{ring:!0}),o.set(a.pwLockKey,"true"),P.destructor(),o.set(a.signatureSwitchKey,"true"),p.stateGoUtils(!0,"tab.signatureWay",{},"left")):(e.title="设置失败",P.viewStatus("error",{ring:!0}))},function(t){e.title="设置失败",P.viewStatus("error",{ring:!0})});else if("changePwType"==e.changePwType){var w=g.baseApiUrl+"app/common/v1/editGesturePassword",c={account:o.get(d.userId,null),flagType:1,opwd:"",npwd:n.getPassword()};l.changeGestureLock(w,c).then(function(t){0==t.state?(e.title="修改成功",P.viewStatus("success",{ring:!0}),P.destructor(),p.stateGoUtils(!0,"tab.signatureWay",{},"left")):(e.title="修改失败",P.viewStatus("error",{ring:!0}))},function(t){e.title="修改失败",P.viewStatus("error",{ring:!0})})}else l.setGestureLock(u,c).then(function(t){0==t.state?(e.title="设置成功",o.set(a.gestureLockKey,"true"),P.viewStatus("success",{ring:!0}),P.destructor(),s(function(){p.stateGoUtils(!0,"tab.mine",{},"left")},500)):(e.title="设置失败",P.viewStatus("error",{ring:!0}))},function(t){e.title="设置失败",P.viewStatus("error",{ring:!0})});s(function(){P.reset()},500)}else e.title="两次设置不一致，请重新设置",P.viewStatus("error",{ring:!0}),s(function(){P.reset()},500);++v}else e.title="图案设置锁至少三位",P.viewStatus("error",{ring:!0}),s(function(){P.reset()},500)},P.init(),angular.element(r).bind("resize",function(){y.width=window.innerWidth<window.innerHeight-200?window.innerWidth:window.innerHeight-200,y.height=y.width,P.init()})}])}();
!function(){"use strict";var t=angular.module("community.controllers.gestureLock");t.controller("signInGestureLockCtrl",["$scope","$state","$gestureLock","$timeout","gestureLockService","$window","scopeData","$stateParams","viewFormService","$ionicNativeTransitions","serverConfiguration","$rootScope","authService","$ionicPopup","T","storageService","auth_events","set_home_page","$cordovaToast","$isMobile","public_constant","GetRequestService","stateGoHelp","mobileSocket","DBSingleInstance",function(t,e,n,i,o,a,r,s,u,c,l,g,w,d,f,h,m,p,v,S,b,k,D,$,I){function P(e,n,i,o,a,r,u,c,g,w,d){var m=l.baseApiUrl+"app/approve/v1/approve",p=g.join(","),b={account:e,taskId:n,procInstId:i,actionName:o,opinion:a,data:r,attachmentPkids:u,flagType:c,password:p,follow:w,isLoading:d};k.getRequestDataJson(m,b,d,"POST","application/json").then(function(e){t.state=e.state,"0"==t.state&&(t.title="手势密码验证成功",S.isPC||v.showShortBottom(f.translate("form-handle.handle-success")),K.viewStatus("success",{ring:!0}),K.destructor(),t.workWaitData=s.workWaitData,t.$emit("clearStorageFormData"),h.set("needRemberPosition",!0),D.stateGoUtils(!0,"tab.waitWork",{titleFlag:B,workWaitData:t.workWaitData},"left"))},function(t){S.isPC||v.showShortBottom(f.translate("publicMsg.requestErr"))})}function T(e){w.login(q,e).then(function(t){y(t)},function(e){t.title="手势密码错误",K.viewStatus("error",{ring:!0}),i(function(){K.reset()},500)})}function y(n){w.getUserId(q).then(function(n){h.set(m.userId,n.account),h.set(m.authorization,n.authorization),$.connect();var i=h.get(p.setHomeKey,null),o="tab.work";if(null==i||i==p.work?o="tab.work":i==p.waitWork?o="tab.waitWork":i==p.information?o="tab.information":i==p.mine&&(o="tab.mine"),t.title="通过手势密码验证",K.viewStatus("success",{ring:!0}),K.destructor(),g.hideTabs=!1,null==h.get(p.requestTimeDbKey,null)){var a=I.getTimeDb();a.transaction(function(t){t.executeSql("DELETE FROM TimeData",[],function(t,e){h.set(p.requestTimeDbKey,"haveRequestDb")},function(t,e){})})}e.go(o,{},{reload:!0})},function(e){t.title="获取必要信息接口失败",K.viewStatus("error",{ring:!0}),i(function(){K.reset()},500)})}function W(e,n,i){var o=l.baseApiUrl+"app/common/v1/signatureGesture",a={account:e,signatureGesturePwd:n.join(",")};u.getViewFormData(o,a,i).then(function(n){t.signatureId=n.signatureId;for(var i=0;i<N.length;i++){U=N[i].split(".");for(var o=1;o<U.length;o++)1==M.hasOwnProperty(U[o])||"true"==M.hasOwnProperty(U[o])?_=M[U[o]]:_[U[o]]=t.signatureId}_=JSON.stringify(M),t.state=n.state,"0"==t.state?(t.title="手势密码验证成功",S.isPC||v.showShortBottom(f.translate("form-handle.handle-success")),K.viewStatus("success",{ring:!0}),K.destructor(),P(e,C,F,O,R,_,j,0,E,z,!0)):(t.title="手势密码错误，请重试！",K.reset())},function(t){S.isPC||v.showShortBottom(f.translate("publicMsg.requestErr"))})}g.hideTabs=!0,g.bell=!1,g.titleData="绘制图案解锁";var E="",B=s.titleFlag,q=s.username,H=s.webType;if(t.$on(m.successSysErr,function(e,n){t.title="手势密码验证失败",K.viewStatus("error",{ring:!0}),i(function(){K.reset()},500)}),t.$on(b.responseError400,function(){t.title="手势密码错误",K.viewStatus("error",{ring:!0}),i(function(){K.reset()},500)}),"formHandle"==H){var G=angular.fromJson(s.paramData),L=G.account,C=G.taskId,F=G.procInstId,O=G.actionName,R=G.opinion,M=r.prototype.getSignData(),N=M.sign;M=M.data;var U,_={};t.signatureId="";var j=G.attachmentPkids;j||(j="");var z=G.follow;z||(z="0"),g.toBack=!0,t.$on("$ionicView.beforeEnter",function(t,e){e.enableBack=!0})}else g.toBack=!1;var J=(s.flagType,o.getPassword(),document.getElementById("gestureLock"));J.width=window.innerWidth<window.innerHeight-200?window.innerWidth:window.innerHeight-200,J.height=J.width;var K=new n(J,{matrix:3});K.gestureStart=function(t){},K.gestureEnd=function(t){E=K.getGesturePassword(),"formHandle"==H?W(L,E,!0):T(E)},K.init(),angular.element(a).bind("resize",function(){J.width=window.innerWidth<window.innerHeight-200?window.innerWidth:window.innerHeight-200,J.height=J.width,K.init()})}])}();
!function(){"use strict";var t=angular.module("community.controllers.information",[]);t.controller("InformationCtrl",["$scope","$state","$stateParams","$rootScope","$ionicNativeTransitions","$ionicHistory","serverConfiguration","storageService","auth_events","$timeout","$isMobile","application","wait_work","stateGoHelp","GetRequestService","$httpParamSerializer",function(t,i,e,o,a,n,r,s,c,l,u,f,m,p,$,g){function v(i,e,a,n){var s=r.baseApiUrl+"app/message/v1/noticeList",c={account:i,pageNum:e,pageSize:a};$.getRequestDataJson(s,g(c),n,"POST","application/x-www-form-urlencoded").then(function(i){t.InformationData=i.list,i.list&&i.list.length?(t.isEmptyData=!1,o.tabIonNotification=i.list[0].count>0,o.bellRed=i.list[0].count>0):t.isEmptyData=!0},function(t){})}t.$on("$ionicView.beforeEnter",function(t,i){n.clearCache(),n.clearHistory(),o.hideTabs=!1,o.bell=!1,o.toBack=!1,o.titleData="消息",s.set(m.sizerWorkTypeKey,""),s.set(m.sizerWorkStateKey,""),s.removeItem("searchDataStr");var e=s.get(c.userId,null);v(e,1,10,!0)}),t.$on("$ionicView.enter",function(){o.hideTabs=!1}),t.InformationData=[];var b=e.titleFlag;t.isEmptyData=!0,t.goNofitication=function(){p.stateGoUtils(!0,"tab.notification-item",{titleFlag:b,information:"information"},"left")}}])}();
!function(){"use strict";var t=angular.module("community.controllers.mine",[]);t.controller("AboutSystemCtrl",["$scope","$state","$rootScope","T","$isMobile","$stateParams","$ionicPopup","versionUpdate","downloadFileUtil",function(t,o,e,a,n,i,r,l,s){var u=angular.fromJson(i.systemData);t.isShowUpdate=!0,t.aboutIntroduce=["无"],t.imgUrl="app/mine/img/about_system_qr_img.png",u&&(t.isShowUpdate=u.shouldUpdate,t.aboutIntroduce=u.description.split("\n"),t.newVersionCode=u.version),t.$on("$ionicView.beforeEnter",function(t,o){e.titleData="关于系统",e.hideTabs=!0,e.bell=!1,e.toBack=!0}),t.updateSoftware=function(){var o="http://192.168.12.36:8090/oa-web/app/attachment/showImage?pkid=15898fa15ade40e6bd289ed864bf6458";s.downloadFile(o,"OAImg","QR.png",!0).then(function(o){alert("成功了"+o),t.imgUrl="file://"+o},function(t){alert("失败"+angular.toJson(t))})}}])}();
!function(){"use strict";var i=angular.module("community.controllers.mine");i.controller("BillSetCtrl",["$scope","$state","$rootScope","$ionicNativeTransitions","T","$isMobile","stateGoHelp",function(i,t,e,l,n,s,a){i.summaryBill=n.translate("mine.set-bill-summary"),i.isSelectOriginal=!0,i.isSelectLight=!1;var o;e.titleData="单据设置",i.$on("$ionicView.beforeEnter",function(t,l){if(e.titleData="单据设置",e.hideTabs=!0,e.bell=!1,e.toBack=!0,null==window.localStorage.getItem("setBill")||"原始数据"==window.localStorage.getItem("setBill")?i.isSelectOriginal=!0:"轻量单据"==window.localStorage.getItem("setBill")&&(i.isSelectOriginal=!1,i.isSelectLight=!0),!s.isPC&&!s.isPC&&s.Android){var n="back"!==l.direction?"left":"right";window.plugins.nativepagetransitions.slide({direction:n})}}),i.isSelectOriginalClick=function(){i.isSelectOriginal=!i.isSelectOriginal,i.isSelectLight=!i.isSelectLight},i.isSelectLightClick=function(){i.isSelectLight=!i.isSelectLight,i.isSelectOriginal=!i.isSelectOriginal},i.setFinish=function(){i.isSelectOriginal?o="原始单据":i.isSelectLight&&(o="轻量单据"),window.localStorage.setItem("setBill",o),a.stateGoUtils(!0,"tab.mine",{},"left")}}])}();
!function(){"use strict";var t=angular.module("community.controllers.mine");t.controller("MineDetailsCtrl",["$scope","$state","$ionicActionSheet","$timeout","$rootScope","$ionicNativeTransitions","serverConfiguration","storageService","auth_events","MineService","viewFormService","$cordovaToast","mine","$isMobile","T","stateGoHelp",function(t,e,o,a,n,i,r,c,s,u,l,p,m,d,f,h){function g(){var e=r.baseApiUrl+"app/common/v1/getPersonInfo",o={account:c.get(s.userId,null)};u.getMineData(e,o).then(function(e){t.personInfo=e,null!=e.picture?(t.showPicture=!0,t.showImage=r.baseApiUrl+"app/attachment/showImage?pkid="+e.picture):t.showPicture=!1},function(t){d.isPC||p.showShortBottom(f.translate("publicMsg.requestErr"))})}function v(e,o,a,n,i){var c=r.baseApiUrl+"app/attachment/uploadBase64",s={businessPkid:e,account:o,fileName:a,fileStream:n};l.uploadData(c,s).then(function(e){t.pkidImg=e.data.attachment_pkid,w(t.account,t.pkidImg)},function(t){p.showShortBottom(f.translate("mine.avatar-upload-fail"))})}function w(e,o){var a=r.baseApiUrl+"app/common/v1/editProfilePicture",n={account:e,attachPkid:o};u.uploadAvatar(a,n).then(function(e){t.state=e.state,"0"==e.state?p.showShortBottom(f.translate("mine.avatar-upload-success")):"-1"==e.state&&p.showShortBottom(f.translate("mine.avatar-upload-fail"))},function(t){p.showShortBottom(f.translate("mine.avatar-upload-fail"))})}t.myImage="",t.showImage="",t.account=c.get(s.userId,null),t.pkidImg="";var P=document.querySelector("#crop_result");document.querySelector("#avatarId");t.personInfo={},n.titleData="我的资料",t.$on("$ionicView.beforeEnter",function(t,e){if(n.titleData="我的资料",n.hideTabs=!0,n.bell=!1,n.toBack=!0,!d.isPC&&!d.isPC&&d.Android){var o="back"!==e.direction?"left":"right";window.plugins.nativepagetransitions.slide({direction:o})}g()}),t.imgonerror=function(){t.showImage.indexOf("showImage?")>-1&&(t.showImage="app/view-form/img/picture404.png")},t.chooseHeadPicture=function(){function e(){P.style.display="block"}function a(){P.style.display="none",P.innerHTML=""}function n(o){var n="data:image/png;base64,"+o,i=Date.parse(new Date)+".jpg";t.$apply(function(t){t.myImage=n}),a(),new AlloyCrop({image_src:t.myImage,circle:!0,width:200,height:200,ok:function(o,a){v(null,t.account,i,o,!0),P.appendChild(a),P.querySelector("canvas").style.borderRadius="50%",e(),t.$apply(function(t){t.showPicture=!0,t.showImage=o})},cancel:function(){e()},ok_text:"确认",cancel_text:"取消"})}function i(t){p.showShortBottom(t)}if(d.Android){var r=["android.permission.WRITE_EXTERNAL_STORAGE","android.permission.CAMERA"];PermissionsPlugin.addPermissions("权限",function(){},function(){},r)}var c=null;o.show({buttons:[{text:"从相册选择"},{text:"拍照"}],titleText:"选择头像",cancelText:"取消",cancel:function(){},buttonClicked:function(e){return 0==e?c=navigator.camera.PictureSourceType.PHOTOLIBRARY:1==e&&(c=navigator.camera.PictureSourceType.CAMERA),null!==c&&t.takePhoto(c),!0}});t.takePhoto=function(t){var e={quality:50,destinationType:navigator.camera.DestinationType.DATA_URL,sourceType:t,correctOrientation:!0,popoverOptions:new CameraPopoverOptions(300,300,100,100,Camera.PopoverArrowDirection.ARROW_RIGHT),cameraDirection:navigator.camera.Direction.BACK};navigator.camera.getPicture(n,i,e)}},n.$ionicGoBack=function(){h.stateGoUtils(!1)}}])}();
!function(){"use strict";var t=angular.module("community.controllers.mine");t.controller("HomePageSetCtrl",["$scope","$state","$rootScope","$ionicNativeTransitions","set_home_page","storageService","T","serverConfiguration","auth_events","MineService","$isMobile","$cordovaToast","stateGoHelp","DBSingleInstance","GetRequestService","jdbc",function(t,e,i,n,o,a,s,r,c,l,u,m,f,d,k,g){t.summanyHomePage=s.translate("mine.summany-home-page"),t.workSettingsRemarks=s.translate("mine.work-settings-remarks"),t.isWork=!0,t.isWaitDo=!1,t.isContact=!1,t.isMine=!1;var h,w=a.get(c.userId,null),D=a.get(c.followed,"0"),W=a.get(c.logRecode,"0");i.titleData="显示设置",t.$on("$ionicView.beforeEnter",function(e,n){i.hideTabs=!0,i.bell=!1,i.toBack=!0,i.titleData="显示设置";var s=a.get(o.setHomeKey,null);if(null==s||s==o.work?t.isWork=!0:s==o.waitWork?(t.isWaitDo=!0,t.isWork=!1,t.isContact=!1,t.isMine=!1):s==o.information?(t.isWaitDo=!1,t.isWork=!1,t.isContact=!0,t.isMine=!1):s==o.mine&&(t.isWaitDo=!1,t.isWork=!1,t.isContact=!1,t.isMine=!0),"1"==D?angular.element("input[id='followBtnId']").attr("checked",""):"0"==D&&angular.element("input[id='followBtnId']").removeAttr("checked"),"1"==W?angular.element("input[id='logBtnId']").attr("checked",""):"0"==W&&angular.element("input[id='logBtnId']").removeAttr("checked"),!u.isPC&&u.Android&&"back"===n.direction){var r="back"!==n.direction?"left":"right";window.plugins.nativepagetransitions.slide({direction:r})}}),t.setFollow=function(){"0"==D?D="1":"1"==D&&(D="0");var t=r.baseApiUrl+"app/common/v1/updateFollowed",e={account:w,followed:D};k.getRequestData(t,e,!0,"POST").then(function(t){a.set(c.followed,D),u.isPC?alert(s.translate("mine.followed-success")):m.showShortBottom(s.translate("mine.followed-success"))},function(t){"0"==D?angular.element("input[id='followBtnId']").attr("checked",""):"1"==D&&angular.element("input[id='followBtnId']").removeAttr("checked"),u.isPC?alert(s.translate("mine.followed-err")):m.showShortBottom(s.translate("mine.followed-err"))})},t.setLogRecord=function(){if(W="0"==W?"1":"0",a.set(c.logRecode,W),"0"==W){var t=d.getTimeDb();t.transaction(function(t){t.executeSql("DELETE FROM TimeData",[],function(t,e){},function(t,e){})})}},t.isWaitDoClick=function(){t.isWaitDo=!t.isWaitDo,t.isWork=!1,t.isContact=!1,t.isMine=!1},t.isWorkClick=function(){t.isWaitDo=!1,t.isWork=!t.isWork,t.isContact=!1,t.isMine=!1},t.isContactClick=function(){t.isWaitDo=!1,t.isWork=!1,t.isContact=!t.isContact,t.isMine=!1},t.isMineClick=function(){t.isWaitDo=!1,t.isWork=!1,t.isContact=!1,t.isMine=!t.isMine},t.setFinish=function(){t.isWaitDo&&(h=o.waitWork),t.isWork&&(h=o.work),t.isContact&&(h=o.information),t.isMine&&(h=o.mine),a.set(o.setHomeKey,h),f.stateGoUtils(!0,"tab.mine",{},"left")},t.syncOperate=function(){var t=r.baseApiUrl+"app/home/v1/custom",e={account:w};l.getMineData(t,e).then(function(t){if(0!=t.list.length)if(u.Android){var e=d.getSyncDb();e.transaction(function(t){t.executeSql("delete from SyncData",[],function(t,e){},function(t,e){})}),e.transaction(function(e){e.executeSql("insert into SyncData values(?)",[t.list],function(t){u.isPC||m.showShortBottom(s.translate("mine.remarks-success"))},function(t,e){})})}else g.findAll("syncData").then(function(e){e&&e.forEach(function(t){g.remove("syncData",t.id)});var i={};i.id=1,i.syncValue=t.list,g.put("syncData",i)});else u.isPC||m.showShortBottom(s.translate("mine.remarks-error"))},function(t){u.isPC||m.showShortBottom(s.translate("mine.remarks-fail"))})},i.$ionicGoBack=function(){f.stateGoUtils(!1)}}])}();
!function(){"use strict";var e=angular.module("community.controllers.mine");e.controller("SetPasswordCtrl",["$scope","$state","$ionicPopup","$ionicNativeTransitions","$rootScope","T","MineService","serverConfiguration","storageService","auth_events","md5","$timeout","authService","$stateParams","$isMobile","stateGoHelp",function(e,t,n,l,a,i,o,s,p,r,m,g,w,c,d,u){var v=p.get(r.userId,null);e.pwType=c.pwType,"pwType"==e.pwType?a.titleData="修改签章密码":a.titleData="修改登录密码",e.$on("$ionicView.beforeEnter",function(t,n){if(e.pwType=c.pwType,a.hideTabs=!0,a.bell=!1,a.toBack=!0,"pwType"==e.pwType?(a.titleData="修改签章密码",e.PasswordSave=!1):(a.titleData="修改登录密码",e.PasswordSave=!0),!d.isPC&&d.Android&&"back"===n.direction){var l="back"!==n.direction?"left":"right";window.plugins.nativepagetransitions.slide({direction:l})}}),e.clickRightSave=function(){var e=document.getElementById("oldPassword").value,t=document.getElementById("newPassword").value,l=document.getElementById("againNewPassword").value;if(void 0!=e&&0!=e.length)if(void 0!=t&&0!=t.length)if(void 0!=l&&0!=l.length){if(e.length<6||t.length<6||l.length<6)return void n.alert({title:i.translate("mine.set-login-pw-title-pop"),template:i.translate("mine.set-minlegth-pw"),okText:i.translate("mine.set-login-pw-ok")});if(t==l){var a=s.baseApiUrl+"app/common/v1/editPassword",p={account:v,flagType:0,opwd:m.createHash(e),npwd:m.createHash(t)};o.getMineData(a,p).then(function(e){var t=n.alert({title:i.translate("mine.set-login-pw-title-pop"),template:e.msg,okText:i.translate("mine.set-login-pw-ok")});t.then(function(){0==e.state&&w.logout()})},function(e){var t=n.alert({title:i.translate("mine.set-login-pw-title-pop"),template:i.translate("mine.set-login-pw-err-pop"),okText:i.translate("mine.set-login-pw-ok")});g(function(){t.close()},2e3)})}else{n.alert({title:i.translate("mine.set-login-pw-title-pop"),template:i.translate("mine.set-login-pw-equal-pop"),okText:i.translate("mine.set-login-pw-ok")})}}else{n.alert({title:i.translate("mine.set-login-pw-title-pop"),template:i.translate("mine.set-login-pw-again-new-pop"),okText:i.translate("mine.set-login-pw-ok")})}else{n.alert({title:i.translate("mine.set-login-pw-title-pop"),template:i.translate("mine.set-login-pw-new-pop"),okText:i.translate("mine.set-login-pw-ok")})}else{n.alert({title:i.translate("mine.set-login-pw-title-pop"),template:i.translate("mine.set-login-pw-old-pop"),okText:i.translate("mine.set-login-pw-ok")})}},e.clickRightFinish=function(){var e=document.getElementById("oldPassword").value,t=document.getElementById("newPassword").value,l=document.getElementById("againNewPassword").value;if(void 0!=e&&0!=e.length)if(void 0!=t&&0!=t.length)if(void 0!=l&&0!=l.length){if(e.length<6||t.length<6||l.length<6)return void n.alert({title:i.translate("mine.set-login-pw-title-pop"),template:i.translate("mine.set-minlegth-pw"),okText:i.translate("mine.set-login-pw-ok")});if(t==l){var a=s.baseApiUrl+"app/common/v1/editGesturePassword",p={account:v,flagType:0,opwd:m.createHash(e),npwd:m.createHash(t)};o.getMineData(a,p).then(function(e){var t=n.alert({title:i.translate("mine.set-login-pw-title-pop"),template:e.msg,okText:i.translate("mine.set-login-pw-ok")});t.then(function(){0==e.state&&u.stateGoUtils(!0,"tab.signatureWay",{},"left")})},function(e){var t=n.alert({title:i.translate("mine.set-login-pw-title-pop"),template:i.translate("mine.set-login-pw-err-pop"),okText:i.translate("mine.set-login-pw-ok")});g(function(){t.close()},2e3)})}else{n.alert({title:i.translate("mine.set-login-pw-title-pop"),template:i.translate("mine.set-login-pw-equal-pop"),okText:i.translate("mine.set-login-pw-ok")})}}else{n.alert({title:i.translate("mine.set-login-pw-title-pop"),template:i.translate("mine.set-login-qz-again-new-pop"),okText:i.translate("mine.set-login-pw-ok")})}else{n.alert({title:i.translate("mine.set-login-pw-title-pop"),template:i.translate("mine.set-login-qz-new-pop"),okText:i.translate("mine.set-login-pw-ok")})}else{n.alert({title:i.translate("mine.set-login-pw-title-pop"),template:i.translate("mine.set-login-pw-old-pop"),okText:i.translate("mine.set-login-pw-ok")})}},a.$ionicGoBack=function(){u.stateGoUtils(!1)}}])}();
!function(){"use strict";var e=angular.module("community.controllers.mine");e.controller("SignatureWayCtrl",["$scope","$state","$ionicPopup","$rootScope","$ionicNativeTransitions","storageService","mine","auth_events","MineService","$cordovaToast","serverConfiguration","md5","$timeout","$isMobile","$ionicHistory","T","stateGoHelp","authService",function(e,t,n,a,o,i,c,r,s,u,l,g,m,h,v,d,p,P){function w(){var t=l.baseApiUrl+"app/common/v1/signature",n={account:i.get(r.userId,null),signature:e.valuePW===!0?1:0};s.getMineData(t,n).then(function(t){i.set(c.approveSwitchKey,e.valuePW)},function(e){})}e.summaryPWOpen="出于安全考虑，免输签章密码的设置每次用户退出或者应用进程被杀死后失效，如果需要再次开启请用户登录后重新设置。",e.summaryPWClose="关闭后,则不需要密码进行签章",e.summaryGesturesOpen="开启后,签章方式为解锁手势图案密码,手势图案与解锁图案不一致",e.checkPW=!1,e.errMsg="",e.$on("$ionicView.enter",function(e,t){angular.element(document.querySelectorAll(".tabs-icon-top")).addClass("tabs-item-hide")}),e.$on("$ionicView.beforeEnter",function(t,n){if(console.log(i.get(r.signature)),a.bell=!1,a.toBack=!0,e.isChangePW=!1,e.valueImg=!1,e.changeHandImg=!1,a.titleData="签章管理","true"==i.get(c.approveSwitchKey,!1)&&(e.valuePW=!0),"true"==i.get(c.signatureSwitchKey,!1)&&(e.valueImg=!0,e.changeHandImg=!0),!h.isPC&&h.Android&&"back"===n.direction){var o="back"!==n.direction?"left":"right";window.plugins.nativepagetransitions.slide({direction:o})}}),e.toggleChangePW=function(){e.valuePW=!e.valuePW,e.valuePW?(e.isChangePW=!0,e.maskTitle="身份验证"):w()},e.toggleChangeImg=function(){e.valueImg||(e.checkPW=!0),e.valueImg&&(e.valueImg=!e.valueImg,e.changeHandImg=!e.changeHandImg,i.set(c.signatureSwitchKey,e.valueImg))},e.isChangePW=!1;var f;e.goGestureLock=function(){e.isChangePW=!0,e.maskTitle="身份验证"},e.goDash=function(){var t=l.baseApiUrl+"app/common/v1/signatureValidate";if(f=document.getElementById("changePassword").value,0==f.length)return void(h.isPC||u.showShortBottom(d.translate("mine.signature-pw-null")));var n={account:i.get(r.userId,null),signaturePwd:g.createHash(f)};console.log(n),s.getMineData(t,n).then(function(t){0==t.state?(w(),e.valuePW?(e.isChangePW=!1,e.isShowSignature=!1,p.stateGoUtils(!1)):p.stateGoUtils(!0,"gesture.setGestureLock",{changePwType:"changePwType"},"left")):(e.valuePW=!1,e.isShowSignature=!0,e.isChangePW=!1,angular.element("#pwdInput").removeAttr("checked"),h.isPC||u.showShortBottom(t.msg))},function(e){h.isPC||u.showShortBottom(d.translate("form-handle.gesture-error"))}),document.getElementById("changePassword").value=""},e.cancel=function(){e.valuePW&&(e.valuePW=!1,e.isShowSignature=!0,angular.element("#pwdInput").removeAttr("checked")),e.isChangePW=!1,document.getElementById("changePassword").value=""},e.goChangePW=function(){p.stateGoUtils(!0,"tab.setPassword",{pwType:"pwType"},"left")},e.checkPWMethod=function(){var t=P.loadUserLogin(),n=document.querySelector("#pwValue").value;t.pw===n?(e.checkPW=!1,p.stateGoUtils(!0,"gesture.setGestureLock",{pwType:"pwType",lockBack:e.valueImg},"left"),e.valueImg=!e.valueImg,e.changeHandImg=!e.changeHandImg):(e.errMsg="密码校验失败",m(function(){e.errMsg=""},2e3))},e.cancelCheck=function(){e.checkPW=!1,e.checkPW="",angular.element("input[type='checkbox']").removeAttr("checked")},a.$ionicGoBack=function(){p.stateGoUtils(!1)}}])}();
!function(){"use strict";var e=angular.module("community.controllers.mine");e.controller("MineCtrl",["$scope","$state","$stateParams","$rootScope","$ionicNativeTransitions","$ionicHistory","authService","storageService","set_home_page","mine","serverConfiguration","auth_events","MineService","T","$isMobile","GetRequestService","$cordovaToast","application","$ionicPopup","APP","$ionicLoading","versionUpdate","wait_work","stateGoHelp","DBSingleInstance","mobileSocket","jdbc","$timeout",function(e,t,o,i,n,a,r,s,c,l,u,p,g,h,f,m,d,k,v,w,b,S,T,D,W,y,C,G){function I(){var t=u.baseApiUrl+"app/common/v1/getPersonInfo",o={account:s.get(p.userId,null)};g.getMineData(t,o).then(function(t){e.personInfo=t,null==t.dept&&(e.personInfo.dept=h.translate("mine.mine-person-info-no-dept")),null!=t.picture?(e.showDetailImg=!0,e.detailImg=u.baseApiUrl+"app/attachment/showImage?pkid="+t.picture,f.IOS&&(e.rotateIOSImg=!0)):e.showDetailImg=!1},function(e){})}function L(){var t=u.baseApiUrl+"app/ctl/othertodo/v1/otherTodoCtl",o={account:s.get(p.userId,null)};g.getOtherTodoCtl(t,o).then(function(t){e.canViewOtherWaitWork=t},function(e){})}e.isShowGestureLockChange=!1;var P;e.personInfo={},i.titleData="我的",e.showDetailImg=!1,e.appDescription=null,e.upDateFlag=!1,e.currentVersion="",e.currentVersion="",e.checkPW=!1,e.errMsg="",e.canViewOtherWaitWork=!1,e.$on("$ionicView.beforeEnter",function(t,o){if(a.clearCache(),a.clearHistory(),s.removeItem("searchDataStr"),i.titleData="我的",i.hideTabs=!1,i.bell=!0,i.toBack=!1,e.showTiemUpload="1"==s.get(p.logRecode,"0"),s.set(T.sizerWorkTypeKey,""),s.set(T.sizerWorkStateKey,""),I(),L(),void 0==s.get(c.setHomeKey,null)?e.homePageText="工作":e.homePageText=s.get(c.setHomeKey,null),P=s.get(l.gestureLockKey,"false"),"true"==P?(angular.element("input[type='checkbox']").attr("checked",""),e.isShowGestureLockChange=!0):(e.isShowGestureLockChange=!1,angular.element("input[type='checkbox']").removeAttr("checked")),!f.isPC&&f.Android&&"back"===o.direction){var n="back"!==o.direction?"left":"right";window.plugins.nativepagetransitions.slide({direction:n})}S.getVersionInfo().then(function(t){t.shouldUpdate&&(e.upDateFlag=!0,e.appDescription=t)}),S.getCurrentVersion().then(function(t){e.currentVersion="("+t+")"})}),e.rotateIOSImg=!1,e.imgonerror=function(){e.detailImg.indexOf("showImage?")>-1&&(e.detailImg="app/view-form/img/picture404.png")},e.tabLockClick=function(){e.isShowGestureLockChange?(e.isShowGestureLockChange=!e.isShowGestureLockChange,s.removeItem(l.gestureLockKey),s.set(l.gestureLockKey,e.isShowGestureLockChange)):e.checkPW=!0},e.checkPWMethod=function(){var t=r.loadUserLogin(),o=document.querySelector("#pwValue").value;t.pw===o?(e.checkPW=!1,e.isShowGestureLockChange=!e.isShowGestureLockChange,D.stateGoUtils(!0,"gesture.setGestureLock",{},"left")):(e.errMsg="密码校验失败",G(function(){e.errMsg=""},2e3))},e.cancelCheck=function(){e.checkPW=!1,e.checkPW="",angular.element("input[type='checkbox']").removeAttr("checked")},e.goMyDetails=function(){D.stateGoUtils(!0,"tab.mineDetails",{},"left")},e.goHomePageSet=function(){D.stateGoUtils(!0,"tab.homePageSet",{},"left")},e.goBillSet=function(){D.stateGoUtils(!0,"tab.billSet",{},"left")},e.goSignatureWay=function(){D.stateGoUtils(!0,"tab.signatureWay",{},"left")},e.goGestureLock=function(){D.stateGoUtils(!0,"gesture.resetGestureLock",{},"left")},e.goSetPassword=function(){D.stateGoUtils(!0,"tab.setPassword",{},"left")},e.goSignaturePassword=function(){D.stateGoUtils(!0,"tab.signaturePassword",{},"left")},e.goFormHandle=function(){D.stateGoUtils(!0,"tab.form-handle",{},"left")},i.clickLiftMessage=function(){D.stateGoUtils(!0,"tab.mineNotification",{type:"mine"},"left")},e.clearCache=function(){var e=v.confirm({title:h.translate("publicMsg.popTitle"),template:h.translate("mine.clear-cache-content"),cancelText:h.translate("publicMsg.cancel"),cancelType:"button-assertive",okText:h.translate("publicMsg.sure"),okType:"button-positive"});e.then(function(e){if(e){v.alert({title:"友好提示",template:"清理成功",okText:h.translate("publicMsg.sure"),okType:"button-positive"});if(w.devMode)if(f.Android){var t=W.getTimeDb();t.transaction(function(e){e.executeSql("DELETE FROM TimeData",[],function(e,t){},function(e,t){})})}else C.findAll("syncData").then(function(e){e&&e.forEach(function(e){C.remove("syncData",e.id)})})}})},e.versionUpdate=function(){if(e.descriptionArr=e.appDescription.description.split("\n"),e.upDateFlag){var t=v.confirm({title:"更新提示",template:'<div ng-repeat="item in descriptionArr"><p>{{item}}</p></div>',cancelText:"取消",cancelType:"button-assertive",okText:"确定",okType:"button-positive",scope:e});t.then(function(t){t&&S.upDateVersion(e.appDescription)})}},e.exitLogin=function(){S.exitLogin(!0).then(function(e){angular.element("input[type='checkbox']").removeAttr("checked")},function(e){f.isPC?alert(h.translate("mine.exit-login-err")):d.showShortBottom(h.translate("mine.exit-login-err"))})},e.uploadTimeData=function(){function e(){t.transaction(function(e){e.executeSql("DELETE FROM TimeData WHERE makeTime IN (SELECT makeTime FROM TimeData ORDER BY makeTime DESC LIMIT (?))",[o],function(e,t){},function(e,t){})})}var t=W.getTimeDb(),o=2e3,i=v.confirm({title:"上传提示",template:"您确定上传日志数据吗?",cancelText:h.translate("publicMsg.cancel"),cancelType:"button-assertive",okText:h.translate("publicMsg.sure"),okType:"button-positive"});i.then(function(i){if(i){var n=[];t.transaction(function(t){t.executeSql("SELECT * FROM TimeData",[],function(t,i){if(0!=i.rows.length){if(i.rows.length<o)for(var a=i.rows.length-1;a>=0;a--)n.push(i.rows.item(a));else for(var a=i.rows.length-1;a>=i.rows.length-o;a--)n.push(i.rows.item(a));var r={list:n},s=u.baseApiUrl+"app/log/logUpload";m.getRequestDataJson(s,r,!0,"POST","application/json").then(function(t){f.isPC?alert("成功上传"+n.length+"条数据"):d.showShortBottom("成功上传"+n.length+"条数据"),e()},function(e){f.isPC?alert("上传失败"):d.showShortBottom("上传失败")})}else f.isPC?alert("无日志数据可上传"):d.showShortBottom("无日志数据可上传")})})}})},i.$ionicGoBack=function(){D.stateGoUtils(!1)},e.viewOtherWaitWorkVisible=!1,e.viewOtherWaitWorkDialogShow=function(){e.viewOtherWaitWorkVisible=!0},e.viewOtherWaitWorkDialogHide=function(){e.viewOtherWaitWorkVisible=!1},e.viewOtherWaitWork=function(){var t=document.querySelector("#user-code").value;i.todoUserCode=t,e.viewOtherWaitWorkDialogHide(),D.stateGoUtils(!0,"tab.mineOtherWaitWork",{titleName:t+"待办事项",typeId:"",workFlag:"isWork",viewOtherWaitWork:!0,todoUserCode:t},"left")}}])}();
!function(){"use strict";var t=angular.module("community.controllers.notification",[]);t.controller("NotificationWorkCtrl",["$scope","$state","$rootScope","$ionicNativeTransitions","$stateParams","scopeData","$ionicHistory","GetRequestService","$cordovaToast","storageService","auth_events","serverConfiguration","$isMobile","$ionicPopup","timeout","stateGoHelp",function(t,i,e,o,a,n,r,s,c,m,l,f,p,u,d,g){function y(t,i){var e=f.baseApiUrl+"app/message/v1/msgDel",n={account:t,pkid:i};s.getRequestData(e,n,!0,"POST").then(function(t){"0"==t.state?"work"==a.type?o.stateGo("tab.workNotification",{type:a.type,dele:"dele"}):"information"==a.information?o.stateGo("tab.notification-item",{information:a.information,dele:"dele"}):"mine"==a.type?o.stateGo("tab.mineNotification",{type:a.type,dele:"dele"}):o.stateGo("tab.notification",{type:a.type,dele:"dele"}):p.isPC||c.showShortBottom(T.translate("notification.clean-error"))},function(t){p.isPC||c.showShortBottom(T.translate("publicMsg.requestErr"))})}t.$on("$ionicView.beforeEnter",function(t,i){e.titleData="消息详情",e.toBack=!0,e.hideTabs=!0,i.enableBack=!0,e.bell=!1;var o=r.backView(),s=r.forwardView();if(null!=o&&("tab.view-form"==o.stateName||"tab.viewFormWork"==o.stateName)&&(i.direction="back",!p.isPC&&p.Android&&"back"===i.direction)){var c="right";window.plugins.nativepagetransitions.slide({direction:c})}if(null!=s&&("tab.view-form"==s.stateName||"tab.viewFormWork"==s.stateName)&&(i.direction="back",!p.isPC&&p.Android&&"back"===i.direction)){var c="right";window.plugins.nativepagetransitions.slide({direction:c})}n.prototype.setStateCurrentViewDataName(r.currentView().stateName),n.prototype.setStateCurrentViewParams(r.currentView().stateParams),e.$ionicGoBack=function(){"mine"==a.type?g.stateGoUtils(!0,"tab.mineNotification",{type:a.type},"right"):"information"==a.information?g.stateGoUtils(!0,"tab.notification-item",{information:a.information},"right"):"work"==a.type?g.stateGoUtils(!0,"tab.workNotification",{type:a.type},"right"):g.stateGoUtils(!0,"tab.notification",{},"right")},p.Android||angular.element(document.querySelectorAll(".tabs-icon-top")).addClass("tabs-item-hide")}),t.$on("$ionicView.enter",function(){angular.element(document.querySelectorAll(".tabs-icon-top")).addClass("tabs-item-hide"),e.hideTabs=!0,e.toBack=!0}),t.NotificationItem=angular.fromJson(a.NotificationItem),t.msgTypeName=t.NotificationItem.msgTypeName,t.makeTime=t.NotificationItem.makeTime,t.msgInfo=t.NotificationItem.msgInfo,t.jumpTypeTrue=!0;var N=t.NotificationItem.pkid;"2"==t.NotificationItem.jumpType&&(t.jumpTypeTrue=!1);var b=m.get(l.userId,null);t.goNotificationDetail=function(){var i={taskId:t.NotificationItem.taskId,procInstId:t.NotificationItem.procInstId};"0"==t.NotificationItem.jumpType?g.stateGoUtils(!0,"tab.view-form",{titleName:"已发事项",titleFlag:"0",type:a.type,notificationDetail:"notificationDetail",notification:"notification",information:a.information,waitWorkPassDate:angular.toJson(i),NotificationItem:angular.toJson(t.NotificationItem)},"left"):"1"==t.NotificationItem.jumpType?g.stateGoUtils(!0,"tab.view-form",{titleFlag:t.titleFlag,type:a.type,NotificationItem:angular.toJson(t.NotificationItem),notification:"notification",information:a.information,waitWorkPassDate:angular.toJson(i)},"left"):"5"==t.NotificationItem.jumpType&&g.stateGoUtils(!0,"tab.view-form",{titleName:"公文查询",titleFlag:"4",type:a.type,notificationDetail:"notificationDetail",notification:"notification",information:a.information,waitWorkPassDate:angular.toJson(i),NotificationItem:angular.toJson(t.NotificationItem)},"left")},t.deleteDetail=function(){t.item="确认要删除吗？";var i=u.confirm({title:"提示",template:"<div><p>{{item}}</p></div>",cancelText:"取消",cancelType:"button-assertive",okText:"确定",okType:"button-positive",scope:t});i.then(function(t){t&&y(b,N)})}}])}();
!function(){"use strict";var t=angular.module("community.controllers.notification");t.controller("NotificationCtrl",["$scope","$state","$rootScope","$ionicNativeTransitions","$stateParams","$ionicPopup","$ionicHistory","NotificationService","auth_events","storageService","$timeout","serverConfiguration","timeout","$isMobile","T","$cordovaToast","stateGoHelp","GetRequestService",function(t,i,a,e,o,n,c,s,l,r,u,f,p,g,m,h,d,b){function v(i,a,e,o){t.pkids=[];var n=f.baseApiUrl+"app/message/v1/inquire";1==a&&($=1);var c={account:i,pageNum:a,pageSize:e};b.getRequestData(n,c,o,"POST").then(function(i){t.NotificationData=i.list,t.isHasNextPage=i.flagNextPage,null!=t.NotificationData?0==t.NotificationData.length?(t.noti.text="没有数据可以更新",t.isEmptyData=!0):(t.noti.text="成功更新"+t.NotificationData.length+"条信息",t.isEmptyData=!1):(t.noti.text="没有数据可以更新",t.isEmptyData=!0)},x)}function k(t,i){var a=f.baseApiUrl+"app/message/v1/msgStatus",e={account:t,headPkids:i};s.getNotificationData(a,e).then(function(i){"0"==i.state?v(t,1,10,!0):x("notification.batch-error")},x)}function N(t,i){var a=f.baseApiUrl+"app/message/v1/msgStatus",e={account:t,headPkids:i};s.getNotificationData(a,e).then(function(t){},x)}function D(t){var i=f.baseApiUrl+"app/message/v1/msgStatus/batch",a={account:t};s.getNotificationData(i,a).then(function(i){"0"==i.state?v(t,1,10,!0):x("notification.all-batch-error")},x)}function T(t){var i=f.baseApiUrl+"app/message/v1/msgClean",a={account:t};s.getNotificationData(i,a).then(function(i){"0"==i.state?v(t,1,10,!0):x("notification.clean-error")},x)}t.$on("$ionicView.beforeEnter",function(t,i){a.titleData="通知",a.toBack=!0,a.hideTabs=!0,i.enableBack=!0,a.bell=!1;var n=r.get(l.userId,null);v(n,1,10,!0),a.$ionicGoBack=function(){var t=c.currentView();"tab.workNotification"===t.stateName?d.stateGoUtils(!0,"tab.work",{},"right"):"tab.notification"===t.stateName?o.backFlag?e.goBack():d.stateGoUtils(!0,"tab.waitWork",{},"right"):"tab.notification-item"===t.stateName?d.stateGoUtils(!0,"tab.information",{},"right"):"tab.mineNotification"===t.stateName&&d.stateGoUtils(!0,"tab.mine",{},"right")},g.Android&&angular.element(document.querySelectorAll(".tabs-icon-top")).addClass("tabs-item-hide")}),t.$on("$ionicView.enter",function(){angular.element(document.querySelectorAll(".tabs-icon-top")).addClass("tabs-item-hide"),a.hideTabs=!0,a.toBack=!0}),t.checkFlag=!1,t.type=o.type,t.titleFlag=o.titleFlag;var $=1;t.isEmptyData=!0,t.changeChecked=function(t){this.checkFlag=!this.checkFlag},t.goNotificationData=function(i){i.showFlag=!0,N(y,i.pkid),d.stateGoUtils(!0,"tab.notification-work",{NotificationItem:angular.toJson(i),titleFlag:t.titleFlag,type:o.type,information:o.information},"left")};var y=r.get(l.userId,null);t.NotificationData=[],t.noti={},t.doRefresh=function(){$=1,u(function(){v(y,1,10,!1),t.$broadcast("scroll.refreshComplete")},p.pullDown)};var x=function(t){g.isPC||h.showShortBottom(m.translate(t))};t.loadMore=function(){var i=++$,a=f.baseApiUrl+"app/message/v1/inquire",e={account:y,pageNum:i,pageSize:10};b.getRequestData(a,e,!1,"POST").then(function(i){t.NotificationData=t.NotificationData.concat(i.list),t.isHasNextPage=i.flagNextPage,t.$broadcast("scroll.infiniteScrollComplete")},x)},t.pkids=[],t.checkRudio=function(i){this.checkFlag?t.pkids.splice(t.pkids.indexOf(i),1):t.pkids.push(i),console.log(t.pkids,t.checkFlag)},t.clickRightMarkRead=function(){0===t.pkids.length?x("notification.batch-text"):k(y,t.pkids)},t.batch=function(){t.batchText="确认要全部标记吗？";var i=n.confirm({title:"提示",template:"<div><p>{{batchText}}</p></div>",cancelText:"取消",cancelType:"button-assertive",okText:"确定",okType:"button-positive",scope:t});i.then(function(t){t&&D(y)})},t.msgClean=function(){t.item="确认要全部清空吗？";var i=n.confirm({title:"提示",template:"<div><p>{{item}}</p></div>",cancelText:"取消",cancelType:"button-assertive",okText:"确定",okType:"button-positive",scope:t});i.then(function(t){t&&T(y)})}}])}();
!function(){"use strict";var t=angular.module("community.controllers.formEnlargement",[]);t.controller("FormEnlargementCtrl",["$scope","$state","$rootScope","$ionicNativeTransitions","$ionicHistory","$isMobile","$stateParams","storageService","auth_events","serverConfiguration","scopeData","$timeout","viewFormService","timeout","stateGoHelp","form_constant","clone","$cordovaToast","APP","application","$ionicScrollDelegate",function(t,a,e,i,o,n,s,r,l,d,c,g,f,h,m,p,u,w,P,b,v){function k(){for(var a in t.data)for(var e in t.data[a])t.data[a].hasOwnProperty(e)&&0==e.indexOf("sub_")&&void 0!=t.data[a][e]&&t.dataList.length>0&&(t.data[a][e]=t.data[a][e].concat(t.dataList),t.dataList.length=0)}function L(a,e){var i=e?10*e:F;for(var o in a){t.formDataId=a[o].id_;for(var n in a[o])a[o].hasOwnProperty(n)&&0==n.indexOf("sub_")&&(t.subTableLength=a[o][n].length,a[o][n]=$.fn.sortSubTable(a[o][n],"seqnum","asc"),void 0!=a[o][n]&&a[o][n].length>0&&(t.dataList=a[o][n].splice(0),t.nextP=t.dataList.length>i,t.isLongForm=t.dataList.length>i,a[o][n]=t.dataList.splice(0,i)))}return a}e.bell=!1,e.toBack=!0,t.workWaitData=s.workWaitData,t.zoomFlag=!1,t.tableFlagE=!0;var y,D=s.titleFlag,T=v.$getByHandle("viewFormScrollHandleChild");t.subTablePage=s.subTablePage,t.dataList=[],t.$on("$ionicView.beforeEnter",function(a,i){r.set("viewFormCacheWork","viewFormCacheWork");s.type;if(e.hideTabs=!0,e.bell=!1,e.toBack=!0,e.titleData="放大表单",t.saveOption=!1,i.enableBack=!0,t.nextP=!1,t.tableFlagE=!0,T.scrollTop(),n.isPC)t.isShowTop=!0;else switch(window.orientation){case 0:t.isShowTop=!0;break;case 90:t.isShowTop=!1;break;case-90:t.isShowTop=!1}e.dataListENew=[],c.prototype.setCheckFlag(!1);var o=10,l=11;ionic.Platform.isIPad()&&(o=20,l=21);var d=c.prototype.getPermissionData(),g=c.prototype.getSignData();t.htmlContent=c.prototype.getHtmlData(),t.permission=c.prototype.getPermissionData(),Object.keys(d.fields).forEach(function(a){if(g.sign.length>0){for(var e=0;e<g.sign.length;e++)for(var i in d.fields[a])if(g.sign[e].indexOf(i)==-1&&"w"==d.fields[a][i]){t.saveOption=!0;break}}else for(var i in d.fields[a])if("w"==d.fields[a][i]){t.saveOption=!0;break}}),t.sign=g.sign,t.formData=JSON.parse(JSON.stringify(g.data)),t.data=L(t.formData,t.subTablePage)}),e.$ionicGoBack=function(){c.prototype.getCheckFlag()&&c.prototype.setCheckFlag(!0),n.isPC||ionic.Platform.isIPad()||screen.orientation.lock("default"),r.set("subTablePage",t.subTablePage),m.stateGoUtils(!1)},t.$on("$ionicView.enter",function(){e.hideTabs=!0;var a,i=!1,o=angular.element("#grid_height").find(".scroll"),s=document.getElementById("tableDiv"),l=angular.element("#grid_height").find("table");y=l[l.length-1].clientWidth,n.isPC||ionic.Platform.isIPad()||("undefined"!=typeof y?window.innerHeight+50<y?(screen.orientation.lock("default"),r.set(p.formWidth,y)):(document.getElementById("grid_height").style.zoom=.9,t.zoomFlag=!0):window.innerHeight+50<r.get(p.formWidth,null)?screen.orientation.lock("default"):(document.getElementById("grid_height").style.zoom=.9,t.zoomFlag=!0)),l[l.length-1].clientWidth>s.clientWidth&&(a=(l[l.length-1].clientWidth-s.clientWidth)/2/(s.clientWidth+50)*100+"%",i=!0),1==i?o.css({transform:"translate3d(-"+a+", 0px, 0px) scale(1)"}):o.css({transform:"translate3d(0px, 0px, 0px) scale(1)"}),g(function(){t.dataList.length>0&&(n.isPC?alert("此表单为长数据表单，共"+t.subTableLength+"条数据,点击加载获取更多数据"):w.showLongBottom("此表单为长数据表单，共"+t.subTableLength+"条数据,点击获取更多数据"))},100)});var C=window.innerHeight,F=10,W=9,x=11;ionic.Platform.isIPad()&&(F=20,W=19,x=21),t.loadMore=function(){t.subTablePage++,b.showLoading(!0),g(function(){b.hideLoading()},h.max),g(function(){for(var a in t.data)for(var e in t.data[a])t.data[a].hasOwnProperty(e)&&0==e.indexOf("sub_")&&void 0!=t.data[a][e]&&t.data[a][e].length>0&&(t.dataList.length<F?(t.data[a][e]=t.data[a][e].concat(t.dataList.splice(0,t.dataList.length)),T.scrollBy(0,1*C/5,!0)):(t.data[a][e]=t.data[a][e].concat(t.dataList.splice(0,F)),0===t.dataList.length||T.scrollBy(0,1*C/4,!0)),t.data[a][e].length===Number(s.subTableLength)?g(function(){t.nextP=!1},1e3):t.nextP=!0,g(function(){b.hideLoading()},500));console.log(t.data)},10)},g(function(){angular.element("span[class='form_text_color_blue tab_download noprint']").remove()},200),t.clickRightSave=function(){if(r.set("viewFormCacheWork",null),c.prototype.setUserRole(t.data),c.prototype.setHtmlData(t.htmlContent),c.prototype.setPermissionData(t.permission),f.form_check(t,1)){c.prototype.setCheckFlag(!0);var a="";void 0!=s.waitWorkPassDate&&""!=s.waitWorkPassDate&&(a={taskId:angular.fromJson(s.waitWorkPassDate).taskId,procInstId:angular.fromJson(s.waitWorkPassDate).procInstId}),n.isPC||ionic.Platform.isIPad()||screen.orientation.lock("default"),k(),c.prototype.setSignData({data:t.data,sign:t.sign}),c.prototype.setLongFormEnlargementData(t.dataList),m.stateGoUtils(!0,"tab.view-form",{waitWorkPassDate:angular.toJson(a),enlargement:"enlargement",titleFlag:D,workWaitData:t.workWaitData,notification:s.notification,type:s.type,information:s.information,NotificationItem:s.NotificationItem,notificationDetail:s.notificationDetail},"left")}else for(var e in t.data)for(var i in t.data[e])t.data[e].hasOwnProperty(i)&&0==i.indexOf("sub_")&&(t.tableFlagE=!0,void 0!=t.data[e][i]&&t.data[e][i].length>0&&(t.data[e][i]=t.data[e][i].slice(0,F),0==t.dataList.length?t.nextP=!1:t.dataList.length<x?(t.data[e][i]=t.dataList,t.nextP=!1):t.dataList.length>F&&(t.data[e][i]=t.dataList.slice(0,F),t.nextP=!0,n.isPC?alert("此表单为长数据表单，共"+t.dataList.length+"条数据,点击加载获取更多数据"):w.showLongBottom("此表单为长数据表单，共"+t.dataList.length+"条数据,上拉获取更多数据"))))},t.$on("$ionicView.afterLeave",function(){n.isPC||ionic.Platform.isIPad()||screen.orientation.lock("default")}),t.$on("$ionicView.unloaded",function(){n.isPC||ionic.Platform.isIPad()||screen.orientation.lock("default")}),window.addEventListener("orientationchange",function(a){g(function(){switch(T.scrollTop(),window.orientation){case 0:t.isShowTop=!0;break;case 90:t.isShowTop=!1;break;case-90:t.isShowTop=!1}},100)})}])}();
!function(){"use strict";var app=angular.module("community.controllers.formHandle",[]);app.controller("FormHandleController",["$scope","$state","$ionicNativeTransitions","$rootScope","$timeout","$stateParams","$ionicScrollDelegate","$isMobile","$interval","auth_events","storageService","timeout","stateGoHelp","serverConfiguration","viewFormService","scopeData","$ionicActionSheet","$ionicPopup","T","mine","$cordovaToast","Camera","MineService","md5","$ionicHistory","GetRequestService",function($scope,$state,$ionicNativeTransitions,$rootScope,$timeout,$stateParams,$ionicScrollDelegate,$isMobile,$interval,auth_events,storageService,timeout,stateGoHelp,serverConfiguration,viewFormService,scopeData,$ionicActionSheet,$ionicPopup,T,mine,$cordovaToast,Camera,MineService,md5,$ionicHistory,GetRequestService){function isTrue(e){for(var o=0,t=e.length;o<t;o++)"undefined"!=typeof e[o].img&&0!=e[o].img.length?1!=e[o].img.imgFail&&1!=e[o].img.imgSuccess||(agreeImgFlag=!1):"undefined"!=typeof e[o].audio&&0!=e[o].audio.length&&(1!=e[o].audio.voiceFail&&1!=e[o].audio.voiceSuccess||(agreeVoiceFlag=!1))}function recordAudio(){$isMobile.IOS?window.requestFileSystem(LocalFileSystem.PERSISTENT,0,function(e){e.root.getDirectory("xbrother",{create:!0},function(e){var o,t;o=cordova.file.documentsDirectory.substr(7,cordova.file.documentsDirectory.length-7),t=e.fullPath.substr(1,e.fullPath.length-1);var a=o+t+(new Date).getTime()+"myrecord.m4a";medioRec=new Media(a,function(){audioSuccess(a,count,$scope.documents.length)},function(e){audioFail()}),runAudio(a,$scope.documents.length)},onErrorCreateFile)},onErrorLoadFs):$isMobile.Android&&window.resolveLocalFileSystemURI(cordova.file.externalRootDirectory,function(e){e.getDirectory("OAdemo",{create:!0,exclusive:!1},function(e){var o="/sdcard/OAdemo/"+(new Date).getTime()+"myrecord.m4a";medioRec=new Media(o,function(){audioSuccess(o,count,$scope.documents.length)},function(e){audioFail()}),runAudio(o,$scope.documents.length)},function(){flagBack=!1,$isMobile.isPC||$cordovaToast.showShortBottom(T.translate("view-form.create-error"))})})}function playAudio(e,o){my_media=new Media(e,function(){},function(e){}),my_media.play(),$timeout(function(){my_media.stop(),my_media.release()},o)}function runAudio(e,o){$scope.recording||(flagBack?$isMobile.isPC||$cordovaToast.showShortCenter(T.translate("form-handle.media-no-next-text")):(flagBack=!0,medioRec.startRecord(),$timeout(function(){flagBack=!1},1500)),intervalTimer=$interval(function(){count+=1,count>50&&($scope.changeTime=!0,$scope.voiceHint=!1,imgCount-=1,$scope.changeImg="app/view-form/img/"+imgCount+".png",count>59&&($scope.changeTime=!1,medioRec.stopRecord(),imgCount=10,$scope.documents.push({msg:"",img:"",audio:{src:e,num:count,voiceSuccess:!0,voiceFail:!1},index:o}),uploadAudio("busisssssId",account,"myrecord.m4a",e),$interval.cancel(intervalTimer)))},1e3),timer=$timeout(function(){medioRec.stopRecord(),imgCount=10,$scope.changeTime=!1,$interval.cancel(intervalTimer),$timeout.cancel(timer)},timeCount60))}function audioSuccess(e,o,t){flagBack=!1,o>0&&o<60?($scope.documents.push({msg:"",img:"",audio:{src:e,num:o,voiceSuccess:!0,voiceFail:!1},index:t}),uploadAudio("busisssssId",account,"myrecord.m4a",e)):($scope.voiceHint=!1,$scope.changeTime=!1,flagBack=!0,$timeout(function(){flagBack=!1},700),$isMobile.isPC||$cordovaToast.showShortCenter(T.translate("form-handle.media-text"))),$timeout.cancel(timer),$interval.cancel(intervalTimer),medioRec.stopRecord(),medioRec.release()}function audioFail(){$scope.voiceHint=!1,$scope.changeTime=!1,flagBack=!1,$timeout.cancel(timer),$interval.cancel(intervalTimer),medioRec.stopRecord(),medioRec.release(),$isMobile.isPC||$cordovaToast.showShortBottom(T.translate("form-handle.media-err"))}function onErrorCreateFile(e){flagBack=!1,$isMobile.isPC||$cordovaToast.showShortBottom(T.translate("view-form.file-error"))}function onErrorLoadFs(e){$isMobile.isPC||$cordovaToast.showShortBottom(T.translate("view-form.file-loading-error"))}function compress(e){var o=new Image;return o.src=e,new Promise(function(e,t){o.onload=function(){if(o.src.length){o.src.length}var t,a=o.width,i=o.height;(t=a*i/4e6)>1?(t=Math.sqrt(t),a/=t,i/=t):t=1;var s=document.createElement("canvas");s.width=a,s.height=i;var n=s.getContext("2d");n.fillStyle="#fff",n.fillRect(0,0,s.width,s.height);var c,r=document.createElement("canvas"),p=r.getContext("2d");if((c=a*i/1e6)>1){c=~~(Math.sqrt(c)+1);var l=~~(a/c),m=~~(i/c);r.width=l,r.height=m;for(var d=0;d<c;d++)for(var $=0;$<c;$++)p.drawImage(o,d*l*t,$*m*t,l*t,m*t,0,0,l,m),n.drawImage(r,d*l,$*m,l,m)}else n.drawImage(o,0,0,a,i);var u=s.toDataURL("image/jpeg",.3);r.width=r.height=s.width=s.height=0,e(u)}})}function isIndexOf(e){$scope.documents.indexOf($scope.documentImg)==-1?$timeout(function(){$scope.$apply(function(){$scope.documents[e-1].img.imgSuccess=!1,$scope.documents[e-1].img.imgFail=!0,$scope.documentImg=""})},100):$scope.documents.indexOf($scope.documentImg)>-1&&($scope.documentImg.img.imgSuccess=!0,$scope.documentImg.img.imgFail=!1,$timeout(function(){$scope.$apply(function(){$scope.documentImg.img.imgSuccess=!1,$scope.documentImg.img.imgFail=!0,$scope.documentImg=""})},100))}function uploadBase64(e,o,t,a){var i=serverConfiguration.baseApiUrl+"app/attachment/v2/uploadBase64",s={businessPkid:e,account:o,fileName:t,fileStream:a,fileIndex:$scope.documents.length};viewFormService.uploadData(i,s).then(function(e){$scope.attachmentPkids.push(e.data.attachment_pkid),$scope.attachmentPkidList=$scope.attachmentPkids.join(","),"0"==e.status?$scope.documents.indexOf($scope.documentImg)==-1?$timeout(function(){$scope.$apply(function(){$scope.documents[e.data.fileIndex-1].img.imgSuccess=!1,$scope.documentImg=""})},100):$scope.documents.indexOf($scope.documentImg)>-1&&($scope.documentImg.img.imgSuccess=!0,$scope.documentImg.img.imgFail=!1,$timeout(function(){$scope.$apply(function(){$scope.documentImg.img.imgSuccess=!1,$scope.documentImg=""})},100)):isIndexOf(e.data.fileIndex-1)},function(e){isIndexOf($scope.documents.length-1)})}function uploadAudio(businessPkid,account,fileName,src){var fileURL="cdvfile://"+src,win=function(r){var result=eval("("+r.response+")");$scope.attachmentPkids.push(result.data.attachment_pkid),$scope.attachmentPkidList=$scope.attachmentPkids.join(","),$scope.documents.indexOf($scope.documentVoice)==-1?$timeout(function(){$scope.$apply(function(){$scope.documents[result.data.fileIndex-1].audio.voiceSuccess=!1,$scope.documentVoice=""})},100):$scope.documents.indexOf($scope.documentVoice)>-1&&($scope.documentVoice.audio.voiceSuccess=!0,$scope.documentVoice.audio.voiceFail=!1,$timeout(function(){$scope.$apply(function(){$scope.documentVoice.audio.voiceSuccess=!1,$scope.documentVoice=""})},100))},fail=function(e){$scope.documents.indexOf($scope.documentVoice)==-1?$timeout(function(){$scope.$apply(function(){for(var e,o=[],t=0;t<$scope.documents.length;t++){o.push($scope.documents[t]);for(var a=0;a<o.length;a++)o[a].audio.src==src&&(e=o[a].index)}$scope.documents[e].audio.voiceSuccess=!1,$scope.documents[e].audio.voiceFail=!0,$scope.documentVoice=""})},100):$scope.documents.indexOf($scope.documentVoice)>-1&&($scope.documentVoice.audio.voiceSuccess=!0,$scope.documentVoice.audio.voiceFail=!1,$timeout(function(){$scope.$apply(function(){$scope.documentVoice.audio.voiceSuccess=!1,$scope.documentVoice.audio.voiceFail=!0,$scope.documentVoice=""})},100))},url=serverConfiguration.baseApiUrl+"app/attachment/v2/upload",fileNameTime=Date.parse(new Date)+".m4a",param={businessPkid:businessPkid,account:account,fileName:fileNameTime,fileIndex:$scope.documents.length},options=new FileUploadOptions;options.params=param,options.mimeType="video/mp4",options.fileName=fileNameTime+".mp4",options.fileKey="fileStream";var ft=new FileTransfer;ft.upload(fileURL,encodeURI(url),win,fail,options)}function temporaryData(e,o,t,a,i,s,n){var c=serverConfiguration.baseApiUrl+"app/approve/v1/temporarySave",r={account:e,taskId:o,procInstId:t,opinion:a,data:angular.toJson(i).toString().replace(/\"/g,'"'),attachmentPkids:s,isLoading:n};GetRequestService.getRequestDataJson(c,r,n,"POST","application/json").then(function(e){$scope.state=e.state,"0"==$scope.state&&($scope.$emit("clearStorageFormData"),$scope.workWaitData=$stateParams.workWaitData,storageService.set("needRemberPosition",!0),stateGoHelp.stateGoUtils(!0,"tab.waitWork",{titleFlag:$scope.titleFlag,workWaitData:$scope.workWaitData},"left"))},function(e){$isMobile.isPC||$cordovaToast.showShortBottom(T.translate("publicMsg.requestErr"))})}function terminateData(e,o,t,a,i,s,n){var c=serverConfiguration.baseApiUrl+"app/approve/v1/terminate",r={account:e,procInstId:o,taskId:t,opinion:a,attachmentPkids:i,messageType:s,isLoading:n};GetRequestService.getRequestDataJson(c,r,n,"POST","application/json").then(function(e){$scope.state=e.state,"0"==$scope.state&&($scope.workWaitData=$stateParams.workWaitData,storageService.set("needRemberPosition",!0),stateGoHelp.stateGoUtils(!0,"tab.waitWork",{titleFlag:$scope.titleFlag,workWaitData:$scope.workWaitData},"left"))},function(e){$isMobile.isPC||$cordovaToast.showShortBottom(T.translate("publicMsg.requestErr"))})}function saveReply(e,o,t,a,i){var s=serverConfiguration.baseApiUrl+"app/approve/v1/saveReply",n={account:e,headPkid:o,content:t,attachmentPkids:a,isLoading:i};GetRequestService.getRequestDataJson(s,n,i,"POST","application/json").then(function(e){if("0"==e.state){var o={taskId:angular.fromJson($stateParams.waitWorkPassDate).taskId,procInstId:angular.fromJson($stateParams.waitWorkPassDate).procInstId};$scope.workType=$stateParams.type,$scope.title=$stateParams.title,$scope.titleFlag=$stateParams.titleFlag,$scope.workWaitData=$stateParams.workWaitData,storageService.set("sizerBackRequest","backRequestSave"),stateGoHelp.stateGoUtils(!0,"tab.view-form",{savereply:"savereply",workWaitData:$scope.workWaitData,waitWorkPassDate:angular.toJson(o),type:$stateParams.type,titleName:$scope.title,titleFlag:$scope.titleFlag,notification:$stateParams.notification,information:$stateParams.information,NotificationItem:$stateParams.NotificationItem,notificationDetail:$stateParams.notificationDetail},"left")}else $isMobile.isPC?alert(T.translate("form-handle.reply-err")):$cordovaToast.showShortBottom(T.translate("form-handle.reply-err"))},function(e){$isMobile.isPC||$cordovaToast.showShortBottom(T.translate("publicMsg.requestErr"))})}function approveData(e,o,t,a,i,s,n,c,r,p,l){var m=serverConfiguration.baseApiUrl+"app/approve/v2/approve",d={account:e,taskId:o,procInstId:t,actionName:a,opinion:i,data:angular.toJson(s).toString().replace(/\"/g,'"'),attachmentPkids:n,flagType:c,password:r,follow:p};GetRequestService.getRequestDataJson(m,d,l,"POST","application/json").then(function(e){$scope.state=e.state,console.log($scope.state);var o={isSync:"0",isAsync:"100"};$scope.state!==o.isSync&&$scope.state!==o.isAsync||($scope.$emit("clearStorageFormData"),$isMobile.isPC||$cordovaToast.showShortBottom(T.translate("form-handle.handle-success")),$scope.workWaitData=$stateParams.workWaitData,$scope.state===o.isSync&&storageService.set("FORM_HANDLE_ID",t),$ionicNativeTransitions.goBack(-2))},function(e){$isMobile.isPC||$cordovaToast.showShortBottom(T.translate("publicMsg.requestErr"))})}function signManage(e,o){for(var t=0;t<sign.length;t++){$scope.signList=sign[t].split(".");for(var a=1;a<$scope.signList.length;a++)1==newFandleData.hasOwnProperty($scope.signList[a])?$scope.newData=newFandleData[$scope.signList[a]]:o?$scope.newData[$scope.signList[a]]=e.signatureId:$scope.newData[$scope.signList[a]]=""}return newFandleData}if($rootScope.hideTabs=!0,$rootScope.toBack=!0,$scope.hasTop=!1,$scope.userName=storageService.get(auth_events.name,null),$scope.workWaitData=$stateParams.workWaitData,$scope.recording=!1,$scope.sendLog=!1,void 0!=$stateParams.workWaitData&&""!=$stateParams.workWaitData&&($scope.workWaitData=angular.fromJson($scope.workWaitData)),$isMobile.Android){var src="/sdcard/OAdemo/demo_myrecord.m4a",myMedia=new Media(src,function(){},function(e){});myMedia.startRecord(),$timeout(function(){myMedia.stopRecord(),myMedia.release()},100)}$scope.$on("$ionicView.beforeEnter",function(e,o){o.enableBack=!0,$rootScope.hideTabs=!0,$rootScope.bell=!1,$rootScope.toBack=!0,$scope.documents=[],$scope.replyContents=[],$scope.attachmentPkids=[],$scope.attachmentPkidList="",$scope.actionName="",$scope.opinion="",$scope.endReason="",$scope.messageType="",$scope.newData={},$scope.signList,$scope.signatureId="",$scope.opinionFlag="",$scope.opinionType="",$scope.isTemporary=!1,$scope.maskTitle="",$scope.maskContent="";var t=$stateParams.reply;"reply"==t?($scope.hasTop=!1,$scope.isReply=!1,$scope.replyOption=!0,$rootScope.toBack=!0,storageService.set("backReply","backReply"),$rootScope.titleData=T.translate("form-handle.form-reply-title")):($scope.hasTop=!0,$scope.isReply=!0,$scope.replyOption=!1,$rootScope.titleData=T.translate("form-handle.form-handle-title")),$rootScope.$ionicGoBack=function(){if(0==$scope.documents.length)stateGoHelp.stateGoUtils(!1);else{$scope.item=T.translate("form-handle.attachment-undisposed-alert");var e=$ionicPopup.confirm({title:T.translate("publicMsg.popTitle"),template:"<div><p>{{item}}</p></div>",cancelText:T.translate("publicMsg.cancel"),cancelType:"button-assertive",okText:T.translate("publicMsg.sure"),okType:"button-positive",scope:$scope});e.then(function(e){e&&stateGoHelp.stateGoUtils(!1)})}},$isMobile.Android&&angular.element(document.querySelectorAll(".tabs-icon-top")).addClass("tabs-item-hide")}),$scope.$on("$ionicView.enter",function(){$rootScope.hideTabs=!0,$rootScope.bell=!1,$rootScope.toBack=!0,$isMobile.Android&&angular.element(document.querySelectorAll(".tabs-icon-top")).addClass("tabs-item-hide")}),$scope.workType=$stateParams.type,$scope.reply=$stateParams.reply,$scope.title=$stateParams.title,$scope.titleFlag=$stateParams.titleFlag;var waitWorkPassDate=$stateParams.waitWorkPassDate;if(void 0!=waitWorkPassDate&&""!=waitWorkPassDate)var paramData=angular.fromJson(waitWorkPassDate),taskId=paramData.taskId,procInstId=paramData.procInstId,pkid=paramData.pkid;var account=storageService.get(auth_events.userId,null),data=scopeData.prototype.getSignData();if(void 0!=data&&""!=data){var sign=data.sign,newFandleData=data.data;$scope.sendLog&&$scope.commitError(JSON.stringify(newFandleData))}var viewScroll=$ionicScrollDelegate.$getByHandle("messageDetailsScroll");$scope.hasMsg=!1;var textareaId=document.getElementById("textareaId");$scope.isShowDialog=!1;var followedFlag=storageService.get(auth_events.followed,"0");"0"==followedFlag?($scope.isFollow=!1,$scope.isFollowText="关",$scope.follow="0"):"1"==followedFlag&&($scope.isFollow=!0,$scope.isFollowText="开",$scope.follow="1"),$scope.isTemporary=!1;var agreeImgFlag=!0,agreeVoiceFlag=!0;$scope.selectOption=function(e){"跟踪"==e?($scope.isFollow=!$scope.isFollow,$scope.isFollow?($scope.isFollowText="开",$scope.follow="1"):($scope.isFollowText="关",$scope.follow="0")):"暂存"==e?"0"==$rootScope.enableBtn?(agreeImgFlag=!0,agreeVoiceFlag=!0,isTrue($scope.documents),agreeImgFlag&&agreeVoiceFlag?($scope.opinionType="temporary",$scope.isTemporary=!0,$scope.maskTitle=T.translate("form-handle.temporary-title"),$scope.maskContent=T.translate("form-handle.temporary-content")):$isMobile.isPC||$cordovaToast.showShortBottom(T.translate("form-handle.agree-opinion-err"))):$isMobile.isPC?alert(T.translate("form-handle.hasPermission")):$cordovaToast.showShortBottom(T.translate("form-handle.hasPermission")):"终止"==e&&("0"==$rootScope.enableBtn?(agreeImgFlag=!0,agreeVoiceFlag=!0,isTrue($scope.documents),agreeImgFlag&&agreeVoiceFlag?($scope.opinionType="stop",$scope.isTemporary=!0,$scope.maskTitle=T.translate("form-handle.stop-title"),$scope.maskContent=T.translate("form-handle.stop-content")):$isMobile.isPC||$cordovaToast.showShortBottom(T.translate("form-handle.agree-opinion-err"))):$isMobile.isPC?alert(T.translate("form-handle.hasPermission")):$cordovaToast.showShortBottom(T.translate("form-handle.hasPermission"))),$scope.isShowDialog=!$scope.isShowDialog},$scope.selectMoreOption=function(){$scope.isShowDialog=!$scope.isShowDialog},$scope.getOpinion=function(e){if(agreeImgFlag=!0,agreeVoiceFlag=!0,isTrue($scope.documents),agreeImgFlag&&agreeVoiceFlag)if("agree"==e){$scope.opinionFlag="agree",$scope.actionName="agree";var o={account:account,taskId:taskId,procInstId:procInstId,actionName:$scope.actionName,opinion:$scope.opinion,attachmentPkidList:$scope.attachmentPkidList,follow:$scope.follow};$scope.approveFlag=storageService.get(mine.approveSwitchKey,!1),$scope.signatureFlag=storageService.get(mine.signatureSwitchKey,!1),"false"==$scope.approveFlag&&($scope.approveFlag=!1),"false"==$scope.signatureFlag&&($scope.signatureFlag=!1),0==sign.length?($scope.isTemporary=!0,$scope.maskTitle=T.translate("form-handle.agree-title"),$scope.maskContent=T.translate("form-handle.agree-content")):0==$scope.approveFlag?$scope.signatureFlag?($scope.workWaitData=$stateParams.workWaitData,stateGoHelp.stateGoUtils(!0,"gesture.signInGestureLock",{workWaitData:$scope.workWaitData,paramData:angular.toJson(o),flagType:"0",webType:"formHandle",titleFlag:$scope.titleFlag},"left")):0==$scope.signatureFlag&&($scope.isChangePW=!0,$scope.maskTitle=T.translate("form-handle.signature-text")):$scope.approveFlag&&($scope.isTemporary=!0,$scope.maskTitle=T.translate("form-handle.agree-title"),$scope.maskContent=T.translate("form-handle.agree-content"))}else"reject"==e&&("0"==$rootScope.enableBtn?($scope.opinionFlag="reject",$scope.isTemporary=!0,$scope.actionName="reject",$scope.maskTitle=T.translate("form-handle.reject-title"),$scope.maskContent=T.translate("form-handle.reject-content")):$isMobile.isPC?alert(T.translate("form-handle.hasPermission")):$cordovaToast.showShortBottom(T.translate("form-handle.hasPermission")));else $isMobile.isPC||$cordovaToast.showShortBottom(T.translate("form-handle.agree-opinion-err"))},$scope.goPwDash=function(){var e=serverConfiguration.baseApiUrl+"app/common/v1/signatureValidate",o=document.getElementById("handlePassword").value,t={account:storageService.get(auth_events.userId,null),signaturePwd:md5.createHash(o)};MineService.getMineData(e,t).then(function(e){"0"==e.state?($scope.newData=signManage(e,!0),approveData(account,taskId,procInstId,$scope.actionName,$scope.opinion,$scope.newData,$scope.attachmentPkidList,"1",t.signaturePwd,$scope.follow,!0),$scope.isChangePW=!1):($isMobile.isPC?alert(T.translate("form-handle.gesture-error")):$cordovaToast.showShortBottom(T.translate("form-handle.gesture-error")),$scope.isChangePW=!1)},function(e){})},$scope.pwCancel=function(){$scope.isChangePW=!1,document.getElementById("handlePassword").value=""},$scope.goDash=function(){if($scope.isTemporary=!1,$scope.opinionFlag="agree","temporary"==$scope.opinionType)temporaryData(account,taskId,procInstId,$scope.opinion,newFandleData,$scope.attachmentPkidList,!0);else if("stop"==$scope.opinionType)terminateData(account,procInstId,taskId,$scope.opinion,$scope.attachmentPkidList,$scope.messageType,!0);else if("agree"==$scope.actionName)if(0==sign.length)approveData(account,taskId,procInstId,$scope.actionName,$scope.opinion,newFandleData,$scope.attachmentPkidList,"-1","",$scope.follow,!0);else{var e=serverConfiguration.baseApiUrl+"app/common/v1/signatureValidate",o={account:storageService.get(auth_events.userId,null),signaturePwd:T.translate("form-handle.need-not-signature-pwd")};MineService.getMineData(e,o).then(function(e){"0"==e.state&&($scope.newData=signManage(e,!0),$scope.sendLog&&$scope.commitError(JSON.stringify($scope.newData)),approveData(account,taskId,procInstId,$scope.actionName,$scope.opinion,$scope.newData,$scope.attachmentPkidList,"-1",o.signaturePwd,$scope.follow,!0))},function(e){})}else"reject"==$scope.actionName?($scope.newData=signManage(null,!1),approveData(account,taskId,procInstId,$scope.actionName,$scope.opinion,$scope.newData,$scope.attachmentPkidList,"-1","",$scope.follow,!0)):(storageService.set("needRemberPosition",!0),stateGoHelp.stateGoUtils(!0,"tab.waitWork",{titleFlag:$scope.titleFlag,workWaitData:angular.fromJson($scope.workWaitData)},"left"))},$scope.cancel=function(){$scope.isTemporary=!1};var imgDiv=document.getElementById("imgDiv");$scope.audioShow=!1,$scope.goShowAudio=function(){$scope.audioShow=!$scope.audioShow,$scope.hasMsg=!1,$scope.emoFlag=!1,$scope.emoFlagA=!1};var medioRec,timer,intervalTimer,imgCount=10;$scope.isVoice=!1,$scope.changeTime=!1,$scope.voiceHint=!1;var flagBack=!1,my_media,timeCount60=6e4,count;$scope.recordAudio=function(){$isMobile.Android&&(myMedia.stopRecord(),myMedia.release()),count=0,$scope.voiceHint=!0,flagBack?$isMobile.isPC||$cordovaToast.showShortCenter(T.translate("form-handle.media-no-next-text")):recordAudio()},$scope.onReleaseRecord=function(){$scope.recording=!0,$scope.voiceHint=!1,$scope.changeTime=!1,flagBack=!0,$timeout(function(){medioRec.stopRecord(),medioRec.release(),$timeout.cancel(timer),$interval.cancel(intervalTimer),$timeout(function(){medioRec.stopRecord(),medioRec.release(),flagBack=!1,$timeout.cancel(timer),$interval.cancel(intervalTimer),$timeout(function(){$scope.recording=!1},500)},1e3)},500)},$scope.playerAudio=function(e){playAudio(e,timeCount60)};var inputText=document.getElementById("offsetHeight"),heightOther=11,imgDivHeight=244,bottomScroll=function(){$timeout(function(){viewScroll.scrollBottom()},50)};if($isMobile.Android&&($scope.emoFlagA=!1),$isMobile.IOS){var inputHeight=inputText.offsetHeight;imgDiv.style.top=inputHeight-heightOther+"px"}if(!$isMobile.isPC){$scope.emoFlag=!1;var contentID=document.getElementById("message-detail-content")}$scope.showEmoFlag=function(){if($isMobile.Android){var e=inputText.offsetHeight;imgDiv.style.top=e-heightOther+"px",$scope.emoFlag=!$scope.emoFlag;var o=imgDiv.offsetHeight;$scope.emoFlag?$scope.emoFlag&&(contentID.style.bottom=e+o+"px !important;",$scope.emoFlagA=!0,$scope.audioShow=!1):(contentID.style.bottom=e+"px",$scope.emoFlagA=!1),bottomScroll();var t=["android.permission.WRITE_EXTERNAL_STORAGE","android.permission.CAMERA"];PermissionsPlugin.addPermissions("权限",function(){},function(){},t)}else $isMobile.IOS&&($scope.emoFlag=!$scope.emoFlag,$scope.emoFlag?contentID.style.bottom=inputHeight+"px":contentID.style.bottom=inputHeight+"px",$scope.emoFlag&&($scope.audioShow=!1),bottomScroll())},$scope.hide=function(){$isMobile.Android?($scope.emoFlag=!1,$scope.emoFlagA=!1,bottomScroll()):$isMobile.IOS&&(window.addEventListener("native.keyboardshow",function(e){$scope.emoFlag=!1,contentID.style.bottom=e.keyboardHeight+inputHeight+"px",viewScroll.scrollBottom()}),window.addEventListener("native.keyboardhide",function(e){$scope.emoFlag?contentID.style.bottom=inputHeight+imgDivHeight+"px":contentID.style.bottom=inputHeight+"px",viewScroll.scrollBottom()}))},window.addEventListener("native.keyboardshow",function(e){$isMobile.Android?($scope.emoFlag=!1,viewScroll.scrollBottom()):$isMobile.IOS&&($scope.emoFlag=!1,contentID.style.bottom=e.keyboardHeight+inputHeight+"px",bottomScroll())}),window.addEventListener("native.keyboardhide",function(e){$isMobile.Android?viewScroll.scrollBottom():$isMobile.IOS&&($scope.emoFlag?contentID.style.bottom=inputHeight+"px":contentID.style.bottom=inputHeight+"px",bottomScroll())}),/iphone/i.test(navigator.userAgent)||/ipad/i.test(navigator.userAgent)?$scope.formPulldown="ios":$scope.formPulldown="android";var fileNameTime=Date.parse(new Date)+".jpg";$scope.chooseMedia=function(e){switch(e){case"photoLibrary":e=navigator.camera.PictureSourceType.CAMERA;break;case"takePhoto":e=navigator.camera.PictureSourceType.PHOTOLIBRARY;break;default:e=navigator.camera.PictureSourceType.PHOTOLIBRARY}if(e==navigator.camera.PictureSourceType.PHOTOLIBRARY){var o={quality:80,destinationType:navigator.camera.DestinationType.FILE_URI,correctOrientation:!0,sourceType:e,cameraDirection:navigator.camera.Direction.BACK};Camera.getPicture(o).then(function(e){if($isMobile.Android){var o=e.lastIndexOf("/"),t=e.lastIndexOf("?"),a=e.substring(o+1,t);fileNameTime=a}else fileNameTime=Date.parse(new Date)+".jpg";$isMobile.IOS&&(e=window.Ionic.normalizeURL(e)),compress(e).then(function(e){$scope.documents.push({msg:"",img:{src:e,imgSuccess:!0,imgFail:!1,imgName:fileNameTime},audio:"",index:$scope.documents.length}),$scope.replyContents.push($scope.send_content),uploadBase64(null,account,fileNameTime,e,!0),$scope.emoFlag=!1,$scope.emoFlagA=!1})},function(e){})}else{var o={quality:80,destinationType:navigator.camera.DestinationType.FILE_URI,correctOrientation:!0,sourceType:e,cameraDirection:navigator.camera.Direction.BACK};Camera.getPicture(o).then(function(e){fileNameTime=Date.parse(new Date)+".jpg",$isMobile.IOS&&(e=window.Ionic.normalizeURL(e)),compress(e).then(function(e){$scope.documents.push({msg:"",img:{src:e,imgSuccess:!0,imgFail:!1,imgName:fileNameTime},audio:"",index:$scope.documents.length}),$scope.replyContents.push($scope.send_content),uploadBase64(null,account,fileNameTime,e,!0),$scope.emoFlag=!1,$scope.emoFlagA=!1},function(e){})})}},$scope.repeatVoice=function(e){$scope.documentVoice=e,$scope.isVoice=!0,$scope.voiceTitle=T.translate("form-handle.repeat-voice-title"),$scope.voiceContent=T.translate("form-handle.repeat-voice-content")},$scope.repeatImg=function(e){$scope.documentImg=e,$scope.isVoice=!0,$scope.voiceTitle=T.translate("form-handle.repeat-voice-title"),$scope.voiceContent=T.translate("form-handle.repeat-voice-content")},$scope.goVoice=function(){$scope.documentVoice&&($scope.documentVoice.audio.voiceSuccess=!0,$scope.documentVoice.audio.voiceFail=!1,uploadAudio("businessPkid",account,"myrecord.m4a",$scope.documentVoice.audio.src)),$scope.documentImg&&($scope.documentImg.img.imgSuccess=!0,$scope.documentImg.img.imgFail=!1,fileNameTime=$scope.documentImg.img.imgName,uploadBase64(null,account,fileNameTime,$scope.documentImg.img.src,!0)),$scope.isVoice=!1},$scope.voiceCancel=function(){$scope.isVoice=!1},$scope.send_content="",$scope.msgLength=0,$scope.allLength=0,$scope.$watch("send_content",function(e,o,t){$scope.allLength=e.length+$scope.msgLength,$scope.allLength>500&&($scope.send_content=o,$isMobile.isPC||$cordovaToast.showShortBottom(T.translate("form-handle.text-error")))}),$scope.sent=function(){$scope.msgLength=$scope.msgLength+$scope.send_content.length,$scope.documents.push({msg:$scope.send_content,img:"",audio:"",index:$scope.documents.length}),$scope.replyContents.push($scope.send_content),$scope.opinion=$scope.replyContents.join(","),$scope.endReason=$scope.send_content,textareaId.value="",$scope.send_content="",""==textareaId.value&&($scope.hasMsg=!1,$scope.send_content="")},$scope.textChange=function(e){$scope.send_content?$scope.hasMsg=!0:$scope.hasMsg=!1,$scope.length=0},"reply"==$scope.reply&&($rootScope.hideTabs=!0,$scope.clickRightSave=function(){$rootScope.hideTabs=!0,agreeImgFlag=!0,agreeVoiceFlag=!0,isTrue($scope.documents),agreeImgFlag&&agreeVoiceFlag?""!=$scope.opinion||""!=$scope.attachmentPkidList?saveReply(account,pkid,$scope.opinion,$scope.attachmentPkidList,!0):$isMobile.isPC?alert(T.translate("form-handle.save-error")):$cordovaToast.showShortBottom(T.translate("form-handle.save-error")):$isMobile.isPC||$cordovaToast.showShortBottom(T.translate("form-handle.agree-opinion-err"))}),$scope.commitError=function(e){var o=serverConfiguration.baseApiUrl+"app/common/uploadError",t={errorMsg:e,account:storageService.get(auth_events.userId,null)};GetRequestService.getRequestData(o,t,!0,"POST").then(function(e){console.log(e)},function(e){$isMobile.isPC||$cordovaToast.showShortBottom(T.translate("publicMsg.requestErr"))})}}])}();
!function(){"use strict";var o=angular.module("community.controllers.formHandle");o.controller("SignaturePasswordCtrl",["$scope","$state","$timeout","$ionicNativeTransitions","$rootScope","stateGoHelp",function(o,e,s,t,d,n){o.onePasswordModel="",o.twoPasswordModel="",o.threePasswordModel="",o.fourPasswordModel="",o.fivePasswordModel="",o.sixPasswordModel="";var r="0123456789";o.$on("$ionicView.beforeEnter",function(){s(function(){document.getElementById("onePassword").focus()},100)}),o.$watch("onePasswordModel",function(o,e){0!=o.length&&r.indexOf(o)>=0&&document.getElementById("twoPassword").focus()},!1),o.$watch("twoPasswordModel",function(o,e){0!=o.length&&r.indexOf(o)>=0&&document.getElementById("threePassword").focus()},!1),o.$watch("threePasswordModel",function(o,e){0!=o.length&&r.indexOf(o)>=0&&document.getElementById("fourPassword").focus()},!1),o.$watch("fourPasswordModel",function(o,e){0!=o.length&&r.indexOf(o)>=0&&document.getElementById("fivePassword").focus()},!1),o.$watch("fivePasswordModel",function(o,e){0!=o.length&&r.indexOf(o)>=0&&document.getElementById("sixPassword").focus()},!1),o.$watch("sixPasswordModel",function(e,s){if(0!=e.length&&r.indexOf(e)>=0){o.onePasswordModel+o.twoPasswordModel+o.threePasswordModel+o.fourPasswordModel+o.fivePasswordModel+o.sixPasswordModel;n.stateGoUtils(!0,"tab.form-handle",{},"left")}},!1)}])}();
!function(){"use strict";var t=angular.module("community.controllers.viewForm");t.controller("viewFormController",["$scope","$state","$timeout","$stateParams","$rootScope","viewFormService","$ionicHistory","storageService","auth_events","serverConfiguration","scopeData","$cordovaToast","$isMobile","T","timeout","stateGoHelp","clone","application","$ionicScrollDelegate","appUtils","GetRequestService","$ionicPopup",function(t,a,e,o,n,i,r,s,l,c,d,p,h,g,f,m,u,v,w,I,D,y){function C(){var a=t.others;if(a.postscripts){var e=[];e=JSON.parse(a.postscripts),angular.forEach(e,function(t,a,o){e[a].postscriptsAttachments=angular.fromJson(o[a].attachments),e[a].content.replace(/\n/g,"<br>")})}t.postscripts=e,t.opinionFlag=!1}function b(){e(function(){t.onFormScroll("init")},100)}function k(a,e){var o=e?10*e:H;for(var n in a){t.formDataId=a[n].id_;for(var i in a[n])a[n].hasOwnProperty(i)&&0==i.indexOf("sub_")&&(t.subTableLength=a[n][i].length,a[n][i]=$.fn.sortSubTable(a[n][i],"seqnum","asc"),void 0!=a[n][i]&&a[n][i].length>0&&(t.dataList=a[n][i].splice(0),t.nextP=t.dataList.length>o,t.isLongForm=t.dataList.length>o,a[n][i]=t.dataList.splice(0,o),t.dataList.length>0&&(h.isPC?alert("此表单为长数据表单，共"+t.subTableLength+"条数据,点击加载获取更多数据"):p.showLongBottom("此表单为长数据表单，共"+t.subTableLength+"条数据,点击获取更多数据")),d.prototype.setLongFormEnlargementData(t.dataList)))}return a}function x(t,a){var e=y.alert({title:g.translate("publicMsg.popTitle"),template:t.msg,okText:g.translate("publicMsg.sure"),okType:"button-positive"});e.then(function(t){a&&n.$ionicGoBack()})["catch"](function(t){console.log(t)})}function P(a,e,o){var r=c.baseApiUrl+a.url;delete a.url,n.viewOtherWaitWork&&(a.todoUserCode=n.todoUserCode,delete a.account),i.getViewFormData(r,a,a.isLoading,"POST").then(function(a){e?t.detailCache[o]=a:"0"==a.state?L(a):a.state==-1&&x(a,!0)},function(t){h.isPC||p.showShortBottom(g.translate("publicMsg.requestErr"))})}function L(a){if("4"===o.titleFlag)if(a.list){var e=JSON.parse(a.list);if(e.permission)var n=e.permission;if(void 0!==e.form)var i=e.form,r=i.formHtml;else h.isPC?alert(g.translate("view-form.form-empty")):p.showShortBottom(g.translate("view-form.form-empty"));e.data&&(t.data=e.data),t.htmlContent=r,d.prototype.setHtmlData(r),t.permission=n;var s={data:t.data,sign:t.sign};d.prototype.setUserRole(t.data),d.prototype.setSignData(s),d.prototype.setPermissionData(t.permission)}else h.isPC?alert("公文表单返回为空"):p.showShortBottom("公文表单返回为空");else{var l={},e=a.form?JSON.parse(a.form):"",c=e.list,f=c[0],n=f.permission;if(void 0!==f.form)var i=f.form,r=i.formHtml;else h.isPC?alert(g.translate("view-form.form-empty")):p.showShortBottom(g.translate("view-form.form-empty"));l.data=f.data,""===o.titleFlag&&t.sendLog&&t.commitError(JSON.stringify(l.data)),t.data=k(l.data,t.subTablePage),t.htmlContent=r,d.prototype.setHtmlData(r),t.permission=n;var s={data:t.data,sign:t.sign};d.prototype.setUserRole(t.data),d.prototype.setSignData(s),d.prototype.setPermissionData(t.permission),b(),t.loaded=!0}}function T(a,e,o,r){var l=c.baseApiUrl+t.urlMap[a],d=e;n.viewOtherWaitWork&&(l=c.baseApiUrl+t.urlMap[t.viewOtherWaitWork],d.todoUserCode=n.todoUserCode,delete d.account),i.getViewFormData(l,d,d.isLoading).then(function(a){s.set("formInfoData",JSON.stringify(a)),o?t.detailInfoCache[r]=a:F(a)})["catch"](function(t){console.log(t)})}function F(a){var e=a.others?JSON.parse(a.others):[];t.historysList=a.history?JSON.parse(a.history):[],t.others=e,t.flagPostscript=e.flagPostscript,t.flagPostscript&&(C(),t.postscriptFlag=!0),t.flagApproval=e.flagApproval,e.approvals&&(t.allAttachments=angular.fromJson(e.allAttachments))}function S(t,a,e,o){var n=c.baseApiUrl+"app/done/v1/retrieve",r={account:t,procInstId:a,reason:e,isLoading:o};i.getViewFormData(n,r,o).then(function(t){"0"==t.state?(h.isPC||p.showShortCenter(g.translate("view-form.retrieve-success")),m.stateGoUtils(!1,"tab.doneWork",{retrieve:"retrieve"},"left")):x(t,!1)},function(t){"0"==t.state&&(h.isPC||p.showShortCenter(g.translate("view-form.retrieve-success")))})}function W(t){var a=document.createElement("style"),e=window.innerHeight;t?e>1e3?a.innerHTML="#heightScroll{height:"+.75*e+"px!important}":window.innerWidth>666&&window.innerWidth<1e3?a.innerHTML="#heightScroll{height:"+.8*e+"px!important}":window.innerWidth>1e3?a.innerHTML="#heightScroll{height:"+.55*e+"px!important}":a.innerHTML="#heightScroll{height:"+.7*e+"px!important}":window.innerWidth<600?a.innerHTML="#heightScroll{height:"+.3*e+"px!important}":window.innerWidth>600&&window.innerWidth<1e3?a.innerHTML="#heightScroll{height:"+.45*e+"px!important}":window.innerWidth>1e3&&(a.innerHTML="#heightScroll{height:"+.6*e+"px!important}"),document.head.appendChild(a)}function N(a){t.index=a-t.pre<0?0:a-t.pre;var e=t.pre,o=t.next,n=t.requestParam.pageSize,i=Math.floor(a/n)+1,r=a-e<=0&&1===i?1:Math.floor((a-e)/n)+1,s=Math.floor((a+o)/n)+1,l=t.requestParam;l.currentPage=r,t.resultList=new Array,t.listCache=new Array,t.current=a%n+(i-r)*n,t.cacheLength=e+o+1,J(l,r,s)}function J(a,e,n){console.log(a,e,n);var r=a,d=c.baseApiUrl+"app/ctl/othertodo/v1/getOtherTodoList";i.getViewFormData(d,a,!1).then(function(a){if(t.resultList=t.resultList.concat(a.list),console.log(t.resultList,r),e<n)e++,r.currentPage++,J(r,e,n);else{var i=t.current-t.pre<0?0:t.current-t.pre,c=t.current+t.next,d=s.get(l.userId,null);t.listCache=t.resultList.slice(i,c+1);var p=t.index;for(var h in t.listCache){var g=t.listCache[h].taskId,f=t.listCache[h].procInstId;if(void 0===t.detailCache[p]){t.detailCache[p]="";var m={url:t.getDetailUrlMap[o.titleFlag],account:d,taskId:g,procInstId:f,isLoading:!1};P(m,!0,p)}void 0===t.detailInfoCache[p]&&(t.detailInfoCache[p]="",T(t.myNewTodo,{account:d,taskId:g,procInstId:f,isLoading:!1},!0,p)),p++}}})}function O(){t.flagPostscript=!1,t.postscriptFlag=!1,t.postscripts=[],t.flagApproval=!1,t.opinionFlag=!1,t.approvals=[],t.nextP=!1,t.dataList=[],t.data="",t.htmlContent="",n.dataTimeNew="",n.dataTimeNewNow="",M()}function M(){d.prototype.setLongFormEnlargementData(null),d.prototype.setUserRole(null),d.prototype.setSignData(null),d.prototype.setPermissionData(null),d.prototype.setHtmlData(null)}function A(){for(var a in t.data)for(var e in t.data[a])t.data[a].hasOwnProperty(e)&&0==e.indexOf("sub_")&&void 0!=t.data[a][e]&&t.dataList.length>0&&(t.data[a][e]=t.data[a][e].concat(t.dataList),t.dataList.length=0)}function B(){var a=d.prototype.getSignData().data;for(var e in a){if(a[e].id_!==t.formDataId)return!1;for(var o in a[e])if(a[e].hasOwnProperty(o)&&0==o.indexOf("sub_")){var n=a[e][o];if(n.length!==t.subTableLength)return!1;for(var i in n){var r=n[i];if(r.ref_id_!==a[e].id_)return!1}}}return!0}t.commitBtn=!0,n.bell=!1,n.toBack=!0,n.titleData=g.translate("form-handle.form-see-title"),t.title=o.titleName,t.titleFlag=o.titleFlag,t.sign=[],t.mask_content="",t.nowFlag=!0,t.zwZz=!1,t.zwJs=!1,t.workWaitData=o.workWaitData,n.isPdfFlag=!1,t.showUnderstandingList=!1,t.loaded=!1,t.isRetrieve=!1,t.isios=ionic.Platform.isIOS(),t.isLongForm=!1,t.detailCache={},t.detailInfoCache={},n.hideTabs=!0,t.getDetailUrlMap={"":n.viewOtherWaitWork?"app/ctl/othertodo/v1/getOtherTodoDetail":"app/myNewTodo/v1/getDetail",1:"app/done/v1/getDetail",0:"app/sent/v1/getDetail",2:"app/follow/v1/getDetail",4:"app/document/v1/getDocumentData",5:"app/understanding/v1/getDetail"},n.hideTabs=!0,n.toBack=!0,t.readers=[],t.isTemporary=!1,t.zoomingFlag=!0,n.enableBtn="0",t.dataList=[],t.data="",t.tableFlag={display:""},t.noneStyle={display:"none"},t.nextP=!1,n.jump=!0,n.titleData=g.translate("form-handle.form-see-title"),t.rightHandle=""===o.titleFlag,t.rightBack="1"===o.titleFlag,t.approvals=[],t.itemFlag="0",t.rightShow=s.get(l.userId,null),t.approvalAttachments=[],t.replys=[],t.allAttachments=[],t.postscriptsAttachments=[],t.nowTime=new Date,t.readers=[],t.dataList=[],t.nextP=!1,t.mask_content="",t.msgMaskLength=0,t.allMaskLength=0,t.myNewTodo="待办",t.done="已办",t.sent="已发",t.follow="跟踪",t.document="公文",t.understanding="知会",t.viewOtherWaitWork="其他人待办",t.urlMap={"待办":"app/myNewTodo/v2/getDetailForInfo","已办":"app/done/v2/getDetailForInfo","已发":"app/sent/v2/getDetailForInfo","跟踪":"app/follow/v2/getDetailForInfo","公文":"app/document/v1/getDocumentDataForInfo","知会":"app/understanding/v2/getDetailForInfo","其他人待办":"app/ctl/othertodo/v1/getOtherTodoDetailForInfo"},t.pre=4,t.next=4,t.preDetailCached=!1,t.preDetailInfoCached=!1,t.nextDetailCached=!1,t.nextDetailInfoCached=!1,t.subTableLength=0,t.formDataId="",t.subTablePage=1,t.sendLog=!1;var H=10,U=9,E=11;if(ionic.Platform.isIPad()&&(H=20,U=19,E=21),void 0!=o.workWaitData&&""!=o.workWaitData){t.workWaitData=angular.fromJson(t.workWaitData);t.workWaitData.workFlag}if(o.waitWorkPassDate)var _=o.waitWorkPassDate,z=angular.fromJson(_),q=z.procInstId,V=s.get(l.userId,null);var G=o.type,R=(o.enlargement,w.$getByHandle("viewFormScrollHandle")),j=w.$getByHandle("viewFormScrollHandleChild"),Z=window.innerHeight,Y="0";t.$on("$ionicView.beforeEnter",function(a,e){if(e.enableBack=!0,n.titleData=g.translate("form-handle.form-see-title"),j.scrollTop(),h.isPC)t.isShowTop=!0;else switch(window.orientation){case 0:t.isShowTop=!0;break;case 90:t.isShowTop=!1;break;case-90:t.isShowTop=!1}h.isPC||ionic.Platform.isIPad()||screen.orientation.lock("default");var i=(o.type,o.notification,d.prototype.getStateCurrentViewDataName()),c=d.prototype.getStateCurrentViewParams();n.$ionicGoBack=function(){t.$emit("clearStorageFormData");var a=r.backView();"tab.form-handle"==a.stateName||"tab.form-handle-reply"==a.stateName||"tab.form-enlargement"==a.stateName||"tab.formHandleWork"==a.stateName||"tab.work-form-enlargement"==a.stateName?(a.stateName=i,a.stateParams=c,m.stateGoUtils(!1)):m.stateGoUtils(!1)};s.get("viewFormCacheWork",null),s.get("backReply",null),o.savereply;n.viewOtherWaitWork&&(t.requestParam=angular.fromJson(o.requestParam),t.totalCount=t.requestParam.totalCount,t.cacheIndex||(t.cacheIndex=t.requestParam.index),N(t.cacheIndex));var p=o.waitWorkPassDate;if(p)var f=angular.fromJson(p),u=f.taskId,v=f.procInstId;var w=s.get(l.userId,null);if("forward"===e.direction)if("enlargement"===o.enlargement){var I=d.prototype.getSignData().data;t.data=k(I,1),t.htmlContent=d.prototype.getHtmlData(),t.permission=d.prototype.getPermissionData();var D=JSON.parse(s.get("formInfoData"));t.loaded=!0,F(D)}else{M();var y={url:t.getDetailUrlMap[o.titleFlag],account:w,taskId:u,procInstId:v,isLoading:!0};P(y),T(t.myNewTodo,{account:w,taskId:u,procInstId:v,isLoading:!1})}else{var C=s.get("subTablePage",null);s.removeItem("subTablePage");var I=d.prototype.getSignData().data;t.subTablePage=C?Number(C):t.subTablePage,t.data=k(I,t.subTablePage),t.tableFlag={display:""}}}),t.$on("$ionicView.enter",function(){if(n.hideTabs=!0,n.bell=!1,n.toBack=!0,h.isPC)W(!0);else switch(window.orientation){case 0:W(!0);break;case 90:W(!1);break;case-90:W(!1)}}),t.$on("$ionicView.leave",function(){d.prototype.setCheckFlag(null)}),t.changeAct=function(a){if(t.auditorNames=[],t.historysList){var e=t.historysList;e.list&&(t.historyData=angular.fromJson(e.list),angular.forEach(t.historyData,function(a,e,o){"待审批"==t.historyData[e].status?t.auditorNames.push(t.historyData[e].auditorName):"终止"!=t.historyData[e].status&&"结束"!=t.historyData[e].status||(t.nowFlag=!1),"终止"==t.historyData[e].status?(t.zwZz=!0,t.zzTime=t.historyData[e].completeTime,t.zzName=t.historyData[e].auditorName,t.zzOption=t.historyData[e].opinion):"结束"==t.historyData[e].status&&(t.zwJs=!0,t.jsTime=t.historyData[e].completeTime,t.jsName=t.historyData[e].auditorName,t.jsOption=t.historyData[e].opinion)}))}R.scrollTop(),0==a?(Y="0",t.itemFlag="0"):1==a?(Y="1",t.itemFlag="1"):2==a?(Y="2",t.itemFlag="2"):3==a&&(Y="3",t.itemFlag="3")},t.isActiveTab=function(t){return t==Y},window.addEventListener("orientationchange",function(){e(function(){switch(j.scrollTop(),window.orientation){case 0:t.isShowTop=!0,W(!0);break;case 90:t.isShowTop=!1,W(!1);break;case-90:t.isShowTop=!1,W(!1)}b()},100)}),t.loadMore=function(){v.showLoading(!0),t.subTablePage++,e(function(){v.hideLoading()},f.max),e(function(){for(var a in t.data)for(var o in t.data[a])t.data[a].hasOwnProperty(o)&&0==o.indexOf("sub_")&&void 0!=t.data[a][o]&&t.data[a][o].length>0&&(t.dataList.length<H?(t.data[a][o]=t.data[a][o].concat(t.dataList.splice(0,t.dataList.length)),j.scrollBy(0,1*Z/5,!0)):(t.data[a][o]=t.data[a][o].concat(t.dataList.splice(0,H)),0===t.dataList.length||j.scrollBy(0,1*Z/4,!0)),t.data[a][o].length===t.subTableLength?e(function(){t.nextP=!1},2e3):t.nextP=!0,e(function(){v.hideLoading()},500));console.log(t.data)},10)},t.clickRightHandle=function(){if(t.dataList.length>0&&A(),t.sendLog&&t.commitError(JSON.stringify(t.data)),!B())return I.showTips("view-form.form-data-null",!0,2),v.hideLoading(),!1;var a={taskId:angular.fromJson(o.waitWorkPassDate).taskId,procInstId:angular.fromJson(o.waitWorkPassDate).procInstId};m.stateGoUtils(!0,"tab.form-handle",{workWaitData:angular.toJson(t.workWaitData),waitWorkPassDate:angular.toJson(a),titleFlag:"3",notification:o.notification,information:o.information,type:o.type,notificationDetail:o.notificationDetail},"left")},t.clickRightBack=function(){t.rightHandle=!1,t.rightBack=!0,t.isTemporary=!0,t.noneStyle={display:""}},t.$watch("mask_content",function(a,e,o){t.allMaskLength=a.length+t.msgMaskLength,t.allMaskLength>30&&(t.mask_content=e,I.showTips("view-form.mask-max-err",!0,2))}),t.goYes=function(){t.allMaskLength<31&&t.allMaskLength>0?(S(V,q,t.mask_content,!0),t.isTemporary=!1):h.isPC?alert(g.translate("view-form.mask-length-err")):p.showShortBottom(g.translate("view-form.mask-length-err"))},t.goCancel=function(){t.isTemporary=!1},t.replyData=function(a){t.dataList.length>0&&A();var e={taskId:angular.fromJson(o.waitWorkPassDate).taskId,procInstId:angular.fromJson(o.waitWorkPassDate).procInstId,pkid:a};m.stateGoUtils(!0,"tab.form-handle-reply",{waitWorkPassDate:angular.toJson(e),workWaitData:angular.toJson(t.workWaitData),reply:"reply",title:t.title,type:G,titleFlag:t.titleFlag,information:o.information,notification:o.notification,NotificationItem:o.NotificationItem,notificationDetail:o.notificationDetail},"left")},t.onFormScroll=function(t){var a=angular.element('ion-view.need-form[nav-view="active"]').find(".scaleWrapper");if(!a.parent()[0])return b(),!1;var e=t?a.parent()[0].style.transform:"transform:scale(1)",o=parseFloat(e.substring(e.indexOf("scale(")+6)),n=document.getElementsByClassName("zw_formdata").length?document.getElementsByClassName("zw_formdata"):[{clientWidth:1}],i=n[0].clientWidth,r=(window.innerWidth-20)/i,s="init"==t?r:r*o*o,l=r>=1?"top":"top left";a.css({transform:"scale("+s+")","transform-origin":l,overfolw:"scroll"});var c=angular.element('ion-view.need-form[nav-view="active"]').find(".scroll");c.css({height:"100%"});var d=document.getElementById("pdfiframe");d.innerHTML="iframe[name=iframeId]{ height: "+document.getElementById("heightScroll").offsetHeight/s+"px!important;}"},t.goEnlargement=function(){t.dataList.length>0&&A();var a={taskId:angular.fromJson(o.waitWorkPassDate).taskId,procInstId:angular.fromJson(o.waitWorkPassDate).procInstId};t.tableFlag={display:"none"},m.stateGoUtils(!0,"tab.form-enlargement",{waitWorkPassDate:angular.toJson(a),information:o.information,titleFlag:t.titleFlag,notification:o.notification,type:o.type,NotificationItem:o.NotificationItem,notificationDetail:o.notificationDetail,subTableLength:t.subTableLength,subTablePage:t.subTablePage},"left")},t.goPostscript=function(){t.isA&&R.scrollTop(),"1"!=t.flagPostscript||t.postscriptFlag?t.isP=!1:(R.scrollBy(0,2*Z/3,!0),t.isP=!0),t.postscriptFlag=!t.postscriptFlag},t.goOpinionProcessing=function(){var a=t.others;if(a.approvals){var e=[],o=[],n=[];e=angular.fromJson(a.approvals),angular.forEach(e,function(t,a,i){e[a].replys=angular.fromJson(i[a].replys),e[a].approvalAttachments=angular.fromJson(i[a].approvalAttachments),o=e[a].replys,n=e[a].approvalAttachments,angular.forEach(o,function(t,a,e){o[a].replayAttachments=angular.fromJson(e[a].replayAttachments)})}),t.approvals=e,t.replys=o}t.postscriptFlag=!1,t.isP&&R.scrollTop(),"1"!=t.flagApproval||t.opinionFlag?t.isA=!1:(setTimeout(function(){R.scrollTo(0,2*Z/3,!0)},100),t.isA=!0),t.opinionFlag=!t.opinionFlag},t.getAudio=function(a){t.url=c.baseApiUrl+"app/attachment/showVideo?pkid="+a;var e=new Media(t.url);e.play()},t.commitError=function(t){var a=c.baseApiUrl+"app/common/uploadError",e={errorMsg:t,account:s.get(l.userId,null)};D.getRequestData(a,e,!0,"POST").then(function(t){console.log(t)},function(t){h.isPC||p.showShortBottom(g.translate("publicMsg.requestErr"))})},t.$watch("detailCache",function(a,e){!angular.equals(a[t.cacheIndex-1],e[t.cacheIndex-1])&&a[t.cacheIndex-1]&&""!==a[t.cacheIndex-1]&&(t.preDetailCached=!0),!angular.equals(a[t.cacheIndex+1],e[t.cacheIndex+1])&&a[t.cacheIndex+1]&&""!==a[t.cacheIndex+1]&&(t.nextDetailCached=!0)},!0),t.$watch("detailInfoCache",function(a,e){!angular.equals(a[t.cacheIndex-1],e[t.cacheIndex-1])&&a[t.cacheIndex-1]&&""!==a[t.cacheIndex-1]&&(t.preDetailInfoCached=!0),!angular.equals(a[t.cacheIndex+1],e[t.cacheIndex+1])&&a[t.cacheIndex+1]&&""!==a[t.cacheIndex+1]&&(t.nextDetailInfoCached=!0)},!0),t.nextPage=function(){return O(),t.preDetailCached=!0,t.preDetailInfoCached=!0,t.nextDetailCached=!1,t.nextDetailInfoCached=!1,delete t.detailCache[t.cacheIndex-t.pre],delete t.detailInfoCache[t.cacheIndex-t.pre],t.cacheIndex++,t.detailCache[t.cacheIndex].state==-1?void x(t.detailCache[t.cacheIndex],!0):(t.detailCache[t.cacheIndex+1]&&""!==t.detailCache[t.cacheIndex+1]&&t.detailInfoCache[t.cacheIndex+1]&&""!==t.detailInfoCache[t.cacheIndex+1]&&(t.nextDetailCached=!0,t.nextDetailInfoCached=!0),e(function(){L(t.detailCache[t.cacheIndex]),F(t.detailInfoCache[t.cacheIndex])},100),void N(t.cacheIndex))},t.prePage=function(){O(),t.preDetailCached=!1,t.preDetailInfoCached=!1,t.nextDetailCached=!0,t.nextDetailInfoCached=!0,delete t.detailCache[t.cacheIndex+t.next],delete t.detailInfoCache[t.cacheIndex+t.next],t.cacheIndex--,t.detailCache[t.cacheIndex-1]&&""!==t.detailCache[t.cacheIndex-1]&&t.detailInfoCache[t.cacheIndex-1]&&""!==t.detailInfoCache[t.cacheIndex-1]&&(t.preDetailCached=!0,t.preDetailInfoCached=!0),e(function(){L(t.detailCache[t.cacheIndex]),F(t.detailInfoCache[t.cacheIndex])},100),N(t.cacheIndex)}}])}();
!function(){"use strict";var e=angular.module("community.controllers.waitWork",[]);e.controller("SearchCtrl",["$scope","$state","$stateParams","$rootScope","$ionicNativeTransitions","$filter","$isMobile","stateGoHelp","storageService",function(e,t,a,i,r,o,l,s,n){i.hideTabs=!0,i.bell=!1,i.toBack=!0;var c=a.workFlag,d=a.titleName,k=a.titleFlag,m=a.typeId;e.title=a.titleName,e.stpicker=null,e.endpicker=null,e.viewOtherWaitWork=JSON.parse(a.viewOtherWaitWork||"false")||!1,e.todoUserCode=a.todoUserCode||"",e.$on("$ionicView.beforeEnter",function(t,r){if(i.hideTabs=!0,i.toBack=!0,r.enableBack=!0,e.startTime={},e.endTime={},e.startTime.time="开始时间",e.endTime.time="结束时间",i.$ionicGoBack=function(){s.stateGoUtils(!1)},!l.isPC&&l.Android&&"back"===r.direction){var o="back"!==r.direction?"left":"right";window.plugins.nativepagetransitions.slide({direction:o})}i.titleData="isWork"==c?d:"待办事项",e.titleFlagText="1"==a.titleFlag?"处理":"发起"}),e.$on("$ionicView.enter",function(e,t){document.getElementById("titleID").value="",document.getElementById("nameID").value=""}),e.selectStartTime=function(){},e.selectEndTime=function(){},e.searchWaitWork=function(){if("2"!=k)var t=document.getElementById("titleID").value,i=document.getElementById("nameID").value,r=o("date")(e.startTime.time,"yyyy-MM-dd"),l=o("date")(e.endTime.time,"yyyy-MM-dd"),W={searchTitle:t,searchName:i,searchStartTime:r,searchEndTime:l};else if("2"==k)var t=document.getElementById("titleID").value,W={searchTitle:t};var h=angular.toJson(W);n.set("searchDataStr",h),"isWork"==c?"0"==k?s.stateGoUtils(!0,"tab.waitNews",{searchDataStr:h,workFlag:"isWork",titleName:d,searchWorkFlag:"searchWork",titleFlag:k},"left"):"1"==k?s.stateGoUtils(!0,"tab.doneWork",{searchDataStr:h,workFlag:"isWork",titleName:d,searchWorkFlag:"searchWork",titleFlag:k,typeId:m},"left"):"2"==k?s.stateGoUtils(!0,"tab.doneWork",{searchDataStr:h,workFlag:"isWork",titleName:d,searchWorkFlag:"searchWork",searchTitle:"followWork",titleFlag:k},"left"):"4"==k?s.stateGoUtils(!0,"tab.doneWork",{searchDataStr:h,workFlag:"isWork",titleName:d,searchWorkFlag:"searchWork",searchTitle:"workDoc",titleFlag:k},"left"):"5"==k?s.stateGoUtils(!0,"tab.doneWork",{searchDataStr:h,workFlag:"isWork",titleName:d,searchWorkFlag:"searchWork",titleFlag:k},"left"):s.stateGoUtils(!0,"tab.myWorkWaitWork",{searchDataStr:h,workFlag:"isWork",titleName:d,searchWorkFlag:"searchWork",condition:a.condition,typeId:m,viewOtherWaitWork:e.viewOtherWaitWork,todoUserCode:e.todoUserCode},"left"):s.stateGoUtils(!0,"tab.waitWork",{searchDataStr:h,titleFlag:k},"left")},e.pickStartTime=function(){var t=new Date(0),a=new Date((new Date).getFullYear()+10,11,31);e.stpicker=new mui.DtPicker({type:"date",beginDate:t,endDate:a,labels:["年","月","日"]}),"开始时间"!==e.startTime.time&&e.stpicker.setSelectedValue(e.startTime.time),e.stpicker.show(function(t){e.startTime.time=t.text,e.$apply()})},e.pickEndTime=function(){var t=new Date(0),a=new Date((new Date).getFullYear()+10,11,31);e.endpicker=new mui.DtPicker({type:"date",beginDate:t,endDate:a,labels:["年","月","日"]}),"结束时间"!==e.endTime.time&&e.endpicker.setSelectedValue(e.endTime.time),e.endpicker.show(function(t){e.endTime.time=t.text,e.$apply()})}}])}();
!function(){"use strict";var t=angular.module("community.controllers.waitWork");t.controller("SizerCtrl",["$scope","$state","storageService","$ionicNativeTransitions","$ionicPopup","T","wait_work","$stateParams","$rootScope","$isMobile","$ionicHistory","stateGoHelp",function(t,e,a,i,n,r,o,s,c,l,u,d){function p(t,e){e.forEach(function(e){var a=document.getElementById(e);a.style.backgroundColor=e===t?"#c5f5e9":"#e5e5e5",a.style.color=e===t?"#01a65a":"#999"})}function v(e){t.currentId=e}var B=s.titleName;t.currentId=null;var y=s.workFlag;y||(t.mapList=JSON.parse(s.mapList)),t.isShowType=!0,t.$on("$ionicView.beforeEnter",function(e,a){if(c.bell=!1,c.toBack=!0,a.enableBack=!0,!l.isPC&&l.Android&&"back"===a.direction){var i="back"!==a.direction?"left":"right";window.plugins.nativepagetransitions.slide({direction:i})}c.titleData=B||"待办事项",t.isShowType=!B,c.$ionicGoBack=function(){d.stateGoUtils(!1)}});var k=["allBtn","pauseBtn","backBtn","readBtn","unreadBtn"];t.activeStatusBtn=a.get(o.sizerWorkStateKey,"allBtn"),t.activeTypeBtn=a.get(o.sizerWorkTypeKey,null),p(t.activeStatusBtn,k),v(t.activeTypeBtn,null),t.statusRadio=function(e){var a=e.target.id;a&&(t.activeStatusBtn=a,p(t.activeStatusBtn,k))},t.typeRadio=function(e){t.activeTypeBtn=e,v(t.activeTypeBtn,null)},t.sizerSure=function(){return t.activeStatusBtn?(a.set(o.sizerWorkStateKey,t.activeStatusBtn),a.set(o.sizerWorkTypeKey,t.currentId),void("undefined"==typeof B?(u.clearCache(),u.clearHistory(),d.stateGoUtils(!0,"tab.waitWorkStart",{},"left")):(a.set("sizerBackRequest","backRequest"),d.stateGoUtils(!1)))):void n.alert({title:r.translate("wait-work.sizer-title"),template:t.activeStatusBtn?r.translate("wait-work.type-null"):r.translate("wait-work.state-null")})}}])}();
!function(){"use strict";var t=angular.module("community.controllers.waitWork");t.controller("WaitWorkCtrl",["$scope","$state","$stateParams","$ionicHistory","$ionicNativeTransitions","$rootScope","$ionicLoading","$timeout","$ionicActionSheet","WaitWorkListService","serverConfiguration","scopeData","storageService","auth_events","timeout","$ionicScrollDelegate","wait_work","$isMobile","$cordovaToast","T","application","stateGoHelp","GetRequestService",function(t,e,a,i,o,r,s,n,l,c,u,m,g,d,k,p,w,W,h,f,D,v,b){function L(t){var e=S(t);if(isNaN(e))return t;var a,i,o,r,s,n,l,c,u,m,g,d,k,p,w=99999999999.99,W="零",h="壹",f="贰",D="叁",v="肆",b="伍",L="陆",y="柒",I="捌",N="玖",B="拾",F="佰",P="仟",T="万",U="亿",C="",O="元",$="角",q="分",A="整",z=!1;if(t=t.toString(),""==t)return"";if(null!=t.match(/[^,.\d]/))return"";if(null==t.match(/^((\d{1,3}(,\d{3})*(.((\d{3},)*\d{1,3}))?)|(\d+(.\d+)?))$/))return"";if(t=t.replace(/,/g,""),t=t.replace(/^0+/,""),Number(t)>w)return"";if(r=t.split("."),r.length>1?(a=r[0],i=r[1],i=i.substr(0,2)):(a=r[0],i=""),s=new Array(W,h,f,D,v,b,L,y,I,N),n=new Array("",B,F,P),l=new Array("",T,U),c=new Array($,q),o="",Number(a)>0){for(u=0,z=!1,m=0;m<a.length;m++)g=a.length-m-1,d=a.substr(m,1),k=g/4,p=g%4,"0"==d?u++:(u>0&&(o+=s[0]),u=0,o+=s[Number(d)]+n[p]),0==p&&u<4&&(o+=l[k]),m==a.length-1&&"0"==d&&(z=!0);o+=O,z&&Number(i)>10?o+=W:""!=i&&z&&Number(i.substr(0,1))>0&&(o+=W)}if(""!=i)for(m=0;m<i.length;m++)if(d=i.substr(m,1),"0"!=d){if(0!=m){i.substr(0,1);Number(a)>0&&Number(0==i.substr(0,1))&&(o+=s[0])}o+=s[Number(d)]+c[m]}return""==o&&(o=W+O),(""==i||"0"==i||"00"==i||1==i.toString().length||i.toString().length>1&&"0"==Number(i).toString().substr(1,1))&&(o+=A),o=C+o}function S(t){if(null===t||void 0===t||""===t)return"";"string"==typeof t&&(t=t.replace(/,/g,""));var e=t.toString().match(/([$|￥])\d+\.?\d*/);return e&&(t=t.replace(e[1],"")),Number(t)}function y(t){return(t+"").replace(/\d{1,3}(?=(\d{3})+(\.\d*)?$)/g,"$&,")}function I(e,i,o,s,l,m,d,k,D,v,b,S){var I=u.baseApiUrl+(""!==a.custom&&void 0!==a.custom?"app/myNewTodo/v1/getCustomQueryList":"app/myNewTodo/v2/getList"),B={},l=l?l:P[g.get(w.sizerWorkStateKey,"allBtn")],m=m?m:g.get(w.sizerWorkTypeKey,null);m="null"===m?null:m;var F={account:e,currentPage:i,pageSize:o,subject:s,taskStatus:l,typeId:m,createTimeFrom:d,createTimeTo:k,creator:D,orderField:v,orderSeq:b,resubmitFlg:0};if(""!==a.custom&&void 0!==a.custom)B=JSON.parse(a.custom),B.condition=encodeURIComponent(B.condition),B.account=e,B.currentPage=i,B.pageSize=o;else if("undefined"==typeof M||0==M.length)B=F;else{var T=angular.fromJson(M);T.account=e,T.currentPage=i,T.pageSize=o,T.orderSeq=b,null!=d&&(T.createTimeFrom=d),null!=k&&(T.createTimeTo=k),null!=D&&(T.creator=D),null!=s&&(T.subject=s),B=T}B.orderField=v,B.orderSeq=b,r.viewOtherWaitWork&&(I=u.baseApiUrl+"app/ctl/othertodo/v1/getOtherTodoList",B.todoUserCode=a.todoUserCode),t.requestParam=B,c.getWaitWorkListData(I,B,S).then(function(e){if(t.totalCount=e.totalCount,e.list&&e.list.length>0&&(t.handlingList=[],t.handledList=[],N()),t.waitWorkListData=e.list,t.isHasNextPage=e.flagNextPage,null==e.list)t.noti.text="没有数据可以更新",t.isEmptyData=!0,r.tabWaitWork=!1,r.tabWork=r.documentNum>0;else{r.tabWaitWork=!0,r.tabWork=!0,t.isEmptyData=!1,t.noti.text="成功更新"+e.list.length+"条信息";for(var a=0;a<t.waitWorkListData.length;a++)"未读"==t.waitWorkListData[a].taskStatus?t.waitWorkListData[a].imgUrl="app/wait-work/img/wait-work-unread.png":"已读"==t.waitWorkListData[a].taskStatus?t.waitWorkListData[a].imgUrl="app/wait-work/img/wait-work-read.png":"退回"==t.waitWorkListData[a].taskStatus?t.waitWorkListData[a].imgUrl="app/work/img/my-work-matter-send_back.png":"暂存待办"==t.waitWorkListData[a].taskStatus&&(t.waitWorkListData[a].imgUrl="app/wait-work/img/wait-work-pause-save.png"),t.procInstIdArray.push(t.waitWorkListData[a].procInstId),t.waitWorkListData[a].subject&&t.waitWorkListData[a].subject.split("¤※").length>1&&(t.waitWorkListData[a].totalNum=t.waitWorkListData[a].subject.split("¤※")[1],t.waitWorkListData[a].totalLetter=L(t.waitWorkListData[a].totalNum),t.waitWorkListData[a].totalNum=y(t.waitWorkListData[a].totalNum));var i=t.procInstIdArray.join(","),o=u.baseApiUrl+"app/common/v1/getListApprove",s={procInstIds:i},l=!1;c.getWaitWorkListData(o,s,l).then(function(e){console.log(e),0===e.state&&(t.approveFlags=e.list)})["catch"](function(t){})}g.get("needRemberPosition",null)&&n(function(){p.$getByHandle("myScroll").scrollTo(0,g.get("verticalScrollOffset",0)),g.removeItem("needRemberPosition"),g.removeItem("selectedFormIndex"),g.removeItem("verticalScrollOffset")},1e3)},function(t){W.isPC||h.showShortBottom(f.translate("publicMsg.requestErr"))})}function N(){console.log(t.handlingList);var e=u.baseApiUrl+"app/syncdata/v1/getList",a={account:g.get(d.userId,null)},i=!1;c.getWaitWorkListData(e,a,i).then(function(e){t.handlingList=t.handlingList.concat(e.list),console.log(t.handlingList)})["catch"](function(t){W.isPC||h.showShortBottom(f.translate("publicMsg.requestErr"))})}function B(){var e=u.baseApiUrl+"app/syncdata/v1/getPorceedList",a={account:g.get(d.userId,null),procInstIds:t.handlingList.join(",")},i=!1;c.getWaitWorkListData(e,a,i).then(function(e){if(e.list.length>0){for(var a in e.list)t.handlingList.splice(t.handlingList.indexOf(e.list[a]),1);console.log(t.handlingList)}t.handledList=t.handledList.concat(e.list)})["catch"](function(t){W.isPC||h.showShortBottom(f.translate("publicMsg.requestErr"))})}t.waitWorkListData=[],t.mapList=[],t.createDate="createDate",t.createTime="create_time_",t.titleMaxLength=8,t.procInstIdArray=[],t.handlingList=[],t.handledList=[],t.approveFlags=[];var F=function(){var e=u.baseApiUrl+"app/common/v1/getTypeId",a={account:g.get(d.userId,null)};c.getWaitWorkListData(e,a,!0,"POST").then(function(e){t.mapList=e.list},function(t){W.isPC||h.showShortBottom(f.translate("mine.remarks-fail"))})};F();var P={allBtn:null,pauseBtn:3,backBtn:2,readBtn:1,unreadBtn:0},T=g.get(d.userId,null),U=P[g.get(w.sizerWorkStateKey,"allBtn")],C=g.get(w.sizerWorkTypeKey,null),O=null,$=null,q=null,A=null;g.removeItem("backReply"),t.sizerImgShow=!0,t.searchImgShow=!0,t.isEmptyData=!0;var z=a.titleFlag;if(console.log("=============== %O",a),void 0!=a.workWaitData&&""!=a.workWaitData){t.workWaitData=angular.fromJson(a.workWaitData);var x=t.workWaitData.workFlag,R=t.workWaitData.title,M=t.workWaitData.condition;"isWork"==x&&(C=t.workWaitData.typeId)}else if("isWork"==a.workFlag){var x=a.workFlag,R=a.titleName,M=a.condition;C=a.typeId,console.log(C),t.workWaitData={title:R,typeId:C,workFlag:x,condition:M},0!=M.length&&(t.sizerImgShow=!1,t.searchImgShow=!1)}else t.workWaitData=void 0;t.noti={};var j=1,E=10;t.$on("$ionicView.enter",function(t,e){"isWork"==x&&(r.hideTabs=!0,r.bell=!1,r.toBack=!0)}),t.$on("$ionicView.beforeEnter",function(e,o){console.log(a.viewOtherWaitWork),r.viewOtherWaitWork=JSON.parse(a.viewOtherWaitWork||"false")||!1;var s=g.get("FORM_HANDLE_ID",null);if(s&&t.waitWorkListData.length>0){for(var n in t.waitWorkListData)t.waitWorkListData[n].procInstId===s&&(console.log(t.waitWorkListData[n]),t.waitWorkListData.splice(n,1));g.removeItem("FORM_HANDLE_ID")}var l=g.get("searchDataStr","");U=P[g.get(w.sizerWorkStateKey,"allBtn")],C=g.get(w.sizerWorkTypeKey,null),void 0!=l&&""!=l&&(l=angular.fromJson(l),O=l.searchTitle,$=l.searchStartTime,q=l.searchEndTime,"开始时间"==$&&($=null),"结束时间"==q&&(q=null),A=l.searchName);var c=i.backView()||{},u=i.forwardView()||{};if(g.removeItem("backReply"),null!==c&&("tab.view-form"==c.stateName||"tab.viewFormWork"==c.stateName)&&(o.direction="back",!W.isPC&&W.Android&&"back"===o.direction)){var d="right";window.plugins.nativepagetransitions.slide({direction:d})}if(null!=u&&("tab.view-form"==u.stateName||"tab.viewFormWork"==u.stateName)&&(o.direction="back",!W.isPC&&W.Android&&"back"===o.direction)){var d="right";window.plugins.nativepagetransitions.slide({direction:d})}if("isWork"!=x?(i.clearCache(),i.clearHistory(),r.bell=!0,r.toBack=!1,r.titleData="待办"):(C=t.workWaitData.typeId,i.clearCache(),r.titleData=R.length>t.titleMaxLength?R.slice(0,t.titleMaxLength)+"...":R,r.bell=!1,r.toBack=!0,o.enableBack=!0,W.Android&&angular.element(document.querySelectorAll(".tabs-icon-top")).addClass("tabs-item-hide")),"back"!==o.direction){var k=g.get("needRemberPosition",null);if(j=1,E=10*j,k){var h=g.get("selectedFormIndex",1);g.get("verticalScrollOffset",0);j=Math.ceil(h/10),E=10*j}"isWork"!=x?(r.bell=!0,r.toBack=!1,r.titleData="待办",I(T,1,E,O,U,C,$,q,A,t.map[t.isBtn.name],t.isDesc?"desc":"asc",!0)):(console.log(t.map[t.isBtn.name]),r.titleData=R.length>t.titleMaxLength?R.slice(0,t.titleMaxLength)+"...":R,r.bell=!1,r.toBack=!0,U=P[g.get(w.sizerWorkStateKey,"allBtn")],console.log(t.waitWorkListData),I(T,1,E,O,U,C,$,q,A,t.map[t.isBtn.name],t.isDesc?"desc":"asc",!0)),g.removeItem("sizerBackRequest")}else{N(),t.handlingList.length>0&&B();var f=g.get("sizerBackRequest",null);"backRequest"!=f&&"retrieve"!=a.retrieve&&"backRequestSave"!=f||("isWork"==x||"retrieve"==a.retrieve?(U=P[g.get(w.sizerWorkStateKey,"allBtn")],p.scrollTop(),I(T,1,10,O,U,C,$,q,A,t.map[t.isBtn.name],t.isDesc?"desc":"asc",!0),g.set("sizerBackRequest",null)):"backRequestSave"==f&&(p.scrollTop(),I(T,1,10,O,U,C,$,q,A,t.map[t.isBtn.name],t.isDesc?"desc":"asc",!0)))}m.prototype.setStateCurrentViewDataName(i.currentView().stateName),m.prototype.setStateCurrentViewParams(i.currentView().stateParams),r.$ionicGoBack=function(){var t=(i.currentView(),r.viewOtherWaitWork?"tab.mine":"tab.work");v.stateGoUtils(!0,t,{titleFlag:z},"right")}}),t.buttons=[{name:"发起时间"},{name:"接收时间"},{name:"标题"}],t.isBtn={name:g.get("buttonName","发起时间")},t.chooseBtn=function(e){t.isBtn=e,j=1,g.set("buttonName",t.isBtn.name),"标题"===t.isBtn.name?I(T,1,E,O,U,C,$,q,A,t.map[t.isBtn.name],t.isDesc?"desc":"asc",!0):"发起时间"===t.isBtn.name?I(T,1,E,O,U,C,$,q,A,t.map[t.isBtn.name],t.isDesc?"desc":"asc",!0):"接收时间"===t.isBtn.name&&I(T,1,E,O,U,C,$,q,A,t.map[t.isBtn.name],t.isDesc?"desc":"asc",!0)},t.isDesc="true"===g.get("btnName","true"),t.map={"标题":"subject_","发起时间":t.createDate,"接收时间":t.createTime},t.chooseBtns=function(){t.isDesc=!t.isDesc,g.set("btnName",t.isDesc),j=1,t.isDesc?(console.log(t.isBtn.name),I(T,1,E,O,U,C,$,q,A,t.map[t.isBtn.name],t.isDesc?"desc":"asc",!0)):I(T,1,E,O,U,C,$,q,A,t.map[t.isBtn.name],t.isDesc?"desc":"asc",!0)},t.doRefresh=function(){j=1,n(function(){I(T,1,10,O,U,C,$,q,A,t.map[t.isBtn.name],t.isDesc?"desc":"asc",!1),t.$broadcast("scroll.refreshComplete")},k.pullDown)},t.loadMore=function(){var e=++j,i=u.baseApiUrl+(""!==a.custom&&void 0!==a.custom?"app/myNewTodo/v1/getCustomQueryList":"app/myNewTodo/v2/getList"),o={},s={account:T,currentPage:e,pageSize:10,subject:O,taskStatus:U,typeId:C,createTimeFrom:$,createTimeTo:q,creator:A,orderField:t.map[t.isBtn.name],orderSeq:t.isDesc?"desc":"asc",resubmitFlg:0};if(console.log(e),""!==a.custom&&void 0!==a.custom)o=JSON.parse(a.custom),o.condition=encodeURIComponent(o.condition),o.account=T,o.currentPage=e,o.pageSize=10;else if("undefined"==typeof M||0==M.length)o=s;else{var n=angular.fromJson(M);n.account=T,n.currentPage=e,n.pageSize=10,o=n}o.orderField=s.orderField,o.orderSeq=s.orderSeq,r.viewOtherWaitWork&&(i=u.baseApiUrl+"app/ctl/othertodo/v1/getOtherTodoList",o.todoUserCode=a.todoUserCode),c.getWaitWorkListData(i,o,!1).then(function(e){t.waitWorkListData=t.waitWorkListData.concat(e.list?e.list:[]),console.log(t.waitWorkListData),t.isHasNextPage=e.flagNextPage;for(var a=0;a<t.waitWorkListData.length;a++)"未读"==t.waitWorkListData[a].taskStatus?t.waitWorkListData[a].imgUrl="app/wait-work/img/wait-work-unread.png":"已读"==t.waitWorkListData[a].taskStatus?t.waitWorkListData[a].imgUrl="app/wait-work/img/wait-work-read.png":"退回"==t.waitWorkListData[a].taskStatus?t.waitWorkListData[a].imgUrl="app/work/img/my-work-matter-send_back.png":"暂存待办"==t.waitWorkListData[a].taskStatus&&(t.waitWorkListData[a].imgUrl="app/wait-work/img/wait-work-pause-save.png"),t.waitWorkListData[a].subject&&t.waitWorkListData[a].subject.split("¤※").length>1&&(t.waitWorkListData[a].totalNum=t.waitWorkListData[a].subject.split("¤※")[1],t.waitWorkListData[a].totalLetter=L(t.waitWorkListData[a].totalNum),t.waitWorkListData[a].totalNum=y(t.waitWorkListData[a].totalNum));t.$broadcast("scroll.infiniteScrollComplete")},function(t){W.isPC||h.showShortBottom(f.translate("publicMsg.requestErr"))})},r.clickLiftMessage=function(){v.stateGoUtils(!0,"tab.notification",{titleFlag:z,backFlag:"back"},"left")},t.goSizer=function(){"isWork"==x?v.stateGoUtils(!0,"tab.myWorkSizer",{titleName:R,titleFlag:z,workFlag:"isWork"},"left"):v.stateGoUtils(!0,"tab.sizer",{mapList:JSON.stringify(t.mapList)},"left")},t.goSearch=function(){"isWork"==x?v.stateGoUtils(!0,"tab.searchWork",{workFlag:"isWork",titleName:R,titleFlag:z,condition:M,typeId:C,viewOtherWaitWork:r.viewOtherWaitWork,todoUserCode:a.todoUserCode},"left"):v.stateGoUtils(!0,"tab.search",{},"left")},t.goDetails=function(e,a){if(t.handlingList.indexOf(e.procInstId)>-1||t.handledList.indexOf(e.procInstId)>-1)return W.isPC?alert("已移交处理表单不可查看"):h.showShortBottom("已移交处理表单不可查看"),!1;var i={taskId:e.taskId,procInstId:e.procInstId};t.requestParam.index=a,t.requestParam.totalCount=t.totalCount,g.set("selectedFormIndex",a+1),g.set("verticalScrollOffset",p.$getByHandle("myScroll").getScrollPosition().top),v.stateGoUtils(!0,"tab.view-form",{waitWorkPassDate:angular.toJson(i),workWaitData:angular.toJson(t.workWaitData),workFlag:"isWork",titleFlag:z,requestParam:angular.toJson(t.requestParam)},"left"),r.viewOtherWaitWork||"未读"!=e.taskStatus||(e.imgUrl="app/wait-work/img/wait-work-read.png")}}])}();
!function(){"use strict";var t=angular.module("community.controllers.work",[]);t.controller("newMatterCtrl",["$scope","$state","$rootScope","$stateParams","$ionicNativeTransitions","stateGoHelp",function(t,o,n,e,a,i){t.mineItemFlag=!0,t.commonalityFlag=!1,t.goMineItem=function(){t.mineItemFlag=!t.mineItemFlag},t.goCommonality=function(){t.commonalityFlag=!t.commonalityFlag},t.goSynergy=function(){i.stateGoUtils(!0,"tab.synergy",{},"left")}}])}();
!function(){"use strict";var t=angular.module("community.controllers.work");t.controller("newSynergyCtrl",["$scope","$state","$rootScope","$stateParams","$ionicNativeTransitions","$ionicActionSheet",function(t,n,e,o,c,l){t.tableFlag="";t.toSwitch=function(n){"y"==n?t.tableFlag="a":"q"==n&&(t.tableFlag="b")},t.uploadAttachment=function(){var t=null,n=l.show({buttons:[{text:"从相册选择"},{text:"拍照"}],titleText:"上传附件",cancelText:"取消",cancel:function(){},buttonClicked:function(e){return 0==e?t=0:1==e&&(t=1),null!==t&&n(),!0}})}}])}();
!function(){"use strict";var t=angular.module("community.controllers.work");t.controller("WaitNewsCtrl",["$scope","$state","$rootScope","$stateParams","$ionicNativeTransitions","serverConfiguration","$timeout","scopeData","storageService","auth_events","$ionicScrollDelegate","timeout","work","wait_work","WaitHomeService","$ionicHistory","$isMobile","$cordovaToast","T","stateGoHelp","$ionicListDelegate","$ionicPopup",function(t,a,e,o,r,i,s,l,n,c,u,g,d,k,p,f,m,D,w,L,b,W){function h(a,e,o,r,s,l,n,c,u,g,d){var k=i.baseApiUrl+"app/sent/v2/getList";1==e&&(R=1);var f={account:a,currentPage:e,pageSize:o,subject:r,taskName:s,typeId:l,createTimeFrom:n,createTimeTo:c,orderField:u,orderSeq:g,isLoading:d};p.getWaitWorkListData(k,f,d).then(function(a){t.WorkNewsListData=a.list;for(var e=0;e<t.WorkNewsListData.length;e++)t.WorkNewsListData[e].subject&&t.WorkNewsListData[e].subject.split("¤※").length>1&&(t.WorkNewsListData[e].totalNum=t.WorkNewsListData[e].subject.split("¤※")[1],t.WorkNewsListData[e].totalLetter=N(t.WorkNewsListData[e].totalNum),t.WorkNewsListData[e].totalNum=S(t.WorkNewsListData[e].totalNum));t.isHasNextPage=a.flagNextPage,_(a)},function(t){m.isPC||D.showShortBottom(w.translate("publicMsg.requestErr"))})}function N(t){var a=v(t);if(isNaN(a))return t;var e,o,r,i,s,l,n,c,u,g,d,k,p,f,m=99999999999.99,D="零",w="壹",L="贰",b="叁",W="肆",h="伍",N="陆",S="柒",F="捌",P="玖",T="拾",j="佰",U="仟",$="万",y="亿",C="",I="元",x="角",B="分",E="整",A=!1;if(t=t.toString(),""==t)return"";if(null!=t.match(/[^,.\d]/))return"";if(null==t.match(/^((\d{1,3}(,\d{3})*(.((\d{3},)*\d{1,3}))?)|(\d+(.\d+)?))$/))return"";if(t=t.replace(/,/g,""),t=t.replace(/^0+/,""),Number(t)>m)return"";if(i=t.split("."),i.length>1?(e=i[0],o=i[1],o=o.substr(0,2)):(e=i[0],o=""),s=new Array(D,w,L,b,W,h,N,S,F,P),l=new Array("",T,j,U),n=new Array("",$,y),c=new Array(x,B),r="",Number(e)>0){for(u=0,A=!1,g=0;g<e.length;g++)d=e.length-g-1,k=e.substr(g,1),p=d/4,f=d%4,"0"==k?u++:(u>0&&(r+=s[0]),u=0,r+=s[Number(k)]+l[f]),0==f&&u<4&&(r+=n[p]),g==e.length-1&&"0"==k&&(A=!0);r+=I,A&&Number(o)>10?r+=D:""!=o&&A&&Number(o.substr(0,1))>0&&(r+=D)}if(""!=o)for(g=0;g<o.length;g++)if(k=o.substr(g,1),"0"!=k){if(0!=g){o.substr(0,1);Number(e)>0&&Number(0==o.substr(0,1))&&(r+=s[0])}r+=s[Number(k)]+c[g]}return""==r&&(r=D+I),(""==o||"0"==o||"00"==o||1==o.toString().length||o.toString().length>1&&"0"==Number(o).toString().substr(1,1))&&(r+=E),r=C+r}function v(t){if(null===t||void 0===t||""===t)return"";"string"==typeof t&&(t=t.replace(/,/g,""));var a=t.toString().match(/([$|￥])\d+\.?\d*/);return a&&(t=t.replace(a[1],"")),Number(t)}function S(t){return(t+"").replace(/\d{1,3}(?=(\d{3})+(\.\d*)?$)/g,"$&,")}function F(a,e,o,r,s,l,n,c,u,g,d,k){var f=i.baseApiUrl+"app/done/v2/getList";1==e&&(R=1);var L={account:a,currentPage:e,pageSize:o,subject:r,status:s,typeId:l,creator:n,processTimeFrom:c,processTimeTo:u,orderField:g,orderSeq:d,isLoading:k};p.getWaitWorkListData(f,L,k).then(function(a){t.doneWorkListData=a.list;for(var e=0;e<t.doneWorkListData.length;e++)t.doneWorkListData[e].subject&&t.doneWorkListData[e].subject.split("¤※").length>1&&(t.doneWorkListData[e].totalNum=t.doneWorkListData[e].subject.split("¤※")[1],t.doneWorkListData[e].totalLetter=N(t.doneWorkListData[e].totalNum),t.doneWorkListData[e].totalNum=S(t.doneWorkListData[e].totalNum));t.isHasNextPage=a.flagNextPage,_(a)},function(t){m.isPC||D.showShortBottom(w.translate("publicMsg.requestErr"))})}function P(a,e,o,r,s,l,n,c,u){var g=i.baseApiUrl+"app/follow/v2/getList";1==e&&(R=1);var d={account:I,currentPage:e,pageSize:o,subject:r,typeId:s,creator:l,orderField:n,orderSeq:c,isLoading:u};p.getWaitWorkListData(g,d,u).then(function(a){t.followWorkListData=a.list;for(var e=0;e<t.followWorkListData.length;e++)t.followWorkListData[e].subject&&t.followWorkListData[e].subject.split("¤※").length>1&&(t.followWorkListData[e].totalNum=t.followWorkListData[e].subject.split("¤※")[1],t.followWorkListData[e].totalLetter=N(t.followWorkListData[e].totalNum),t.followWorkListData[e].totalNum=S(t.followWorkListData[e].totalNum));t.isHasNextPage=a.flagNextPage,_(a)},function(t){m.isPC||D.showShortBottom(w.translate("publicMsg.requestErr"))})}function T(a,e,o,r,s,l,n,c){var u=i.baseApiUrl+"app/document/v1/list";1==e&&(R=1);var g={account:a,pageNum:e,pageSize:o,subject:r,creator:s,startTime:l,endTime:n,isLoading:c};p.getWaitWorkListData(u,g,c).then(function(a){t.workDocListData=a.list,t.isHasNextPage=a.flagNextPage,_(a)},function(t){m.isPC||D.showShortBottom(w.translate("publicMsg.requestErr"))})}function j(t){var a=i.baseApiUrl+"app/document/v1/updateFlagRead",e={pkid:t};p.getWaitWorkListData(a,e,!1).then(function(t){},function(t){})}function U(a,e,o,r,s,l,n,c){var u=i.baseApiUrl+"app/understanding/v1/list";1==e&&(R=1);var g={account:a,pageNum:e,pageSize:o,subject:r,creator:s,startTime:l,endTime:n,isLoading:c};p.getWaitWorkListData(u,g,c,"GET").then(function(a){t.workUnderstandingListData=a.list,t.isHasNextPage=a.flagNextPage,_(a)},function(t){m.isPC||D.showShortBottom(w.translate("publicMsg.requestErr"))})}var $=o.searchWorkFlag,y=o.searchTitle;e.hideTabs=!0,t.WorkNewsListData=[],t.doneWorkListData=[],t.followWorkListData=[],t.title=o.titleName,t.workFlag=o.workFlag,t.titleFlag=o.titleFlag,e.bell=!1,e.toBack=!0,t.userName=n.get(c.name,null),t.isEmptyData=!0;var C={allBtn:null,pauseBtn:3,backBtn:2,readBtn:1,unreadBtn:0},I=n.get(c.userId,null),x=n.get(k.sizerWorkTypeKey,null),B=C[n.get(k.sizerWorkStateKey,"allBtn")],E=null,A=null,q=null,M=null,z=o.typeId;if(void 0!=o.searchDataStr&&""!=o.searchDataStr){var H=angular.fromJson(o.searchDataStr);E=H.searchTitle,"followWork"!=y&&(A=H.searchStartTime,q=H.searchEndTime,"开始时间"==A&&(A=null),"结束时间"==q&&(q=null),M=H.searchName)}var G=o.titleName;t.noti={};var R=1;t.$on("$ionicView.beforeEnter",function(a,r){e.toBack=!0,e.hideTabs=!0,r.enableBack=!0,e.bell=!1,$=o.searchWorkFlag,y=o.searchTitle;var i=f.backView(),s=f.forwardView();if(null!=i&&("tab.view-form"==i.stateName||"tab.viewFormWork"==i.stateName)&&(r.direction="back",!m.isPC&&m.Android&&"back"===r.direction)){var c="right";window.plugins.nativepagetransitions.slide({direction:c})}if(null!=s&&("tab.view-form"==s.stateName||"tab.viewFormWork"==s.stateName)&&(r.direction="back",!m.isPC&&m.Android&&"back"===r.direction)){var c="right";window.plugins.nativepagetransitions.slide({direction:c})}l.prototype.setStateCurrentViewDataName(f.currentView().stateName),l.prototype.setStateCurrentViewParams(f.currentView().stateParams),n.set("viewFormCacheWork",null),e.$ionicGoBack=function(){"1"==t.titleFlag||"0"==t.titleFlag||"2"==t.titleFlag||"4"==t.titleFlag||"5"==t.titleFlag?L.stateGoUtils(!0,"tab.work",{},"right"):L.stateGoUtils(!0,"tab.waitWork",{},"right")};var g=n.get(k.sizerWorkTypeKey,null),d=C[n.get(k.sizerWorkStateKey,"allBtn")];e.titleData=t.title,"back"!==r.direction&&(e.titleData=t.title,u.scrollTop(),"0"==t.titleFlag?h(I,1,10,E,"",g,A,q,"","",!0):"1"==t.titleFlag?F(I,1,10,E,d,z,M,A,q,"end_time_","",!0):"2"!=t.titleFlag||y?"2"==t.titleFlag&&"followWork"==y?P(I,1,10,E,g,null,"","",!0):"4"==t.titleFlag?T(I,1,10,E,M,A,q,!0):"5"==t.titleFlag&&U(I,1,10,E,M,A,q,!0):P(I,1,10,E,g,M,"","",!0))}),t.$on("$ionicView.enter",function(){e.toBack=!0,e.bell=!1}),"0"==t.titleFlag?(t.doRefresh=function(){R=1,s(function(){h(I,1,10,E,"",x,A,q,"","",!1),t.$broadcast("scroll.refreshComplete")},g.pullDown)},t.loadMore=function(){var a=++R,e=i.baseApiUrl+"app/sent/v2/getList",o={account:I,currentPage:a,pageSize:10,subject:E,taskName:"",typeId:x,createTimeFrom:A,createTimeTo:q,orderField:"",orderSeq:""};p.getWaitWorkListData(e,o,!1).then(function(a){t.isHasNextPage=a.flagNextPage,t.WorkNewsListData=t.WorkNewsListData.concat(a.list);for(var e=0;e<t.WorkNewsListData.length;e++)t.WorkNewsListData[e].subject&&t.WorkNewsListData[e].subject.split("¤※").length>1&&(t.WorkNewsListData[e].totalNum=t.WorkNewsListData[e].subject.split("¤※")[1],t.WorkNewsListData[e].totalLetter=N(t.WorkNewsListData[e].totalNum),t.WorkNewsListData[e].totalNum=S(t.WorkNewsListData[e].totalNum));t.$broadcast("scroll.infiniteScrollComplete")},function(t){m.isPC||D.showShortBottom(w.translate("publicMsg.requestErr"))})}):"1"==t.titleFlag?(t.doRefresh=function(){R=1,s(function(){F(I,1,10,E,B,z,M,A,q,"end_time_","",!1),t.$broadcast("scroll.refreshComplete")},g.pullDown)},t.loadMore=function(){var a=++R,e=i.baseApiUrl+"app/done/v2/getList",o={account:I,currentPage:a,pageSize:10,subject:E,status:B,typeId:z,creator:M,orderField:"end_time_",orderSeq:""};p.getWaitWorkListData(e,o,!1).then(function(a){t.isHasNextPage=a.flagNextPage,t.doneWorkListData=t.doneWorkListData.concat(a.list);for(var e=0;e<t.doneWorkListData.length;e++)t.doneWorkListData[e].subject&&t.doneWorkListData[e].subject.split("¤※").length>1&&(t.doneWorkListData[e].totalNum=t.doneWorkListData[e].subject.split("¤※")[1],t.doneWorkListData[e].totalLetter=N(t.doneWorkListData[e].totalNum),t.doneWorkListData[e].totalNum=S(t.doneWorkListData[e].totalNum));t.$broadcast("scroll.infiniteScrollComplete")},function(t){m.isPC||D.showShortBottom(w.translate("publicMsg.requestErr"))})}):"2"==t.titleFlag?(t.doRefresh=function(){R=1,s(function(){P(I,1,10,E,x,M,"","",!1),t.$broadcast("scroll.refreshComplete")},g.pullDown)},t.loadMore=function(){var a=++R,e=i.baseApiUrl+"app/follow/v2/getList",o={account:I,currentPage:a,pageSize:10,subject:E,typeId:x,creator:M,orderField:"",orderSeq:""};p.getWaitWorkListData(e,o,!1).then(function(a){t.isHasNextPage=a.flagNextPage,t.followWorkListData=t.followWorkListData.concat(a.list);for(var e=0;e<t.followWorkListData.length;e++)t.followWorkListData[e].subject&&t.followWorkListData[e].subject.split("¤※").length>1&&(t.followWorkListData[e].totalNum=t.followWorkListData[e].subject.split("¤※")[1],t.followWorkListData[e].totalLetter=N(t.followWorkListData[e].totalNum),t.followWorkListData[e].totalNum=S(t.followWorkListData[e].totalNum));t.$broadcast("scroll.infiniteScrollComplete")},function(t){m.isPC||D.showShortBottom(w.translate("publicMsg.requestErr"))})}):"4"==t.titleFlag?(t.doRefresh=function(){R=1,s(function(){T(I,1,10,E,M,A,q,!0),t.$broadcast("scroll.refreshComplete")},g.pullDown)},t.loadMore=function(){var a=++R,e=i.baseApiUrl+"app/document/v1/list",o={account:I,pageNum:a,pageSize:10,subject:E,creator:M,startTime:A,endTime:q};p.getWaitWorkListData(e,o,!1).then(function(a){t.workDocListData=t.workDocListData.concat(a.list);for(var e=0;e<t.workDocListData.length;e++)t.workDocListData[e].subject&&t.workDocListData[e].subject.split("¤※").length>1&&(t.workDocListData[e].totalNum=t.workDocListData[e].subject.split("¤※")[1],t.workDocListData[e].totalLetter=N(t.workDocListData[e].totalNum),t.workDocListData[e].totalNum=S(t.workDocListData[e].totalNum));t.isHasNextPage=a.flagNextPage,t.$broadcast("scroll.infiniteScrollComplete")},function(t){m.isPC||D.showShortBottom(w.translate("publicMsg.requestErr"))})}):"5"==t.titleFlag&&(t.doRefresh=function(){R=1,s(function(){U(I,1,10,E,M,A,q,!0),t.$broadcast("scroll.refreshComplete")},g.pullDown)},t.loadMore=function(){var a=++R,e=i.baseApiUrl+"app/understanding/v1/list",o={account:I,pageNum:a,pageSize:10,subject:E,creator:M,startTime:A,endTime:q};p.getWaitWorkListData(e,o,!1,"GET").then(function(a){t.workUnderstandingListData=t.workUnderstandingListData.concat(a.list);for(var e=0;e<t.workUnderstandingListData.length;e++)t.workUnderstandingListData[e].subject&&t.workUnderstandingListData[e].subject.split("¤※").length>1&&(t.workUnderstandingListData[e].totalNum=t.workUnderstandingListData[e].subject.split("¤※")[1],t.workUnderstandingListData[e].totalLetter=N(t.workUnderstandingListData[e].totalNum),t.workUnderstandingListData[e].totalNum=S(t.workUnderstandingListData[e].totalNum));t.isHasNextPage=a.flagNextPage,t.$broadcast("scroll.infiniteScrollComplete")},function(t){m.isPC||D.showShortBottom(w.translate("publicMsg.requestErr"))})},t.deleteUndData=function(a,e){var o=W.confirm({title:"删除提示",template:'<div"><p>确认删除此条信息？</p></div>',cancelText:"取消",cancelType:"button-assertive",okText:"确定",okType:"button-positive",scope:t});o.then(function(o){if(o){var r=i.baseApiUrl+"app/understanding/v1/understandingDel",s={account:I,pkid:e.pkid};p.getWaitWorkListData(r,s,!0,"GET").then(function(e){0==e.state&&(t.workUnderstandingListData.splice(a,1),0==t.workUnderstandingListData&&(t.isEmptyData=!0,t.doRefresh()))},function(t){m.isPC||D.showShortBottom(w.translate("publicMsg.requestErr"))})}b.closeOptionButtons()})}),t.isallPersonShow=!0,t.isImgShow=!0,"3"==t.titleFlag?t.isallPersonShow=!1:"0"==t.titleFlag?(t.isallPersonShow=!1,t.isImgShow=!1):"1"==t.titleFlag?(t.isallPersonShow=!1,t.isImgShow=!1):"2"==t.titleFlag?t.isImgShow=!1:"4"==t.titleFlag?t.isImgShow=!1:"5"==t.titleFlag&&(t.isImgShow=!1),t.goSearch=function(){(t.titleFlag||"3"!=t.titleFlag)&&L.stateGoUtils(!0,"tab.searchWork",{workFlag:"isWork",titleName:G,titleFlag:t.titleFlag,typeId:z},"left")};var V;t.goDetails=function(a){var e={0:"已发事项",1:"已办事项",2:"跟踪事项",4:"公文查询",5:"知会事项"};t.titleFlag&&"3"!=t.titleFlag&&(V={taskId:a.taskId,procInstId:a.id},"4"==t.titleFlag&&(V.procInstId=a.procInstId,a.flagRead="1",j(a.pkid)),"5"==t.titleFlag&&(V.procInstId=a.procInstId,a.flagRead="1"),L.stateGoUtils(!0,"tab.viewFormWork",{type:"work",searchWorkFlag:$,titleName:e[t.titleFlag],waitWorkPassDate:angular.toJson(V),titleFlag:t.titleFlag},"left"))};var _=function(a){a.list&&a.list.length>0?(t.isEmptyData=!1,t.noti.text="成功更新"+a.list.length+"条信息"):(t.noti.text="没有数据可以更新",t.isEmptyData=!0)}}])}();
!function(){"use strict";var t=angular.module("community.controllers.work");t.controller("MyWorkSizerCtrl",["$scope","$state","$rootScope","$stateParams","$ionicNativeTransitions","stateGoHelp",function(t,e,n,o,a,c){function r(t,e){e.forEach(function(e){var n=document.getElementById(e);n.style.backgroundColor=e==t?"#c5f5e9":"#e5e5e5",n.style.color=e==t?"#01a65a":"#999"})}var l=["allBtn","pauseBtn","backBtn","readBtn","unreadBtn"];t.selectedBtn="allBtn",r(t.selectedBtn,l),t.selectBtn=function(e){var n=e.target.id;n&&(t.selectedBtn=n,r(t.selectedBtn,l))},n.$ionicGoBack=function(){c.stateGoUtils(!1)}}])}();
!function(){"use strict";var t=angular.module("community.controllers.work");t.controller("MyWorkWaitWorkCtrl",["$scope","$state","$rootScope","$stateParams","$ionicNativeTransitions","$isMobile","stateGoHelp",function(t,o,i,e,n,r,a){t.$on("$ionicView.beforeEnter",function(t,o){if(!r.isPC&&r.Android&&"back"===o.direction){var i="back"!==o.direction?"left":"right";window.plugins.nativepagetransitions.slide({direction:i})}}),t.rsShow=!1,t.goSizer=function(){a.stateGoUtils(!0,"tab.mineNotification",{},"left")},t.goNeed=function(o){var i={title:t.title,typeId:t.typeId,workFlag:t.workFlag,condition:t.condition};a.stateGoUtils(!0,"tab.viewFormWork",{type:"work",titleName:t.title,imgFlag:o,workWaitData:angular.toJson(i)},"left")},t.goSearch=function(){a.stateGoUtils(!0,"tab.searchWork",{type:"work"},"left")}}])}();
!function(){"use strict";var t=angular.module("community.controllers.work");t.controller("WorkCtrl",["$scope","$state","$rootScope","$ionicNativeTransitions","$ionicHistory","$isMobile","WaitHomeService","serverConfiguration","storageService","auth_events","$cordovaToast","T","GetRequestService","application","wait_work","timeout","stateGoHelp","DBSingleInstance","$timeout","appUtils","jdbc",function(t,a,o,e,r,i,n,l,s,u,p,c,g,m,f,w,k,d,h,S,D){function v(a,o,e,r,i,n){t.col25=a,t.col50=o,t.col100=e,t.colForm25=r,t.colForm50=i,t.colForm100=n}function b(a){if("[]"===a.list)return void(t.isTotalMoney=!1);t.formData=a;var o=angular.fromJson(a.list);for(t.formData.list=o,T=0;T<t.formData.list.length;T++){ionic.Platform.isIPad()?T===t.formData.list.length-1?t.formData.list[T].hrShow=!1:t.formData.list[T].hrShow=!0:T%2===1?t.formData.list[T].hrShow=!1:t.formData.list[T].hrShow=!0;var e=angular.toJson(t.formData.list[T].total.CALSUM).replace(/"/g,""),r=S.outputMoney(e);if(r.length>10){var i=r.indexOf(".");i>0&&(r=r.substring(0,i)),r.length>10?(t.formData.list[T].changeSize=!0,t.widthValue<321&&r.length>11&&(r=r.substring(0,9)+"...")):t.formData.list[T].changeSize=!1}switch(t.formData.list[T].total.CALSUM=r,t.formData.list[T].total.BZBD){case"人民币":t.formData.list[T].imgSrc="app/work/img/rmb-icon.png";break;case"美元":t.formData.list[T].imgSrc="app/work/img/dolla-iconr.png";break;case"欧元":t.formData.list[T].imgSrc="app/work/img/Euro-icon.png";break;case"日元":t.formData.list[T].imgSrc="app/work/img/yen-icon.png"}}}function N(){var t=l.baseApiUrl+"app/dashboard/v1/purchasingStatistics",a={userPkid:s.get(u.userId,null),time_from:null,time_to:null,orderby:1,time_unit:null};g.getRequestData(t,a,!1,"GET").then(function(t){b(t)},function(t){})}function y(){var a=l.baseApiUrl+"app/common/v2/getMyStatistics",e={account:s.get(u.userId,null)};g.getRequestData(a,e,!0,"POST").then(function(a){console.log(a),t.workHomeData=JSON.parse(a.list);var e=a.other+a.money+a.goods+a.staff;e>0&&(t.workTotalNum="[ "+e+" ]"),t.documentNum=a.documentNum,t.followNum=a.followNum,t.request=a.sentNum,t.understandingNum=a.understandingNum;var r=t.documentNum+t.followNum+t.request+t.understandingNum;if(r>0&&(t.otherAppplications="[ "+r+" ]"),a.state===-1){t.workHomeData=n.getVirtualData.list;for(var l=0;l<4;l++)t.workHomeData[l].bgFlag=!1,t.workHomeData[l].imgUrl=["app/work/img/finance-approval.png","app/work/img/purchase-approval.png","app/work/img/pay-approval.png","app/work/img/other-approval.png"][l],t.workHomeData[l].titleName="数据出错";i.isPC||p.showShortBottom(c.translate("publicMsg.requestErr"))}else{U=!0;var s=0;console.log(t.workHomeData),t.workHomeData.forEach(function(a,o){s+=a.CNT,s>0&&(t.workTotalNum="[ "+s+" ]"),t.workHomeData[o].imgUrl=["app/work/img/finance-approval.png","app/work/img/purchase-approval.png","app/work/img/pay-approval.png","app/work/img/other-approval.png"][o]}),o.documentNum=Number(t.documentNum),o.tabWaitWork=s>0,o.tabWork=s+o.documentNum>0}},function(t){i.isPC||p.showShortBottom(c.translate("publicMsg.requestErr"))})}function W(){var a=l.baseApiUrl+"app/home/v3/customCount",o={account:s.get(u.userId,null)},e=s.get(u.authorization,null),r=s.get(u.userId,null);$.ajax({method:"POST",url:a,data:o,headers:{Authorization:e,User_Pkid:r},success:function(a){var o=JSON.parse(a).list,e=JSON.parse(o);t.numDataObj={};for(var r=0,i=0,n=0;n<e.length;n++)t.numDataObj[e[n].pkid]=e[n].num;for(var l=0;l<Math.max(t.flagStatusOne.length,t.flagStatusTwo.length);l++)i+=l<t.flagStatusOne.length?t.numDataObj[t.flagStatusOne[l].pkid]:0,r+=l<t.flagStatusTwo.length?t.numDataObj[t.flagStatusTwo[l].pkid]:0;t.flagOneNum="[ "+i+" ]",t.flagTwoNum="[ "+r+" ]",t.$apply(),console.log(a);var s=d.getSyncDb();s.transaction(function(t){t.executeSql("DELETE FROM SyncData",[],function(t,a){},function(t,a){})}),s.transaction(function(a){a.executeSql("INSERT INTO SyncData VALUES(?)",[angular.toJson(t.workHomeData)],function(t){},function(t,a){})})},error:function(a){console.log(a),t.flagStatusOne=0,t.flagStatusTwo=0}})}function H(){var a=l.baseApiUrl+"app/common/v1/getMyStatisticsDone",o={account:s.get(u.userId,null)};g.getRequestData(a,o,!0,"POST").then(function(a){console.log(a.list),U=!0;var o=0;t.alreadyWorkHomeData=JSON.parse(a.list),t.alreadyWorkHomeData.forEach(function(a,e){o+=a.CNT,o>0&&(t.done="[ "+o+" ]"),t.alreadyWorkHomeData[e].imgUrl=["app/work/img/al-finance-approval.png","app/work/img/al-purchase-approval.png","app/work/img/al-pay-approval.png","app/work/img/al-other-approval.png"][e]})},function(t){i.isPC||p.showShortBottom(c.translate("publicMsg.requestErr"))})}function M(){var t=l.baseApiUrl+"app/common/v2/getMessageNum",a={userCode:JSON.parse(s.get("userLogin",null)).name};g.getRequestData(t,a,!1,"POST").then(function(t){console.log(t),0===t.state&&(o.tabIonNotification=t.messageNum>0,o.bellRed=o.tabIonNotification)})["catch"](function(t){i.isPC||p.showShortBottom(c.translate("publicMsg.requestErr"))})}t.workHomeData=n.getVirtualData.list,t.workHomeDataa=[],t.alreadyWorkHomeData=n.getVirtualData.alreadyList;for(var T=0;T<4;T++)t.workHomeData[T].bgFlag=!1,t.workHomeData[T].imgUrl=["app/work/img/finance-approval.png","app/work/img/purchase-approval.png","app/work/img/pay-approval.png","app/work/img/other-approval.png"][T],t.workHomeData[T].titleName="数据加载中",t.alreadyWorkHomeData[T].bgFlag=!1,t.alreadyWorkHomeData[T].imgUrl=["app/work/img/al-finance-approval.png","app/work/img/al-purchase-approval.png","app/work/img/al-pay-approval.png","app/work/img/al-other-approval.png"][T],t.alreadyWorkHomeData[T].titleName="数据加载中";var U=!1;if(t.isShowForm=!1,t.isTotalMoney=!0,""!=s.get(u.roleList,""))for(var O=angular.fromJson(s.get(u.roleList,"")),T=0;T<O.length;T++)switch(O[T].roleCode){case"mobile-dashboard-purchase":t.isShowForm=!0}t.workTotalNum="",t.formData={},t.showIpadHr=!1,t.widthValue=screen.width,t.done="",t.otherAppplications="",t.$on("$ionicView.beforeEnter",function(a,e){if(r.clearCache(),r.clearHistory(),i.isPC||screen.orientation.lock("default"),t.isShowForm&&N(),e.enableBack=!0,o.bell=!0,o.toBack=!1,o.hideTabs=!1,o.titleData="工作",s.set(f.sizerWorkTypeKey,""),s.set(f.sizerWorkStateKey,""),s.set("viewFormCacheWork",null),s.removeItem("searchDataStr"),ionic.Platform.isIPad())switch(t.showIpadHr=!0,window.orientation){case 0:v(!0,!1,!1,!1,!0,!1);break;case 90:v(!0,!1,!1,!0,!1,!1);break;case-90:v(!0,!1,!1,!0,!1,!1)}else t.showIpadHr=!1,v(!1,!0,!1,!1,!1,!0);o.clickLiftMessage=function(){k.stateGoUtils(!0,"tab.workNotification",{type:"work"},"left")};var n=function(){var a=l.baseApiUrl+"app/home/v1/custom",o={account:s.get(u.userId,null)};g.getRequestData(a,o,!0,"POST").then(function(a){if(U=!0,t.workHomeDataa=JSON.parse(a.list),t.workHomeDataa.length>0){t.flagStatusOne=[],t.flagStatusTwo=[];for(var o=0;o<t.workHomeDataa.length;o++)1===t.workHomeDataa[o].flagStatus?t.flagStatusOne.push(t.workHomeDataa[o]):t.flagStatusTwo.push(t.workHomeDataa[o]);W()}},function(t){i.isPC||p.showShortBottom(c.translate("mine.remarks-fail"))})};H(),n(),y(),M()}),window.addEventListener("orientationchange",function(){h(function(){if(ionic.Platform.isIPad())switch(window.orientation){case 0:v(!0,!1,!1,!1,!0,!1);break;case 90:v(!0,!1,!1,!0,!1,!1);break;case-90:v(!0,!1,!1,!0,!1,!1)}},100)}),t.goWaitWork=function(t){U?k.stateGoUtils(!0,"tab.myWorkWaitWork",{titleName:t.NAME_,typeId:t.TYPE_ID_,workFlag:"isWork",condition:t.condition},"left"):i.isPC?alert(c.translate("publicMsg.requestErr")):p.showShortBottom(c.translate("publicMsg.requestErr"))},t.DBMsg="自定义待办",t.ZHMsg="自定义知会",t.daibanzhihui=function(a,o){if(U){var e=o===t.DBMsg?"tab.myWorkWaitWork":"tab.doneWork";console.log(e),k.stateGoUtils(!0,e,{titleName:a.name,typeId:a.pkid,workFlag:"isWork",condition:a.condition,custom:JSON.stringify(a),titleFlag:"5"},"left")}else i.isPC?alert(c.translate("publicMsg.requestErr")):p.showShortBottom(c.translate("publicMsg.requestErr"))},t.goAlreadyWork=function(t){console.log(t),k.stateGoUtils(!0,"tab.doneWork",{titleName:t.NAME_,titleFlag:"1",typeId:t.TYPE_ID_},"left")},t.goAwait=function(){k.stateGoUtils(!0,"tab.waitNews",{titleName:"待发事项",titleFlag:"3"},"left")},t.goSend=function(){k.stateGoUtils(!0,"tab.waitNews",{titleName:"已发事项",titleFlag:"0"},"left")},t.goAlready=function(){k.stateGoUtils(!0,"tab.doneWork",{titleName:"已办事项",titleFlag:"1"},"left")},t.goTracking=function(){k.stateGoUtils(!0,"tab.doneWork",{titleName:"跟踪事项",titleFlag:"2"},"left")},t.goWorkDoc=function(){k.stateGoUtils(!0,"tab.doneWork",{titleName:"公文查询",titleFlag:"4"},"left")},t.goUnderstanding=function(){k.stateGoUtils(!0,"tab.doneWork",{titleName:"知会事项",titleFlag:"5"},"left")},t.waitWorkMask=!1,t.selectTitleOption=function(){t.isUnfoldtitle=!t.isUnfoldtitle,t.waitWorkMask=!0},t.clientSideList=[{text:"忠旺集团大连",value:"忠旺集团大连"},{text:"忠旺集团上海",value:"忠旺集团上海"},{text:"忠旺集团天津",value:"忠旺集团天津"}],t.data={clientSide:"忠旺集团大连"},t.serverSideChange=function(a){t.isUnfoldtitle=!t.isUnfoldtitle,t.waitWorkMask=!1},t.noMask=function(){t.waitWorkMask=!1,t.isUnfoldtitle=!1},/iphone/i.test(navigator.userAgent)||/ipad/i.test(navigator.userAgent)?(t.platform="ios",t.platformComboBox="ios"):(t.platform="android",t.platformComboBox="android"),t.isShow=!0,t.toggleMenu=function(){t.isShow=!t.isShow},t.isShows=!0,t.toggleMenus=function(){t.isShows=!t.isShows}}])}();